<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>地字第一号</title>
  
  <subtitle>重庆·嘉陵江·望江阁</subtitle>
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2020-09-25T06:50:37.233Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>归海一刀</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Unix和Linux操作系统有什么区别</title>
    <link href="http://example.com/2020/09/25/Unix%E5%92%8CLinux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB/"/>
    <id>http://example.com/2020/09/25/Unix%E5%92%8CLinux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB/</id>
    <published>2020-09-25T06:22:55.000Z</published>
    <updated>2020-09-25T06:50:37.233Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Unix和Linux操作系统有什么区别"><a href="#Unix和Linux操作系统有什么区别" class="headerlink" title="Unix和Linux操作系统有什么区别"></a>Unix和Linux操作系统有什么区别</h1><h1 id="Unix和Linux操作系统有什么区别-1"><a href="#Unix和Linux操作系统有什么区别-1" class="headerlink" title="Unix和Linux操作系统有什么区别"></a>Unix和Linux操作系统有什么区别</h1><p>UNIX、Linux是多用户多任务操作系统;Windows操作系统是单用户多任务操作系统<br>Linux下，我们可能使用虚拟终端来使得多个用户同时工作。<br>而windows下，每次只允许一个用户登陆系统。</p><p>Unix于1969年由贝尔实验室开发出来，使用至今已变更了很多个版本。目前主流的Unix系统有三种，分别是AIX、HP-UX、Solaris，这些Unix系统互不兼容。</p><p>Linux于1991年由芬兰大学生Linus开发出来，是一个类Unix系统，但是其代码不源自任何Unix版本，完全不是Unix的一个分支，而是一个开源版的模仿。</p><p>现在Linux主要使用在PC机和嵌入式，或者一些小型企业的服务器；而Unix垄断着大型企业的关键性应用领域。</p><p>unix是在posix之前就有的，linux是在posix出来之后有的，最初的linux是仿制的minix，unix和linux很多软件都是相通的，linux是UNIX的一个分支，别的分支还有freebsd等，UNIX是命令行下的<a href="https://link.zhihu.com/?target=http://www.2cto.com/os/">系统</a> linux是加了窗体管理的系统。 UNIX是一个功能强大、性能全面的多用户、多任务操作系统，可以应用从巨型计算机到普通PC机等多种不同的平台上，是应用面最广、影响力最大的操作系统。 <a href="https://link.zhihu.com/?target=http://www.2cto.com/os/linux/">Linux</a>是一种外观和性能与UNIX相同或更好的操作系统，但，Linux不源于任何版本的UNIX的源代码，并不是UNIX，而是一个类似于UNIX的产品。</p><p>　　从发展的背景看，Linux是从UNIX发展而来的。这种继承使得Linux的用户能大大地从UNIX团体贡献中获利。因为UNIX是世界上使用最普遍、发展最成熟的操作系统，它是七十年代中期发展起来的微机和巨型机的多任务系统，虽然有时接口比较混乱，并缺少相对集中的标准，但还是发展壮大成为了最广泛使用的操作系统之一。UNIX的用户可以从很多方面得到支持和帮助。因此，Linux做为UNIX的一个克隆，同样会得到相应的支持和帮助，直接拥有UNIX在用户中建立的牢固的地位。</p><p>　　从使用费用上看，UNIX与Linux的区别在于Linux是一种开放、免费的操作系统，而UNIX系统基本上需要有偿使用。这一区别使得我们能够不用花钱就能得到很多Linux的版本以及为其开发的应用软件。当我们访问Internet时，会发现几乎所有可用的自由软件都能够运行在Linux系统上。并且，一大批世界级的优秀的程序员正在努力开发和提供基于Linux的共享软件。 但是，也正是由于Linux<a href="https://link.zhihu.com/?target=http://www.2cto.com/ym/">源码</a>可以开放的缘故，所以现在真正的商业应用尚未开始，原因很简单：任何人都可以了解其内部最薄弱的环节，都可以实施侵袭和攻击。</p><p>　　从产品方面看，UNIX和Linux都是操作系统的名称．但UNIX这四个字母除了是操作系统名称外，还作为商标归SCO所有．Linux商业化的有RedHat Linux 、SuSe Linux、slakeware Linux、国内的红旗等，还有Turbo Linux.UNIX主要有Sun 的Solaris、IBM 的AIX,　HP的HP-UX，以及x86平台的的SCO UNIX/UNIXwareUNIX多数是硬件厂商针对自己的硬件平台的操作系统，主要与CPU等有关，如Sun 的Solaris作为商用，定位在其使用SPARC/SPARCII的CPU的工作站及服务器上，当然Solaris也有x86的版本，而Linux也有其于RISC的版本。</p><p>　　至于价格，个人使用的Linux基本上算是免费的，不同的Linux发行厂商针对企业级应用在基本的系统上有些优化，如RedHat的Enterprise产品，这些产品包括支持服务是比较贵的。像IBM/HP/SUN的UNIX，因为主要是针对其硬件平台，所以操作系统通常在设备价格中。</p><p>　　在性能上，Linux没有UNIX那么全面，但基本上对个人用户和小型应用来说是绰绰有余．通常情况下，如果你有机会使用到UNIX环境，比如银行、电信部门，那一般都是固定机型的UNIX。比如电信里SUN的居多，民航里HP的居多，银行里IBM的居多。学习中，不同的UNIX命令集有些不同，要注意。</p><p>UNIX 与 Linux 之间的关系是一个很有意思的话题。在目前主流的服务器端操作系统中，UNIX 诞生于 20 世纪 60 年代末，Windows 诞生于 20 世纪 80 年代中期，Linux 诞生于 20 世纪 90 年代初，可以说 UNIX 是操作系统中的”老大哥”，后来的 Windows 和 Linux 都参考了 UNIX。</p><blockquote><p>现代的 Windows 系统已经朝着“图形界面”的方向发展了，和 UNIX 系统有了巨大的差异，从表面上甚至看不出两者的关联。</p></blockquote><h2 id="UNIX-的坎坷历史"><a href="#UNIX-的坎坷历史" class="headerlink" title="UNIX 的坎坷历史"></a>UNIX 的坎坷历史</h2><p>UNIX 操作系统由肯•汤普森（Ken Thompson）和丹尼斯•里奇（Dennis Ritchie）发明。它的部分技术来源可追溯到从 1965 年开始的 Multics 工程计划，该计划由贝尔实验室、美国麻省理工学院和通用电气公司联合发起，目标是开发一种交互式的、具有多道程序处理能力的分时操作系统，以取代当时广泛使用的批处理操作系统。</p><p>说明：分时操作系统使一台计算机可以同时为多个用户服务，连接计算机的终端用户交互式发出命令，操作系统采用时间片轮转的方式处理用户的服务请求并在终端上显示结果（操作系统将CPU的时间划分成若干个片段，称为时间片）。操作系统以时间片为单位，轮流为每个终端用户服务，每次服务一个时间片。</p><p>可惜，由于 Multics 工程计划所追求的目标太庞大、太复杂，以至于它的开发人员都不知道要做成什么样子，最终以失败收场。</p><p>以肯•汤普森为首的贝尔实验室研究人员吸取了 Multics 工程计划失败的经验教训，于 1969 年实现了一种分时操作系统的雏形，1970 年该系统正式取名为 UNIX。</p><p>想一下英文中的前缀 Multi 和 Uni，就明白了 UNIX 的隐意。Multi 是大的意思，大而且繁；而 Uni 是小的意思，小而且巧。这是 UNIX 开发者的设计初衷，这个理念一直影响至今。</p><p>有意思的是，肯•汤普森当年开发 UNIX 的初衷是运行他编写的一款计算机游戏 Space Travel，这款游戏模拟太阳系天体运动，由玩家驾驶飞船，观赏景色并尝试在各种行星和月亮上登陆。他先后在多个系统上试验，但运行效果不甚理想，于是决定自己开发操作系统，就这样，UNIX 诞生了。</p><p>自 1970 年后，UNIX 系统在贝尔实验室内部的程序员之间逐渐流行起来。1971-1972 年，肯•汤普森的同事丹尼斯•里奇发明了传说中的C语言，这是一种适合编写系统软件的高级语言，它的诞生是 UNIX 系统发展过程中的一个重要里程碑，它宣告了在操作系统的开发中，<a href="http://c.biancheng.net/asm/">汇编语言</a>不再是主宰。</p><p>到了 1973 年，UNIX 系统的绝大部分源代码都用C语言进行了重写，这为提高 UNIX 系统的可移植性打下了基础（之前操作系统多采用汇编语言，对硬件依赖性强），也为提高系统软件的开发效率创造了条件。可以说，UNIX 系统与C语言是一对孪生兄弟，具有密不可分的关系。</p><p>20 世纪 70 年代初，计算机界还有一项伟大的发明——TCP/IP 协议，这是当年美国国防部接手 ARPAnet 后所开发的网络协议。美国国防部把 TCP/IP 协议与 UNIX 系统、C语言捆绑在一起，由 AT&amp;T 发行给美国各个大学非商业的许可证，这为 UNIX 系统、C语言、TCP/IP 协议的发展拉开了序幕，它们分别在操作系统、编程语言、网络协议这三个领域影响至今。肯•汤普森和丹尼斯•里奇因在计算机领域做出的杰出贡献，于 1983 年获得了计算机科学的最高奖——图灵奖。</p><p><img src="/2020/09/25/Unix%E5%92%8CLinux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB/unix1.jpg" alt="img"><br>图 1 为肯•汤普森与丹尼斯•里奇的合影，天才都是不修边幅的……</p><p>随后出现了各种版本的 UNIX 系统，目前常见的有 Sun Solaris、FreeBSD、IBM AIX、HP-UX 等。</p><h4 id="Solaris-和-FreeBSD"><a href="#Solaris-和-FreeBSD" class="headerlink" title="Solaris 和 FreeBSD"></a>Solaris 和 FreeBSD</h4><p>我们重点介绍一下 Solaris，它是 UNIX 系统的一个重要分支。Solaris 除可以运行在 SPARC CPU 平台上外，还可以运行在 x86 CPU 平台上。在服务器市场上，Sun 的硬件平台具有高可用性和高可靠性，是市场上处于支配地位的 UNIX 系统。</p><p>对于难以接触到 Sun SPARC 架构计算机的用户来说，可以通过使用 Solaris x86 来体验世界知名大厂的商业 UNIX 风采。当然，Solaris x86 也可以用于实际生产应用的服务器，在遵守 Sun 的有关许可条款的情况下，Solaris x86 可以免费用于学习研究或商业应用。</p><p>FreeBSD 源于美国加利福尼亚大学伯克利分校开发的 UNIX 版本，它由来自世界各地的志愿者开发和维护，为不同架构的计算机系统提供了不同程度的支持。FreeBSD 在 BSD 许可协议下发布，允许任何人在保留版权和许可协议信息的前提下随意使用和发行，并不限制将 FreeBSD 的代码在另一协议下发行，因此商业公司可以自由地将 FreeBSD 代码融入它们的产品中。苹果公司的 OS X 就是基于 FreeBSD 的操作系统。</p><p><img src="/2020/09/25/Unix%E5%92%8CLinux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB/unix2.jpg" alt="img"></p><p>FreeBSD 与 Linux 的用户群有相当一部分是重合的，二者支持的硬件环境也比较一致，所采用的软件也比较类似。FreeBSD 的最大特点就是稳定和高效，是作为服务器操作系统的不错选择；但其对硬件的支持没有 Linux 完备，所以并不适合作为桌面系统。</p><p>其他 UNIX 版本因应用范围相对有限，在此不做过多介绍。</p><h2 id="Linux-的那些往事"><a href="#Linux-的那些往事" class="headerlink" title="Linux 的那些往事"></a>Linux 的那些往事</h2><p>Linux 内核最初是由李纳斯•托瓦兹（Linus Torvalds）在赫尔辛基大学读书时出于个人爱好而编写的，当时他觉得教学用的迷你版 UNIX 操作系统 Minix 太难用了，于是决定自己开发一个操作系统。第 1 版本于 1991 年 9 月发布，当时仅有 10 000 行代码。</p><p><img src="/2020/09/25/Unix%E5%92%8CLinux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB/unix3.jpg" alt="img"></p><p>李纳斯•托瓦兹没有保留 Linux 源代码的版权，公开了代码，并邀请他人一起完善 Linux。与 Windows 及其他有专利权的操作系统不同，Linux 开放源代码，任何人都可以免费使用它。</p><p>据估计，现在只有 2% 的 Linux 核心代码是由李纳斯•托瓦兹自己编写的，虽然他仍然拥有 Linux 内核（操作系统的核心部分），并且保留了选择新代码和需要合并的新方法的最终裁定权。现在大家所使用的 Linux，我更倾向于说是由李纳斯•托瓦兹和后来陆续加入的众多 Linux 好者共同开发完成的。</p><p>李纳斯•托瓦兹无疑是这个世界上最伟大的程序员之一，何况，他还搞出了全世界最大的程序员交友社区 <a href="https://github.com/">GitHub</a> (开源代码库及版本控制系统）。</p><p>关于 Linux Logo 的由来是一个很有意思的话题，它是一只企鹅。</p><p><img src="/2020/09/25/Unix%E5%92%8CLinux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB/unix4.jpg" alt="img"></p><p>为什么选择企鹅，而不是选择狮子、老虎或者小白兔？有人说因为李纳斯•托瓦兹是芬兰人，所以选择企鹅，有人说因为其他动物图案都被用光了，李纳斯•托瓦兹只好选择企鹅。</p><p>我更愿意相信以下说法，企鹅是南极洲的标志性动物，根据国际公约，南极洲为全人类共同所有，不属于世界上的任何国家，可国家都无权将南极洲纳入其版图。Linux 选择企鹅图案作为 Logo，其含义是：开放源代码的 Linux 为全人类共同所有，可公司无权将其私有。</p><h2 id="UNIX与Linux的亲密关系"><a href="#UNIX与Linux的亲密关系" class="headerlink" title="UNIX与Linux的亲密关系"></a>UNIX与Linux的亲密关系</h2><p>二者的关系，不是大哥和小弟，”UNIX 是 Linux 的父亲”这个说法更怡当。之所以要介绍它们的关系，是因为要告诉读者，在学习的时候，其实 Linux 与 UNIX 有很多的共通之处，简单地说，如果你已经熟练掌握了 Linux，那么再上手使用 UNIX 会非常容易。</p><p>二者也有两个大的区别：</p><ol><li>UNIX 系统大多是与硬件配套的，也就是说，大多数 UNIX 系统如 AIX、HP-UX 等是无法安装在 x86 服务器和个人计算机上的，而 Linux 则可以运行在多种硬件平台上；</li><li>UNIX 是商业软件，而 Linux 是开源软件，是免费、公开源代码的。</li></ol><p>Linux 受至旷大计算机爱好者的喜爱，主要原因也有两个：</p><ol><li>它属于开源软件，用户不用支付可费用就可以获得它和它的源代码，并且可以根据自己的需要对它进行必要的修改，无偿使用，无约束地继续传播；</li><li>它具有 UNIX 的全部功能，任何使用 UNIX 操作系统或想要学习 UNIX 操作系统的人都可以从 Linux 中获益。</li></ol><p>开源软件是不同于商业软件的一种模式，从字面上理解，就是开放源代码，大家不用担心里面会搞什么猫腻，这会带来软件的革新和安全。</p><p>另外，开源其实并不等同于免费，而是一种新的软件盈利模式。目前很多软件都是开源软件，对计算机行业与互联网影响深远。</p><p>开源软件本身的模式、概念比较晦涩，这套《<a href="http://c.biancheng.net/linux_tutorial/">Linux教程</a>》旨在指导读者应用 Linux，大家简要理解即可。</p><p>近年来，Linux 已经青出于蓝而胜于蓝，以超常的速度发展，从一个丑小鸭变成了一个拥有庞大用户群的真正优秀的、值得信赖的操作系统。历史的车轮让 Linux 成为 UNIX 最优秀的传承者。</p><h4 id="总结一下-Linux-和-UNIX-的关系-区别"><a href="#总结一下-Linux-和-UNIX-的关系-区别" class="headerlink" title="总结一下 Linux 和 UNIX 的关系/区别"></a>总结一下 Linux 和 UNIX 的关系/区别</h4><p>Linux 是一个类似 Unix 的操作系统，Unix 要早于 Linux，Linux 的初衷就是要替代 UNIX，并在功能和用户体验上进行优化，所以 Linux 模仿了 UNIX（但并没有抄袭 UNIX 的源码），使得 Linux 在外观和交互上与 UNIX 非常类似。</p><blockquote><p>说模仿可能会被人喷，你也可以说微创新或者改进。</p></blockquote><p>相比于 UNIX，Linux 最大的创新是开源免费，这是它能够蓬勃发展的最重要原因；而目前的 UNIX 大部分都是收费的，小公司和个人都难以承受。</p><p>正是由于 Linux 和 UNIX 有着千丝万缕的联系，所以人们把 Linux 叫做“<a href="http://c.biancheng.net/view/2621.html">类UNIX系统</a>”，下节我们将会着重讲解。</p><h2 id="UNIX-Linux系统结构"><a href="#UNIX-Linux系统结构" class="headerlink" title="UNIX/Linux系统结构"></a>UNIX/Linux系统结构</h2><p>UNIX/Linux 系统可以粗糙地抽象为 3 个层次（所谓粗糙，就是不够细致、精准，但是便于初学者抓住重点理解），如图 3 所示。底层是 UNIX/Linux 操作系统，即系统内核（Kernel）；中间层是 Shell 层，即命令解释层；高层则是应用层。</p><p><img src="/2020/09/25/Unix%E5%92%8CLinux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB/unix5.jpg" alt="img"><br>图 3 UNIX/Linux 系统结掏层次概要</p><h4 id="1-内核层"><a href="#1-内核层" class="headerlink" title="1) 内核层"></a>1) 内核层</h4><p>内核层是 UNIX/Linux 系统的核心和基础，它直接附着在硬件平台之上，控制和管理系统内各种资源（硬件资源和软件资源），有效地组织进程的运行，从而扩展硬件的功能，提高资源的利用效率，为用户提供方便、高效、安全、可靠的应用环境。</p><h4 id="2-Shell层"><a href="#2-Shell层" class="headerlink" title="2) Shell层"></a>2) Shell层</h4><p>Shell 层是与用户直接交互的界面。用户可以在提示符下输入命令行，由 Shell 解释执行并输出相应结果或者有关信息，所以我们也把 Shell 称作命令解释器，利用系统提供的丰富命令可以快捷而简便地完成许多工作。</p><h4 id="3-应用层"><a href="#3-应用层" class="headerlink" title="3) 应用层"></a>3) 应用层</h4><p>应用层提供基于 X Window 协议的图形环境。X Window 协议定义了一个系统所必须具备的功能（就如同 TCP/IP 是一个协议，定义软件所应具备的功能），可系统能满足此协议及符合 X 协会其他的规范，便可称为 X Window。</p><p>现在大多数的 UNIX 系统上（包括 Solaris、HP-UX、AIX 等）都可以运行 CDE （Common Desktop Environment，通用桌面环境，是运行于 UNIX 的商业桌面环境）的用户界面；而在 Linux 上广泛应用的有 Gnome（见图 4）、KDE 等。</p><p><img src="/2020/09/25/Unix%E5%92%8CLinux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB/unix6.jpg" alt="img"><br>图 4 Gnome图形界面</p><p>X Window 与微软的 Windows 图形环境有很大的区别：</p><ul><li>UNIX/Linux 系统与 X Window 没有必然捆绑的关系，也就是说，UNIX/Linux 可以安装 X Window，也可以不安装；而微软的 Windows 图形环境与内核捆绑密切。</li><li>UNIX/Linux 系统不依赖图形环境，依然可以通过命令行完成 100% 的功能，而且因为不使用图形环境还会节省大量的系统资源。</li></ul><p>作为服务器部署，绝大多数 Linux 并不安装或并不启用图形环境，本教程的讲解也基本上为 Linux 命令行下的操作。</p><h2 id="FreeBSD可以说是正统的Unix，以FreeBSD和Linux区别说明："><a href="#FreeBSD可以说是正统的Unix，以FreeBSD和Linux区别说明：" class="headerlink" title="FreeBSD可以说是正统的Unix，以FreeBSD和Linux区别说明："></a>FreeBSD可以说是正统的Unix，以FreeBSD和Linux区别说明：</h2><p>Linux 是一个采用<a href="https://link.zhihu.com/?target=https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/plain/COPYING">GPL 许可证第二版</a>(GPLv2) 的操作系统内核。由于它只是一个操作系统内核，其生态系统的完善必须依靠东拼西凑。举例来讲，Ubuntu、CentOS、Arch 等发行版都是 Linux 内核 +<a href="https://link.zhihu.com/?target=https://www.gnu.org/software/coreutils/">GNU 套件</a>（有时也会称为 “base” 或者 “userland”）+ 应用软件的组合。普通开发者以及用户所理解的「能干活」的最小系统，至少需要 Linux 内核 + GNU 套件。当然 GNU 套件理论上并不是必须，例如嵌入式领域常用 BusyBox 代替 GNU 套件，另外还有 Android 这类默认不需要 shell 交互的 Linux 发行版存在。Linux 用户可以自行脑补一下从开机引导到进入 shell，再运行几个基本命令比如<code>ls</code>、<code>cd</code>、<code>cat</code>等这套完整流程。</p><ul><li><strong>传染的 GPL 许可证</strong></li></ul><p>由于历史局限性，GPL 许可证在发布当年并没有覆盖云服务的使用场景，使得云服务可以合法绕过其强制开源条款向用户提供服务，间接促成了 Linux 在服务器领域的繁荣。十余年后出现了试图亡羊补牢却于事无补的 <a href="https://link.zhihu.com/?target=https://www.gnu.org/licenses/agpl-3.0.html">AGPL 许可证</a>，此乃后话，按下不表。</p><p>然而，在方兴未艾的 IoT 领域，物联网设备的物理分发必要性使得采用 Linux 的嵌入式产品面临严峻的许可证问题。与云服务不同，嵌入式设备的使用场景通常会触发 GPL 的强制开源条款。尽管这个笼统的描述在法律上并不简单等同于「设备使用了 Linux 就必须开源」，但是 GPL 的传染性无疑会极大增加技术选型以及合规成本。</p><p>不谈法律细节，许可证是非常严肃的问题，忽视许可证风险将给产品和公司带来巨大的不可控因素。GPL 许可证造成的著名纠纷案例可以参考被强制开源的 Linksys WRT54G 无线路由器固件（后来发展成为 <a href="https://link.zhihu.com/?target=https://openwrt.org/">OpenWrt</a>），在此不予赘述。</p><p>同样由于历史原因，在某些忽视版权的国家和地区，Linux 在嵌入式领域曾经大行其道。然而随着全球化进程的加深，越来越多的公司意识到版权问题的重要性。在特殊时期，知识产权陷阱更会成为遏制公司甚至是国家发展的武器。基于 Linux 的物联网设备极有可能深陷 Linksys WRT54G 那样的 GPL 合规泥潭，轻则付出合规与罚款代价，重则被强制开源并丧失商业机密，甚至遭遇全面禁售。</p><ul><li><strong>混乱的发行模式</strong></li></ul><p>看似百花齐放，实际上 Linux 各发行版的区别并不大。除去技术细节，各发行版最主要的差异在于社区性质（用户数量及质量）、技术支持水平（与社区相关）以及不同偏好，例如包管理系统等。</p><p>几乎所有的 Linux 发行版都将 Linux 内核、GNU 套件以及应用软件混为一谈，也就是采用同样的包管理器管理所有组件。这三个部分本来分属若干独立团体，彼此之间并无强耦合关系，却常常被强行锁定版本捆绑在一起发布（特别是非滚动更新发行版）。与系统稳定性紧密相关的核心组件往往和应用软件享有同样的优先级，例如全部配置文件都被塞到 <code>/etc</code> 下，无原则混用 <code>/usr</code> 与 <code>/usr/local</code> 等。</p><p>云服务常用的 LTS (Long Term Support) 发布模式 Linux 系统中，为了「稳定性」，很多被业务重度依赖的应用软件偏偏被锁定在当前 LTS 版本发布时的低版本，并且在今后的 LTS 生命周期（一般是好几年）内得不到任何新版本更新（只会获得重要的安全更新）。这就是将所有组件混为一谈的恶果。</p><p>在实际生产环境中，为了某些应用软件只有新版本才有的新功能，运维不得不开启非官方仓库以求获得新版本支持。更有甚者不惜触犯运维大忌，干脆人为绕过包管理系统，采取自行编译并「山寨」安装的下下策。</p><p>这种一刀切的粗粒度发行模式本身就是极其不合理的奇葩设计，由此产生的各种丑陋的变通方案更是折射出 Linux 社区的精分、痛苦、纠结与挣扎。人人都不满意，人人都想要「更合理」的方案，这也是为什么 Linux 发行版层出不穷的原因。一次次重复发明轮子的行为，使得 Linux 的碎片化问题日益严重。</p><p>近年来兴起的容器技术（例如 Docker）可以部分看作是对以上粗粒度发行模式的反抗：既然每次吃饭都会无可避免弄脏手，我们不妨吃完饭就砍掉脏手，再等新的长出来，这样不至于因为弄脏手而把整个人埋掉。</p><p><strong>可是，难道就没有人能体面一点使用餐具么？？？</strong></p><p>生态高度统一的 x86 市场尚且如此艰辛，更何况是生态多样的 ARM 移动设备市场。Google 使劲浑身解数，仍然无法遏制住 Android 的碎片化趋势，这些都是历历在目的前车之鉴。可想而知，在目前几乎呈现原生态的广阔 IoT 市场，选择 Linux 就注定选择了混乱和颠沛流离。</p><hr><h2 id="FreeBSD"><a href="#FreeBSD" class="headerlink" title="FreeBSD"></a>FreeBSD</h2><p>与东拼西凑的 Linux 发行版不同，源自 BSD 的 FreeBSD 是一套完整的操作系统。FreeBSD 可以说是正统的 Unix，比 Linux 的历史更为悠久。FreeBSD 在今天不如 Linux 流行，是因为若干年前那场 BSD 与 AT&amp;T 的版 (sī) 权 (bī) 纠 (dà) 纷 (zhàn)。待到几年后尘埃落定，FreeBSD 也遗憾地错过了服务器市场爆发的黄金时期。</p><p>风水轮流转，在当前 IoT 市场高速发展的新时期，FreeBSD 正以全新的姿态强势回归。</p><ul><li><strong>宽松的 BSD 许可证</strong></li></ul><p>FreeBSD 采用的<a href="https://link.zhihu.com/?target=https://www.freebsd.org/copyright/freebsd-license.html">两句版 BSD 许可证</a>不要求衍生作品开源，除了保留原始版权声明的要求之外，没有其他的限制，因此对商业使用场景来说非常友好，特别是在物联网设备的嵌入式应用场景下。</p><ul><li><strong>严谨的发行模式</strong></li></ul><p>FreeBSD 内核与基本系统 (base system) 作为一个整体绑定发行（以下简称「系统」），有三个发行分支，分别为 <code>CURRENT</code>、<code>STABLE</code> 以及 <code>RELEASE</code>，在升级路线上也高度一致。其中 <code>RELEASE</code> 分支采用二进制升级方式，剩下两个分支采用源代码编译升级方式。整体发行的好处在于提高系统一致性、健壮性与稳定性。</p><p>FreeBSD 的应用软件采用独立于系统的包管理方案。还能提供同一软件的不同版本选择，不需要像非滚动更新的 Linux 发行版常见的错误做法那样粗暴地将应用软件版本与整个系统锁定。</p><p>以 Python 为例，在 FreeBSD 下不仅有 <code>2.7</code>，还有 <code>3.5</code>、<code>3.6</code> 和 <code>3.7</code> 一共四个版本：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[si@sys ~]$ pkg search python | grep Interpreted</span><br><span class="line">python27-2.7.16_1              Interpreted object-oriented programming language</span><br><span class="line">python35-3.5.7_2               Interpreted object-oriented programming language</span><br><span class="line">python36-3.6.9                 Interpreted object-oriented programming language</span><br><span class="line">python37-3.7.3_1               Interpreted object-oriented programming language</span><br></pre></td></tr></table></figure><p>类似的，Node.js 也有 <code>6.x</code>、<code>8.x</code>、<code>10.x</code> 以及 <code>12.x</code> 这四个版本可供选择：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[si@sys ~]$ pkg search node | grep V8</span><br><span class="line">node-12.4.0                    V8 JavaScript for client and server</span><br><span class="line">node10-10.16.0                 V8 JavaScript for client and server</span><br><span class="line">node6-6.17.1                   V8 JavaScript for client and server (6.x LTS)</span><br><span class="line">node8-8.16.0                   V8 JavaScript for client and server (8.x LTS)</span><br></pre></td></tr></table></figure><p>多版本共存的理念贯穿大多数对版本敏感的软件，比如 PHP、MariaDB、PostgreSQL 等。Linux 发行版（特别是 CentOS）如同噩梦般的软件版本问题，在 FreeBSD 下竟然完全不存在。</p><p>系统与软件的清晰隔离也体现在 FreeBSD 的文件组织结构上。例如，<code>/usr</code> 与 <code>/usr/local</code> 有严格区分，前者为系统文件路径，后者为软件文件路径，根据路径可以直观地识别出用户自行安装的部分。</p><p>不难看出，FreeBSD 这套强大的系统管理方案同时兼顾稳定性、易用性与定制性：</p><ol><li>freebsd-update: 管理内核与基本系统的二进制升级</li><li>pkg: 管理使用默认参数编译好的二进制软件包</li><li>Ports: 管理软件包源代码以供自定义编译</li></ol><p>熟悉 Linux 的人也许会发现，FreeBSD 的包管理方案实际上大约等于以下两大 Linux 发行版包管理器的完美合体：</p><ol><li>Arch: pacman，对应 pkg（秉承同样 <a href="https://link.zhihu.com/?target=https://wiki.archlinux.org/index.php/Arch_terminology%23KISS">KISS</a> 理念）</li><li>Gentoo: Portage，对应 Ports（Portage 本身就是 Ports 的仿制品）</li></ol><p>然而，Linux 发行版并没有类似 freebsd-update 那样的系统二进制升级方案。</p><p>比较而言，FreeBSD 的发行模式更类似于 Windows。FreeBSD 的版本号对应 Windows 版本号，例如 Windows XP、Windows 7、Windows 10 等；FreeBSD 的基本系统对应 Windows 默认安装（包含内置工具与程序，例如控制面板、记事本、画图等）；而 FreeBSD 的应用软件则对应 Windows 上由用户自行安装的第三方程序。</p><ul><li><strong>低调的巨人</strong></li></ul><p>令人惊奇的是，与日常认知不同，FreeBSD 并不小众，在很多商业产品里都能看到 FreeBSD 的身影。以下是几个著名产品的例子：</p><p><img src="/2020/09/25/Unix%E5%92%8CLinux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB/freebsd1.jpg" alt="img"></p><p>这些产品的成功在一定程度上都归功于 FreeBSD 出色的性能以及商业友好的许可证。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Unix和Linux操作系统有什么区别&quot;&gt;&lt;a href=&quot;#Unix和Linux操作系统有什么区别&quot; class=&quot;headerlink&quot; title=&quot;Unix和Linux操作系统有什么区别&quot;&gt;&lt;/a&gt;Unix和Linux操作系统有什么区别&lt;/h1&gt;&lt;h1 i</summary>
      
    
    
    
    <category term="操作系统" scheme="http://example.com/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
    
    <category term="unix" scheme="http://example.com/tags/unix/"/>
    
    <category term="linux" scheme="http://example.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Serverless</title>
    <link href="http://example.com/2020/09/25/serverless/"/>
    <id>http://example.com/2020/09/25/serverless/</id>
    <published>2020-09-25T01:02:38.000Z</published>
    <updated>2020-09-25T01:41:07.881Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><h4 id="最近关于-Serverless-的讨论越来越多。看似与前端关系不大的-Serverless，其实早已和前端有了颇深渊源，并且将掀起新的前端技术变革。此次分享根据个人理解和总结，从前端开发模式在serverless的演进、Serverless-常见服务商提供的解决方案以及-基于Serverless-的前端开发模式等方面，与大家探讨-Serverless-中的前端开发模式。"><a href="#最近关于-Serverless-的讨论越来越多。看似与前端关系不大的-Serverless，其实早已和前端有了颇深渊源，并且将掀起新的前端技术变革。此次分享根据个人理解和总结，从前端开发模式在serverless的演进、Serverless-常见服务商提供的解决方案以及-基于Serverless-的前端开发模式等方面，与大家探讨-Serverless-中的前端开发模式。" class="headerlink" title="最近关于 Serverless 的讨论越来越多。看似与前端关系不大的 Serverless，其实早已和前端有了颇深渊源，并且将掀起新的前端技术变革。此次分享根据个人理解和总结，从前端开发模式在serverless的演进、Serverless 常见服务商提供的解决方案以及 基于Serverless 的前端开发模式等方面，与大家探讨 Serverless 中的前端开发模式。"></a>最近关于 Serverless 的讨论越来越多。看似与前端关系不大的 Serverless，其实早已和前端有了颇深渊源，并且将掀起新的前端技术变革。此次分享根据个人理解和总结，从前端开发模式在serverless的演进、Serverless 常见服务商提供的解决方案以及 基于Serverless 的前端开发模式等方面，与大家探讨 Serverless 中的前端开发模式。</h4><h3 id="一、前端开发模式的演进"><a href="#一、前端开发模式的演进" class="headerlink" title="一、前端开发模式的演进"></a>一、前端开发模式的演进</h3><p><img src="/2020/09/25/serverless/serverless1.jpg" alt="img"></p><h4 id="首先回顾一下前端开发模式的演进，我觉得主要有四个阶段。。"><a href="#首先回顾一下前端开发模式的演进，我觉得主要有四个阶段。。" class="headerlink" title="首先回顾一下前端开发模式的演进，我觉得主要有四个阶段。。"></a>首先回顾一下前端开发模式的演进，我觉得主要有四个阶段。。</h4><p>1、基于模板渲染的动态页面<br> 2、基于 AJAX 的前后端分离<br> 3、基于 Node.js 的前端工程化<br> 4、基于 Node.js 的全栈开发</p><h4 id="基于模板渲染的动态页面"><a href="#基于模板渲染的动态页面" class="headerlink" title="基于模板渲染的动态页面"></a>基于模板渲染的动态页面</h4><p>在早起的互联网时代，我们的网页很简单，就是一些静态或动态的页面，主要目的是用来做信息的展示和传播。这个时候开发一个网页也很easy，主要就是通过 JSP、PHP 等技术写一些动态模板，然后通过 Web Server（nginx，apache） 将模板解析成一个个 HTML 文件，浏览器只负责渲染这些 HTML 文件。这个阶段还没有前后端的分工，通常是后端工程师顺便写了前端页面。</p><p>JSP: Java Server Page: Java服务端页面，在html页面中编写Java代码的页面<br> WebServer：网站服务器或web服务器</p><h4 id="基于-AJAX-的前后端分离"><a href="#基于-AJAX-的前后端分离" class="headerlink" title="基于 AJAX 的前后端分离"></a>基于 AJAX 的前后端分离</h4><p>2005 年 AJAX 技术的正式提出，翻开了 Web 开发的新篇章。基于 AJAX，我们可以把 Web 分为前端和后端，前端负责界面和交互，后端负责业务逻辑的处理。前后端通过接口进行数据交互。我们也不再需要在各个后端语言里面写着难以维护的 HTML。网页的复杂度也由后端的 Web Server 转向了浏览器端的 JavaScript。也正因如此，开始有了前端这个职位。</p><h4 id="基于-Node-js-的前端工程化"><a href="#基于-Node-js-的前端工程化" class="headerlink" title="基于 Node.js 的前端工程化"></a>基于 Node.js 的前端工程化</h4><p>2009年 Node.js 的出现，对于前端来说，也是一个历史性的时刻。随着 Node.js 一同出现的还有 CommonJS 规范和 npm 包管理机制。随后也出现了 Grunt、Gulp、Webpack 等一系列基于 Node.js 的前端开发构建工具。</p><p>在 2013 年前后，前端三大框架 React.js/Angular/Vue.js 相继发布第一个版本。我们可以从以往基于一个个页面的开发，变为基于一个个组件进行开发。开发完成后使用 webpack 等工具进行打包构建，并通过基于 Node.js 实现的命令行工具将构建结果发布上线。前端开发开始变得规范化、标准化、工程化。</p><h4 id="基于-Node-js-的全栈开发"><a href="#基于-Node-js-的全栈开发" class="headerlink" title="基于 Node.js 的全栈开发"></a>基于 Node.js 的全栈开发</h4><p>Node.js 对前端的重要意义还有，以往只能运行在浏览器中的 js 也可以运行在服务器上，前端可以用自己最熟悉的语言来写服务端的代码。于是前端开始使用 Node.js 做全栈开发，开始由前端向全栈的方向转变。这是前端主动突破自己的边界。<br> 另一方面，前端在发展，后端也在发展。也差不多在 Node.js 诞生那个时代，后端普遍开始由<code>巨石应用模式</code>向<code>微服务架构</code>转变。这也就导致以往的前后端分工出现了分歧。随着微服务架构的兴起，后端的接口渐渐变得原子性，微服务的接口也不再直接面向页面，前端的调用变得复杂了。于是 BFF（Backend For Frontend）架构出现了，在微服务和前端中间，加了一个 BFF 层，由 BFF 对接口进行聚合、裁剪后，再输出给前端。而 BFF 这层不是后端本质工作，且和前端的关系最大，所以前端自然而然选择了 Node.js 来实现。这也是当前 Node.js 在服务端较为广泛的应用的原因。</p><h6 id="巨石应用：大部分web工程是将所有的功能模块-service-side-打包到一起并放在一个web容器中运行，很多企业的Java应用程序打包为war包"><a href="#巨石应用：大部分web工程是将所有的功能模块-service-side-打包到一起并放在一个web容器中运行，很多企业的Java应用程序打包为war包" class="headerlink" title="巨石应用：大部分web工程是将所有的功能模块(service  side)打包到一起并放在一个web容器中运行，很多企业的Java应用程序打包为war包"></a>巨石应用：大部分web工程是将所有的功能模块(service  side)打包到一起并放在一个web容器中运行，很多企业的Java应用程序打包为war包</h6><h6 id="微服务架构：微服务架构是一种架构理念，是指将功能分解到离散的各个服务当中，从而降低系统的耦合性，并提供更加灵活的服务支持。把一个大型的单体应用程序和服务拆分为数个或数十个的微小型服务，它可扩展单个组件而不是整个的应用程序堆栈，从而满足服务等级协议。"><a href="#微服务架构：微服务架构是一种架构理念，是指将功能分解到离散的各个服务当中，从而降低系统的耦合性，并提供更加灵活的服务支持。把一个大型的单体应用程序和服务拆分为数个或数十个的微小型服务，它可扩展单个组件而不是整个的应用程序堆栈，从而满足服务等级协议。" class="headerlink" title="微服务架构：微服务架构是一种架构理念，是指将功能分解到离散的各个服务当中，从而降低系统的耦合性，并提供更加灵活的服务支持。把一个大型的单体应用程序和服务拆分为数个或数十个的微小型服务，它可扩展单个组件而不是整个的应用程序堆栈，从而满足服务等级协议。"></a>微服务架构：微服务架构是一种架构理念，是指将功能分解到离散的各个服务当中，从而降低系统的耦合性，并提供更加灵活的服务支持。把一个大型的单体应用程序和服务拆分为数个或数十个的微小型服务，它可扩展单个组件而不是整个的应用程序堆栈，从而满足服务等级协议。</h6><h4 id="下一代前端开发模式"><a href="#下一代前端开发模式" class="headerlink" title="下一代前端开发模式"></a>下一代前端开发模式</h4><p>说完了这几个阶段，可以看到，每一次前端开发模式的变化，都因某个变革性的技术而起。先是 AJAX，而后是 Node.js。那么下一个变革性的技术是什么？不言而喻，个人觉得就是 Serverless。</p><h4 id="什么是serverless"><a href="#什么是serverless" class="headerlink" title="什么是serverless"></a>什么是serverless</h4><p><img src="/2020/09/25/serverless/serverless2.jpg" alt="img"></p><p>CNCF，全称Cloud Native Computing Foundation（云原生计算基金会），成立于 2015 年7月21日（于美国波特兰OSCON 2015上宣布），其最初的口号是坚持和整合开源技术来让编排容器作为微服务架构的一部分，其作为致力于云原生应用推广和普及的一支重要力量，不论您是云原生应用的开发者、管理者还是研究人员都有必要了解。</p><p>目前行业可能更多处在容器 Docker+Kubernetes, 利用<br> IaaS、PaaS和SaaS 来快速搭建部署应用</p><p>基础架构即服务（Infrastructure as a Service，IaaS）、平台即服务（Platform as a Service，PaaS）以及软件即服务（Software as a Service，SaaS）。</p><h6 id="Docker是一个平台，它主要是提供一些服务，任何一台装有docker的机器你都可以建立、发布、运行你的应用程序，使用docker很省钱省时。"><a href="#Docker是一个平台，它主要是提供一些服务，任何一台装有docker的机器你都可以建立、发布、运行你的应用程序，使用docker很省钱省时。" class="headerlink" title="Docker是一个平台，它主要是提供一些服务，任何一台装有docker的机器你都可以建立、发布、运行你的应用程序，使用docker很省钱省时。"></a>Docker是一个平台，它主要是提供一些服务，任何一台装有docker的机器你都可以建立、发布、运行你的应用程序，使用docker很省钱省时。</h6><h6 id="简单的介绍Kubernetes。它就是一套成熟的商用服务编排解决方案。Kubernetes定位在Paas层，重点解决了微服务大规模部署时的服务编排问题。"><a href="#简单的介绍Kubernetes。它就是一套成熟的商用服务编排解决方案。Kubernetes定位在Paas层，重点解决了微服务大规模部署时的服务编排问题。" class="headerlink" title="简单的介绍Kubernetes。它就是一套成熟的商用服务编排解决方案。Kubernetes定位在Paas层，重点解决了微服务大规模部署时的服务编排问题。"></a>简单的介绍Kubernetes。它就是一套成熟的商用服务编排解决方案。Kubernetes定位在Paas层，重点解决了微服务大规模部署时的服务编排问题。</h6><h4 id="其实-Serverless-早已和前端产生了联系，只是我们可能没有感知。"><a href="#其实-Serverless-早已和前端产生了联系，只是我们可能没有感知。" class="headerlink" title="其实 Serverless 早已和前端产生了联系，只是我们可能没有感知。"></a>其实 Serverless 早已和前端产生了联系，只是我们可能没有感知。</h4><p>1、CDN: 相信大家都使用过 CDN，我们开发完成之后，直接将静态文件部署到 CDN 上，通过 CDN 进行内容分发、网络加速，在这个过程中，前端不需要关心 CDN 有多少个节点、如何做负载均衡，也不需要知道 CDN 的 QPS 是多少。所以从这个角度来说，CDN 是一种 serverless 的实现。</p><p>2、再比如对象存储，和 CDN 一样，我们只需要将文件上传到对象存储，就可以直接使用了，不需要关心它如何存取文件、如何进行权限控制，所以对象存储对前端来说是 Serverless。<br> 3、甚至一些第三方的 API 服务，也是 Serverless，因为我们使用的时候，不需要去关心服务器。</p><p><img src="/2020/09/25/serverless/serverless3.jpg" alt="img"></p><h4 id="当然，有了体感还不够，我们还是需要一个更精确的定义。从技术角度来说，Serverless-就是-FaaS-和-BaaS-的结合。"><a href="#当然，有了体感还不够，我们还是需要一个更精确的定义。从技术角度来说，Serverless-就是-FaaS-和-BaaS-的结合。" class="headerlink" title="当然，有了体感还不够，我们还是需要一个更精确的定义。从技术角度来说，Serverless 就是 FaaS 和 BaaS 的结合。"></a>当然，有了体感还不够，我们还是需要一个更精确的定义。从技术角度来说，Serverless 就是 FaaS 和 BaaS 的结合。</h4><p>简单来讲，FaaS（Function as a Service） 就是一些运行函数的平台，比如阿里云的函数计算、AWS 的 Lambda 等。</p><p>BaaS（Backend as a Service）则是一些后端云服务，比如云数据库、对象存储、消息队列等。利用 BaaS，可以极大简化我们的应用开发难度。</p><p>Serverless 则可以理解为运行在 FaaS 中，使用了 BaaS 的函数。</p><h4 id="Serverless-的主要特点有："><a href="#Serverless-的主要特点有：" class="headerlink" title="Serverless 的主要特点有："></a>Serverless 的主要特点有：</h4><p>1、事件驱动—-函数在 FaaS 平台中，需要通过一系列的事件来驱动函数执行。<br> 2、无状态—-因为每次函数执行，可能使用的都是不同的容器，无法进行内存或数据共享。如果要共享数据，则只能通过第三方服务，比如 ```Redis`` 等。</p><h6 id="Redis（全称：Remote-Dictionary-Server-远程字典服务）是一个开源的使用ANSI-C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value-数据库-，并提供多种语言的API。从2010年3月15日起，Redis的开发工作由VMware主持。从2013年5月开始，Redis的开发由Pivotal赞助。"><a href="#Redis（全称：Remote-Dictionary-Server-远程字典服务）是一个开源的使用ANSI-C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value-数据库-，并提供多种语言的API。从2010年3月15日起，Redis的开发工作由VMware主持。从2013年5月开始，Redis的开发由Pivotal赞助。" class="headerlink" title="Redis（全称：Remote Dictionary Server 远程字典服务）是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value[数据库]，并提供多种语言的API。从2010年3月15日起，Redis的开发工作由VMware主持。从2013年5月开始，Redis的开发由Pivotal赞助。"></a>Redis（全称：Remote Dictionary Server 远程字典服务）是一个开源的使用ANSI <a href="https://links.jianshu.com/go?to=https://baike.baidu.com/item/C%E8%AF%AD%E8%A8%80">C语言</a>编写、支持网络、可基于内存亦可持久化的日志型、Key-Value[数据库]，并提供多种语言的API。从2010年3月15日起，Redis的开发工作由VMware主持。从2013年5月开始，Redis的开发由Pivotal赞助。</h6><p>3、无运维—-使用serverless我们不需要关心服务器，也不需要关心运维，这也是serverles思想的核心；<br> 4、低成本—-使用 Serverless 成本很低，因为我们只需要为每次函数的运行付费。函数不运行，则不花钱，也不会浪费服务器资源过度</p><p>？？？？哪些公司平台提供这些功能???现有的服务商 云平台 亚马</p><h3 id="二-Serverless-常见服务商提供的解决方案"><a href="#二-Serverless-常见服务商提供的解决方案" class="headerlink" title="二 Serverless 常见服务商提供的解决方案"></a>二 Serverless 常见服务商提供的解决方案</h3><p><img src="/2020/09/25/serverless/serverless4.jpg" alt="img"></p><p>1、上图是当前主要的一些 Serverless 服务，以及对应的服务解决方案。<br> 2、从下往上，分别是基础设施、开发工具和应用场景。<br> 亚马逊-微软-谷歌<br> 3、基础设施主要是一些云计算厂商提供，包括云计算平台和各种 BaaS 服务，以及运行函数的 FaaS 平台。<br> 前端主要是 Serverless 的使用者，所以对前端来说，最重要的开发工具这一层，我们需要依赖开发工具进行 Serverless 开发、调试和部署。<br> 4、框架（Framework）<br> 如今还没有一个统一的 Serverless 标准，不同云计算平台提供的 Serverless 服务很可能是不一样的，这就导致我们的代码，无法平滑迁移。Serverless 框架一个主要功能是简化 Serverless 开发、部署流程，另一主要功能则是屏蔽不同 Serverless 服务中的差异，让我们的函数能够在不改动或者只改动很小一部分的情况下，在其他 Serverless 服务中也能运行。常见的 Serverless 框架有 Serverless Framework、ZEIT Now、Apex 等。不过这些基本都是国外公司做的，国内还没有这样的平台。<br> 5、Web IDE<br> 和 Serverless 紧密相关的 Web IDE 主要也是各个云计算平台的 Web IDE。利用 Web IDE，我们可以很方便地在云端开发、调试函数，并且可以直接部署到对应的 FaaS 平台。这样的好处是避免了在本地安装各种开发工具、配置各种环境。常见的 Web IDE 有 AWS 的 Cloud9、阿里云的函数计算 Web IDE、腾讯云的 Cloud Studio。<br> 6、当然，目前最主要的开发方式还是在本地进行开发。所以在本地开发 Serverless 的命令行工具也必不可少。<br> 命令行工具主要有两类，一类是云计算平台提供的，如 AWS 的 aws、 Azure 的 az、阿里云的 fun；还有一类是 Serverless 框架提供的，如 serverless、now。<br> 大部分工具如 serverless、fun 等，都是用 Node.js 语言来实现的。<br> 7、应用场景<br> 在开发工具上面一层，则是 Serverless 的一些垂直应用场景。除了使用传统的服务端开发，目前使用 Serverless 技术的还有小程序开发，未来可能还会涉及到物联网领域（IoT）。</p><h4 id="不同-Serverless-服务的对比"><a href="#不同-Serverless-服务的对比" class="headerlink" title="不同 Serverless 服务的对比"></a>不同 Serverless 服务的对比</h4><p><img src="/2020/09/25/serverless/serverless5.jpg" alt="img"></p><p>上图从支持语言、触发器、价格等多个方面对不同 Serverless 服务进行了对比，可以发现有差异，也有共性。</p><p>1、比如几乎所有 Serverless 服务都支持 Node.js/Python/Java 等语言。</p><p>2、从支持的触发器来看，几乎所有服务也都支持 HTTP、对象存储、定时任务、消息队列等触发器。当然，这些触发器也与平台自己的后端服务相关，比如阿里云的对象存储触发器，是基于阿里云的 OSS 产品的存取等事件触发的；而 AWS 的对象存储触发器，则是基于 AWS 的 S3 的事件触发的，两个平台并不通用。这也是当前 Serverless 面临的一个问题，就是标准不统一。</p><h4 id="S3-Amazon-Simple-Storage-Service-Amazon-S3-是一种对象存储服务，提供行业领先的可扩展性、数据可用性、安全性和性能"><a href="#S3-Amazon-Simple-Storage-Service-Amazon-S3-是一种对象存储服务，提供行业领先的可扩展性、数据可用性、安全性和性能" class="headerlink" title="S3:Amazon Simple Storage Service (Amazon S3) 是一种对象存储服务，提供行业领先的可扩展性、数据可用性、安全性和性能"></a>S3:Amazon Simple Storage Service (Amazon S3) 是一种对象存储服务，提供行业领先的可扩展性、数据可用性、安全性和性能</h4><p>从计费的角度来看，各个平台的费用基本一致。在前面也提到，Serverless 的计费是按调用次数计费，执行时长。</p><h3 id="三-基于-Serverless-的前端开发模式"><a href="#三-基于-Serverless-的前端开发模式" class="headerlink" title="三 基于 Serverless 的前端开发模式"></a>三 基于 Serverless 的前端开发模式</h3><h4 id="serverless-开发流程"><a href="#serverless-开发流程" class="headerlink" title="serverless 开发流程"></a>serverless 开发流程</h4><p><img src="/2020/09/25/serverless/serverless6.jpg" alt="img"></p><p>1、在开始具体的案例之前，先看一下传统开发流程。<br> 在传统开发流程中，我们需要前端写页面，后端工程师写接口。后端写完接口之后，把接口部署了，再进行前后端联调。联调完毕后再测试、上线。上线之后，还需要运维工程师对系统进行维护。整个过程涉及多个不同角色，链路较长，沟通协调也是一个问题。</p><p>2、而基于 Serverless，后端变得非常简单了，以往的后端应用被拆分为一个个函数，只需要写完函数并部署到 Serverless 服务即可，后续也不用关心任何服务器的运维操作。后端开发的门槛大幅度降低了。因此，只需要一个前端就可以完成所有的开发工作。<br> 当然，前端基于 Serverless 去写后端，最好也需要具备一定的后端知识。涉及复杂的后端系统或者 Serverless 不适用的场景，还是需要后端开发。</p><h3 id="serverless带来的价值"><a href="#serverless带来的价值" class="headerlink" title="serverless带来的价值"></a>serverless带来的价值</h3><p>1．降低运营复杂度</p><p>Serverless架构使软件应用和服务器实现了解耦，服务器不再是用户开发和运营应用的焦点。在应用上线前，用户无须再提前规划服务器的数量和规格。在运维过程中，用户无须再持续监控和维护具体服务器的状态，只需要关心应用的整体状态。应用运营的整体复杂度下降，用户的关注点可以更多地放在软件应用的体验和改进以及其他能带来更高业务价值的地方。<br> 2．降低运营成本<br> 服务器不再是用户关注的一个受管资源，运营的复杂度下降，应用运营所需要投入的时间和人力将大大降低。在最好的情况下，可以做到少数几个应用管理员即可管理一个处理海量请求的应用系统。</p><p>3、缩短产品的上市时间<br> 在Serverless架构下，应用的功能被解构成若干个细颗粒度的无状态函数，功能与功能之间的边界变得更加清晰，功能模块之间的耦合度大大减小。这使得软件应用的开发效率更高，应用开发的迭代周期更短。</p><h3 id="serverless实践"><a href="#serverless实践" class="headerlink" title="serverless实践"></a>serverless实践</h3><h4 id="基于-Serverless-的-BFF-Backend-For-Frontend"><a href="#基于-Serverless-的-BFF-Backend-For-Frontend" class="headerlink" title="基于 Serverless 的 BFF (Backend For Frontend)"></a>基于 Serverless 的 BFF (Backend For Frontend)</h4><p><img src="/2020/09/25/serverless/serverless7.jpg" alt="img"></p><h4 id="传统-BFF-Backend-For-Frontend-架构"><a href="#传统-BFF-Backend-For-Frontend-架构" class="headerlink" title="传统 BFF (Backend For Frontend) 架构"></a>传统 BFF (Backend For Frontend) 架构</h4><p>1、一方面，对不同的设备需要使用不同的 API，另一方面，由于微服务导致前端接口调用的复杂，所以前端开始使用 BFF 的方式，对接口进行聚合裁剪，以得到适用于前端的接口。<br> 2、最底层的就是各种后端微服务，最上层就是各种前端应用。在微服务和应用之前，就是通常由前端开发的 BFF。<br> -手机端-web端-嵌入式-<br> 这样的架构解决了接口协调的问题，但也带来了一些新的问题。</p><h4 id="传统-BFF-Backend-For-Frontend-的痛点"><a href="#传统-BFF-Backend-For-Frontend-的痛点" class="headerlink" title="传统 BFF (Backend For Frontend) 的痛点"></a>传统 BFF (Backend For Frontend) 的痛点</h4><p>比如针对每个设备开发一个 BFF 应用，也会面临一些重复开发的问题。而且以往前端只需要开发页面，关注于浏览器端的渲染即可，现在却需要维护各种 BFF 应用。以往前端也不需要关心并发，现在并发压力却集中到了 BFF 上。总的来说运维成本非常高，通常前端并不擅长运维。</p><p>Serverless 则可以帮我们很好的解决这些问题。用Serverless，我们可以用一个个函数来实各个接口的聚合裁剪。前端向 BFF 发起的请求，就相当于是 FaaS 的一个 HTTP 触发器，触发一个函数的执行，这个函数中来实现针对该请求的业务逻辑，比如调用多个微服务获取数据，然后再将处理结果返回给前端。这样运维的压力，就由以往的 BFF Server 转向了 FaaS 服务，前端再也不用关心服务器了。</p><h4 id="基于-Serverless-的-BFF-架构"><a href="#基于-Serverless-的-BFF-架构" class="headerlink" title="基于 Serverless 的 BFF 架构"></a>基于 Serverless 的 BFF 架构</h4><p>上图则是基于 Serverless 的 BFF 架构。为了更好的管理各种 API，我们还可以添加网关层，通过网关来管理所有 API（比如阿里云的网关），比如对 API 进行分组、分环境。基于 API 网关，前端就不直接通过 HTTP 触发器来执行函数，而是将请求发送至网关，再由网关去触发具体的函数来执行。<br> API Gateway<br> 在没有API网关作为统一出口的情况下，需要调用方自己组合各种服务，而且容易让调用方感知后端各种服务的存在，各个需要各个做很多相同的工作。<br> 加入API Gateway之后的作用<br> 一般也会把路由，安全，限流，缓存，日志，监控，重试，熔断等都放到 API 网关来做，然后服务层就完全脱离这些东西，纯粹的做业务，也能够很好的保证业务代码的干净，不用关心安全，压力等方面的问题。</p><h4 id="基于-Serverless-的服务端渲染"><a href="#基于-Serverless-的服务端渲染" class="headerlink" title="基于 Serverless 的服务端渲染"></a>基于 Serverless 的服务端渲染</h4><h4 id="传统服务端渲染"><a href="#传统服务端渲染" class="headerlink" title="传统服务端渲染"></a>传统服务端渲染</h4><p>基于当下最流行的三大前端框架（React.js/Anguler/Vue.js），现在的渲染方式大部分都是客户端渲染。页面初始化的时候，只加载一个简单 HTML 以及对应的 JS 文件，再由 JS 来渲染出一个个页面。这种方式最主要的问题就是白屏时间和 SEO 搜索引擎优化</p><p>为了解决这个问题，前端又开始尝试服务端渲染。本质思想其实和最早的模板渲染是一样的。都是前端发起一个请求，后端 Server 解析出一个 HTML 文档，然后再返回给浏览器。只不过以往是 JSP、PHP 等服务端语言的模板，现在是基于 React、Vue 等实现的同构应用，这也是如今的服务端渲染方案的优势。</p><p>但服务端渲染又为前端带来了一些额外的问题：运维成本，前端需要维护用于渲染的服务器。</p><h4 id="基于serverless的服务端渲染"><a href="#基于serverless的服务端渲染" class="headerlink" title="基于serverless的服务端渲染"></a>基于serverless的服务端渲染</h4><p>Serverless 最大的优点就是可以帮我们减少运维，那 Serverless 能不能用于服务端渲染呢？当然也是可以的。</p><p>传统的服务端渲染，每个请求的 path 都对应着服务端的每个路由，由该路由实现对应 path 的 HTML 文档渲染。用于渲染的服务端程序，就是这些集成了这些路由的应用。<br> 使用 Serverless 来做服务端渲染，就是将以往的每个路由，都拆分为一个个函数，再在 FaaS 上部署对应的函数。这样用户请求的 path，对应的就是每个单独的函数。通过这种方式，就将运维操作转移到了 FaaS 平台，前端做服务端渲染，就不用再关心服务端程序的运维部署了。</p><h4 id="基于-Serverless-的小程序开发"><a href="#基于-Serverless-的小程序开发" class="headerlink" title="基于 Serverless 的小程序开发"></a>基于 Serverless 的小程序开发</h4><p>1、目前国内使用 Serverless 较多的场景可能就是小程开发了。具体的实现就是小程序云开发，支付宝小程序和微信小程序都提供了云开发功能。<br> 2、在传统的小程序开发中，我们需要前端进行小程序端的开发；后端进行服务端的开发。小程序的后端开发和其他的后端应用开发，本质是是一样的，需要关心应用的负载均衡、备份冗灾、监控报警等一些列部署运维操作。如果开发团队人很少，可能还需要前端去实现服务端。<br> 但基于云开发，就只需要让开发者关注于业务的实现，由一个前端就能够完成整个应用的前后端开发。因为云开发将后端封装为了 BaaS 服务，并提供了对应的 SDK 给开发者，开发者可以像调用函数一样使用各种后端服务。应用的运维也转移到了提供云开发的服务商。<br> 下面分别是使用支付宝云开发的一些例子，函数就是定义在 FaaS 服务中的函数。</p><p>负载均衡（Load Balance）其意思就是分摊到多个操作单元上进行执行，例如Web服务器、FTP服务器、企业关键应用服务器和其它关键任务服务器等，从而共同完成工作任务<br> 备份冗灾：就是为了防止出现自然或者社会灭害带来的对存储设备的损害而造成对数据丢失,而采取的备份.</p><h4 id="通用-Serverless-架构"><a href="#通用-Serverless-架构" class="headerlink" title="通用 Serverless 架构"></a>通用 Serverless 架构</h4><p>基于上述几个 Serverless 开发的例子，就可以总结出一个通用的 Serverless 架构。</p><p><img src="/2020/09/25/serverless/serverless8.jpg" alt="img"></p><p>其中最底层就是实现复杂业务的后端微服务（Backend）。然后 FaaS 层通过一系列函数实现业务逻辑，并为前端直接提供服务。对于前端开发者来说，前端可以通过编写函数的方式来实现服务端的逻辑。</p><p>同时不管是在后端、FaaS 还是前端，我们都可以去调用云计算平台提供的 BaaS 服务，大大降低开发难度、减少开发成本。小程序云开发，就是直接在前端调用 BaaS 服务的例子。</p><h3 id="一句话总结serverless-less-is-more"><a href="#一句话总结serverless-less-is-more" class="headerlink" title="一句话总结serverless - less is more"></a>一句话总结serverless - less is more</h3><p>使用 Serverless，我们不需要再过多关注服务端的运维，不需要关心我们不熟悉的领域，我们只需要专注于业务的开发、专注于产品的实现。我们需要关心的事情变少了，但我们能做的事情更多了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;h4 id=&quot;最近关于-Serverless-的讨论越来越多。看似与前端关系不大的-Serverless，其实早已和前端有了颇深渊源，并且将掀起</summary>
      
    
    
    
    <category term="架构" scheme="http://example.com/categories/%E6%9E%B6%E6%9E%84/"/>
    
    
    <category term="Serverless" scheme="http://example.com/tags/Serverless/"/>
    
  </entry>
  
  <entry>
    <title>中间件</title>
    <link href="http://example.com/2020/09/24/%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    <id>http://example.com/2020/09/24/%E4%B8%AD%E9%97%B4%E4%BB%B6/</id>
    <published>2020-09-24T07:18:44.000Z</published>
    <updated>2020-09-25T01:40:52.359Z</updated>
    
    <content type="html"><![CDATA[<h2 id="中间件是什么"><a href="#中间件是什么" class="headerlink" title="中间件是什么"></a>中间件是什么</h2><p>中间件是一种独立的系统软件或服务程序，分布式应用软件借助这种软件在不同的技术之间共享资源。中间件位于客户机/ 服务器的操作系统之上，管理计算机资源和网络通讯。是连接两个独立应用程序或独立系统的软件。相连接的系统，即使它们具有不同的接口，但通过中间件相互之间仍能交换信息。</p><p>执行中间件的一个关键途径是信息传递。通过中间件，应用程序可以工作于多平台或 OS 环境。</p><p>中间件是介于操作系统和应用软件之间，为应用软件提供服务功能的软件，有消息中间件，交易中间件，应用服务器等。由于介于两种软件之间，所以，称为中间件。</p><h2 id="为什么使用中间件"><a href="#为什么使用中间件" class="headerlink" title="为什么使用中间件"></a>为什么使用中间件</h2><p>具体地说，中间件屏蔽了底层操作系统的复杂性，使程序开发人员面对一个简单而统一的开发环境，减少程序设计的复杂性，将注意力集中在自己的业务上，不必再为程序在不同系统软件上的移植而重复工作，从而大大减少了技术上的负担。</p><p>中间件带给应用系统的，不只是开发的简便、开发周期的缩短，也减少了系统的维护、运行和管理的工作量，还减少了计算机总体费用的投入。</p><h2 id="主要中间件的分类"><a href="#主要中间件的分类" class="headerlink" title="主要中间件的分类"></a>主要中间件的分类</h2><h4 id="1-Hadoop"><a href="#1-Hadoop" class="headerlink" title="1. Hadoop"></a>1. Hadoop</h4><p>当一个大的任务由一台机器在规定的时间内不能完成时，人们就要采用分布式计算，即很多台机器联合起来共同完成任务。换句话说，就是把大任务拆分成许多个小任务，然后再把这些小任务分配给多台计算机去完成。参与计算的多台计算机组成一个分布式系统，需要运行一系列的分布式基础算法。</p><p>Hadoop 就是一个分布式计算平台，用 <a href="http://c.biancheng.net/java/">Java</a> 语言开发，包含 Common、MapReduce 和 HDFS 三个核心部件（HDFS 和 MapReduce 是最核心的两个部件）。其中：</p><ul><li>Common 为 Hadoop 的其他项目提供了一些常用工具，主要包括系统配置工具 Configuration、远程过程调用 RPC、序列化机制和 Hadoop 抽象文件系统等。</li><li>MapReduce 是处理海量数据的计算模型。</li><li>而 HDFS 用于存储海量数据，它具备高度容错性，能在低成本的通用硬件机器上稳定运行。</li></ul><p>Hadoop 实现了分布式计算中的基础算法（如一致算法、选举算法、故障检测、快照等），同时为用户提供了编程和命令接口。程序员调用这些函数能轻松写出分布式应用程序，我们都知道，如果一切从头开始，要完成一个分布式程序的编写是异常艰难的。</p><p>Hadoop 在海量非结构化数据处理方面能充分展示它的优势，如消费者购买行为分析、商品推荐、关键词检索、信贷风险评估等。</p><p>如图 1 所示，Hadoop 其实就是一个分布式计算平台，它“覆盖”在操作系统之上，向上提供函数调用（API）和命令接口，在水平方向完成分布式系统的基础算法。作为编程人员和用户，只要了解 API 和命令即可。</p><p><img src="/2020/09/24/%E4%B8%AD%E9%97%B4%E4%BB%B6/middle1.jpg" alt="Hadoop"><br>图 1 Hadoop</p><p>基于 Hadoop 平台衍生出来的开源项目主要有 Yarn、<a href="http://c.biancheng.net/hbase/">HBase</a>、Hive、ZooKeeper、Avro、Sqoop、Mahout、Crossbow 等。</p><p>以 Hadoop 为基础的生态目前已经成为<a href="http://c.biancheng.net/big_data/">大数据</a>的标准方案，被广泛用于金融、市场、电信、交通等行业的海量数据分析，在即将到来的大数据时代，它将会发挥更大的作用。</p><p>在中国，很多行业（如银行、电信、移动、电力、石油、交通等）沉淀了大量的业务数据，对这些海量数据进行挖掘和分析，将会带来巨大的价值。</p><p>用 Hadoop 构建的应用实例对于计算资源的消耗具备两个明显的特征：</p><ul><li>资源需求大：表明 Hadoop 需要大量的存储、计算和网络带宽。</li><li>资源需求具备季节性：表明除存储需求是经常性占用外，在运行 Mapreduce 时才需要大量的计算和网络资源，而分析大量数据的工作并不是经常性的——称为季节性</li></ul><p>因此，<a href="http://c.biancheng.net/cloud_computing/">云计算</a>是大数据天生的计算资源供应途径，云计算的资源弹性很好地满足了大数据的季节性计算资源需求。也就是说，大数据是云计算经典的应用案例。当然，也可以按照大数据对计算资源的波峰需求静态配给计算资源，但是这种方案会造成资源的巨大浪费。</p><h4 id="2-LVS"><a href="#2-LVS" class="headerlink" title="2. LVS"></a>2. LVS</h4><p>LVS 是 Linux Virtual Server 的首字母缩写，意为 Linux 虚拟服务器，即把许多台物理 Linux 计算机逻辑上整合成一台超级计算机，对用户来说感觉只有一台计算能力很强的服务器，如图 2 所示。</p><p>LVS 就是一个由软件实现的负载均衡器，工作在网络 OSI 的第四层（应用层），是中国人章嵩开发的，代码已经并入了 Linux 内核。利用它，再加上一台廉价的计算机，就能构建一台企业级的负载均衡器。而那些外国大公司的负载均衡器，售价都要十几万元，甚至几十万元，便宜的也要几万元，LVS 出来后，这些产品都不得不降价。</p><p>负载均衡器的作用就是把任务分配给最合适的服务器。比如一个大型购物网店，有 100 台同样配置的服务器在运行，如果某一时刻有 10 万用户在线购物，那么通过负载均衡器，每台服务器差不多承担 1000 个在线购物用户。</p><p>LVS 的官网网站是 <a href="http://www.linuxvirtualserver.org/">http：//www.linuxvirtualserver.org</a>。另外，两个较为流行的第七层负载均衡器是 Nginx 和 HAProxy，针对应用做均衡，所以能适应的负载种类没有 LVS 多。</p><p><img src="/2020/09/24/%E4%B8%AD%E9%97%B4%E4%BB%B6/middle2.gif" alt="LVS原理图"><br>图 2 LVS原理图</p><h4 id="3-Linux-HA"><a href="#3-Linux-HA" class="headerlink" title="3. Linux-HA"></a>3. Linux-HA</h4><p>也许有读者会问：“负载均衡器本身故障怎么办？”是的，如果负载均衡器出现故障，那么整个系统（如网店）将会瘫痪。所以人们开发了各种集群软件，如 Linux-HA 和 Keepalive 等，而微软干脆就在 Windows 服务器版中集成故障转移集群软件。</p><p>集成故障转移集群软件的核心思想是，实时检测故障机器并及时让好的机器接管工作，对外提供高可用性。Linux-HA 意为 Linux 高可用性项目，此项目具体包含如下几个组件。</p><table><thead><tr><th>名称</th><th>作用</th></tr></thead><tbody><tr><td>Heartbeat</td><td>负责维护集群中各节点的信息及它们之间的心跳通信。</td></tr><tr><td>Pacemaker</td><td>集群资源管理器，是核心组件，客户端通过 Pacemaker 来配置、管理并监控整个集群。此组件的社区网站为 <a href="http://clusterlabs.org/">http：//clusterlabs.org/</a>。OpenStack 高可用性部署实例中一般都采用 Pacemaker 和 HAProxy。</td></tr><tr><td>Resource Agent</td><td>为用于控制服务启停、监控服务状态的脚本集合，本地资源管理器（LRM）调用这些脚本来启动、停止、监控各种集群资源。</td></tr><tr><td>Cluster Glue</td><td>包含一套函数库和工具，在集群栈中，除集群消息传输（由 Heartbeat 承担）、集群资源管理（由 Pacemaker 承担）和资源代理（由 Resource Agent 承担）功能外，其他功能都由 Cluster Glue 来完成。它包含的两个主要部分是 LRM 和 Stonith，前者是本地资源管理器，后者的任务是隔离故障机器。</td></tr></tbody></table><p>通过心跳信号（Heartbeat）检测故障，一台好的计算机会不断向其他计算机发送心跳信号，也会接收其他计算机发送过来的心跳信息。当在规定的时间内没有收到对方计算机的心跳信号时，就启动应急预案，进一步确认故障并准备接管那台计算机的任务。</p><p>例如，我们采用两台 LVS 计算机，并分别安装和配置 Linux-HA，一台 LVS 计算机作为工作机，另一台作为备份机，两台 LVS 计算机互相监督对方的运行状态。当工作机故障时，备份机接管负载均衡任务并报警。相反，当备份机出故障时，只报警，提醒技术员维修备份机。</p><p>两台LVS计算机同时出故障是比较糟糕的情况，不过这种情况发生的概率很小，除非机房断电或者遭到雷击。对于一些非常关键的应用，可以增加参与负载均衡的服务器数量来提高可靠性，如民航飞机上采用 5 台服务器。</p><h4 id="4-静态网站服务器"><a href="#4-静态网站服务器" class="headerlink" title="4. 静态网站服务器"></a>4. 静态网站服务器</h4><p>我们浏览一家公司的网站时，很可能就是跟那家公司服务器上的 Apache 程序打交道，网页浏览器与 Apache 成了标准的 C/S 模式，浏览器是客户端，而 Apache 是服务端。Apache 首先把主页对应的文件 index.html 发给我们，我们看到主页内容后，点击主页上的某个链接，它又把该链接对应的文件发给我们，过程如图 3 所示。</p><p><img src="/2020/09/24/%E4%B8%AD%E9%97%B4%E4%BB%B6/middle3.jpg" alt="访问静态网页的过程"><br>图 3 访问静态网页的过程</p><p>配合 <a href="http://c.biancheng.net/php/">PHP</a> 引擎，Apache 也支持 PHP 动态网页。过程为：</p><p>1）当 Apache 收到用户要浏览的 PHP 文件后，把这个 PHP 文件发给 PHP 执行引擎。</p><p>2）PHP 执行引擎执行该 PHP 文件，产生一个临时的静态网页文件并发回给 Apache。</p><p>3）最后 Apache 把这个临时的静态网页文件发给用户。</p><p>采用 Perl、<a href="http://c.biancheng.net/python/">Python</a> 和 Ruby 脚本语言编写的动态网页，其工作过程与 PHP 类似。</p><p>Apache 是最流行的开源网站服务器，在世界排名前 100 万的网站中，有 60.6% 的网站采用 Apache；在排名前 1000 的大型网站中，Apache 占到了 34.5%，而 Ngnix 占到了 34.9%，略胜于 Apache。</p><h4 id="5-动态应用服务器"><a href="#5-动态应用服务器" class="headerlink" title="5. 动态应用服务器"></a>5. 动态应用服务器</h4><p>开源的动态应用服务器有 JBoss、Tomcat、Geronimo、JOnAS，关于这些项目更详细的介绍，请参考相应的官方网站。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;中间件是什么&quot;&gt;&lt;a href=&quot;#中间件是什么&quot; class=&quot;headerlink&quot; title=&quot;中间件是什么&quot;&gt;&lt;/a&gt;中间件是什么&lt;/h2&gt;&lt;p&gt;中间件是一种独立的系统软件或服务程序，分布式应用软件借助这种软件在不同的技术之间共享资源。中间件位于客户机/</summary>
      
    
    
    
    <category term="架构" scheme="http://example.com/categories/%E6%9E%B6%E6%9E%84/"/>
    
    
    <category term="中间件" scheme="http://example.com/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>微服务</title>
    <link href="http://example.com/2020/09/24/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    <id>http://example.com/2020/09/24/%E5%BE%AE%E6%9C%8D%E5%8A%A1/</id>
    <published>2020-09-24T07:09:46.000Z</published>
    <updated>2020-09-25T01:40:41.037Z</updated>
    
    <content type="html"><![CDATA[<h1 id="什么是微服务？为什么要用微服务？"><a href="#什么是微服务？为什么要用微服务？" class="headerlink" title="什么是微服务？为什么要用微服务？"></a>什么是微服务？为什么要用微服务？</h1><p><img src="/2020/09/24/%E5%BE%AE%E6%9C%8D%E5%8A%A1/microSer1.png" alt="img"></p><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>最近几年微服务很火，大家都在建设微服务，仿佛不谈点微服务相关的技术，都显得不是那么主流了。</p><p>近几年见识到身边朋友的很多公司和团队都在尝试进行微服务的改变，但很多团队并没有实际微服务踩坑经验，很多团队甚至强行为了微服务而去微服务，最终写成一个大型的分布式单体应用，就是改造后的系统既没有微服务的快速扩容，灵活发布的特性，也让原本的单体应用失去了方便开发，部署容易的特性（项目拆为多份，开发部署复杂度都提高了），不得不说是得不偿失。</p><p>作者亲身经历和参与几个大型项目微服务的改造和建设。所以想作为实践者跟大家分享关于微服务的实际经验，帮助大家了解微服务的优缺点，从而可以结合自身业务做出更加合适的选择，作为本篇文章的三个主题，例如：</p><ol><li>什么是微服务？为什么要用微服务？</li><li>微服务解决什么问题，又引入了什么问题？</li><li>使用微服务应该要遵循哪些原则？什么样的情况你不应该使用微服务？</li></ol><p>（PS：因为市面上太多对如果使用微服务框架工具的教程，所以本篇只是一篇关于微服务的总体概述性文章，不涉及各种微服务框架的安装和使用教程，我们只谈论微服务本身的设计模式的优缺点和适合应用的场景）</p><h3 id="一：什么是微服务？为什么要用微服务？"><a href="#一：什么是微服务？为什么要用微服务？" class="headerlink" title="一：什么是微服务？为什么要用微服务？"></a>一：什么是微服务？为什么要用微服务？</h3><p>什么是微服务？（熟悉的同学可以直接跳过）</p><p>简单举例：看军事新闻的同学应该都知道，一艘航空母舰作战能力虽然很强，但是弱点太明显，就是防御能力太差，单艘的航空母舰很少单独行动，通常航空母舰战斗群才是主要军事力量，你可以把单艘航母理解为的单体应用（防御差，机动性不好），把航母战斗群（调度复杂，维护费用高）理解为微服务。</p><p>大部分的开发者经历和开发过单体应用，无论是传统的 Servlet + JSP，还是 SSM，还是现在的 SpringBoot，它们都是单体应用，那么长期陪伴我们的单体应用有什么弊端？我们是面临了什么问题，导致我们要抛弃单体应用转向微服务架构？个人总结主要问题如下：</p><ul><li>部署成本高（无论是修改1行代码，还是10行代码，都要全量替换）</li><li>改动影响大，风险高（不论代码改动多小，成本都相同）</li><li>因为成本高，风险高，所以导致部署频率低（无法快速交付客户需求）</li></ul><p>当然还有例如无法满足快速扩容，弹性伸缩，无法适应云环境特性等问题，但我们不一一详谈了，以上的问题，都是微服务架构要解决的问题。</p><p><img src="/2020/09/24/%E5%BE%AE%E6%9C%8D%E5%8A%A1/microSer2.png" alt="img"></p><h3 id="二：微服务解决什么问题，又引入了什么问题？"><a href="#二：微服务解决什么问题，又引入了什么问题？" class="headerlink" title="二：微服务解决什么问题，又引入了什么问题？"></a>二：微服务解决什么问题，又引入了什么问题？</h3><p>我们先看看微服务能带给我们什么？微服务架构的特点：</p><ul><li>针对特定服务发布，影响小，风险小，成本低</li><li>频繁发布版本，快速交付需求</li><li>低成本扩容，弹性伸缩，适应云环境</li></ul><p>我们知道一个朴素的理念，没有任何事物是完美的，任何东西都有两面性，有得必有失，那么在选择微服务在解决了快速响应和弹性伸缩的问题同时，它又给我们带来了什么问题？个人总结如下：</p><ul><li>分布式系统的复杂性</li><li>部署，测试和监控的成本问题</li><li>分布式事务和CAP的相关问题</li></ul><p>系统应用由原来的单体变成几十到几百个不同的工程，会所产生例如包括服务间的依赖，服务如何拆封，内部接口规范，数据传递等等问题，尤其是服务拆分，需要团队熟悉业务流程，懂得取舍，要保证拆分的粒度服务既符合“高内聚，低耦合”的基本原则，还要兼顾业务的发展以及公司的愿景，要还要说服团队成员为之努力，并且积极投入，在多方中间取得平衡。</p><p>对于分布式系统，部署，测试和监控都需要大量的中间件来支撑，而且中间件本身也要维护，原先单体应用很简单的事务问题 ，转到分布式环境就变得很复杂，分布式事务是采用简单的重试+补偿机制，还是采用二阶段提交协议等强一致性方法来解决，就要取决对业务场景的熟悉加上反复的权衡了，相同问题还包括对 CAP 模型的权衡，总之微服务对团队整体的技术栈水平整体要求更高。</p><p><img src="/2020/09/24/%E5%BE%AE%E6%9C%8D%E5%8A%A1/microSer3.png" alt="img"></p><h3 id="三：使用微服务应该遵循哪些原则？"><a href="#三：使用微服务应该遵循哪些原则？" class="headerlink" title="三：使用微服务应该遵循哪些原则？"></a>三：使用微服务应该遵循哪些原则？</h3><p>古人云：兵马未动，粮草先行。建设微服务是需要建立长远规划，不是像写CMS那样建好数据库表，然后就开始干活，这样十有八九是会失败的。我们要进行微服务改造前，架构师要提前做好规划，我们把这里分为三步，前期阶段，设计阶段，技术阶段</p><p>前期阶段，大致要做好如下事情：</p><ul><li>和多方充分沟通，确保能符合客户和组织的需求，并且得到认同</li><li>和团队沟通，让队友（开发/测试/运维）理解，并且积极投入</li><li>和业务部门沟通，指定版本计划和上线时间</li></ul><p>设计阶段，参考 Sam Newman 的著作<a href="https://book.douban.com/subject/26772677/">《微服务设计》</a>，单微服务必须要满足以下的条件，才符合微服务的基本要求：</p><ul><li>标准的 REST 风格接口（基于 HTTP 和 JSON 格式）</li><li>独立部署，避免共享数据库（避免因为数据库而影响整个分布式系统）</li><li>业务上的高内聚，减少依赖（从设计上要避免服务过大或者太小）</li></ul><p>庞大的分布式系统，需要强大基础设施来支撑，微服务涉及哪些基础设施？</p><ul><li>CI/CD和自动化（分布式系统几乎不可能通过人工手动发布）</li><li>虚拟化技术（要保证微服务运行环境隔离，目前行业主流的是使用 Docker 容器）</li><li>日志聚合，全链路监控（高度可观察和分析诊断问题）</li></ul><p>说了那么多，那什么样的情况下，你的团队不适合建设微服务？（请勿对号入座）</p><ol><li>开发团队不具备自主性，所在组织对开发团队限制非常多（具体请参考 <a href="https://zh.wikipedia.org/wiki/%E5%BA%B7%E5%A8%81%E5%AE%9A%E5%BE%8B">康威定律</a>）</li><li>团队不熟悉业务，无法识别出服务的边界，进行合理的拆分（请参考 DDD <a href="https://en.wikipedia.org/wiki/Domain-driven_design">领域驱动设计</a>）</li></ol><p><img src="/2020/09/24/%E5%BE%AE%E6%9C%8D%E5%8A%A1/microSer4.png" alt="img"></p><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>微服务设计其实是很早就有的设计思想，因为随着虚拟化技术的崛起，微服务可以低成本的实现，所以也开始流行和兴起。</p><p>微服务的内涵很深，其中就包括，自动化，去中心化，独立性等等，其中细节无法用一篇文章概述清楚，我们在做技术选型或者方案的时候，尽可能多去了解技术的本身和起源再结合我们业务的特点，进行更好的选择。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;什么是微服务？为什么要用微服务？&quot;&gt;&lt;a href=&quot;#什么是微服务？为什么要用微服务？&quot; class=&quot;headerlink&quot; title=&quot;什么是微服务？为什么要用微服务？&quot;&gt;&lt;/a&gt;什么是微服务？为什么要用微服务？&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/202</summary>
      
    
    
    
    <category term="架构" scheme="http://example.com/categories/%E6%9E%B6%E6%9E%84/"/>
    
    
    <category term="微服务" scheme="http://example.com/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>DevOps</title>
    <link href="http://example.com/2020/09/24/DevOps/"/>
    <id>http://example.com/2020/09/24/DevOps/</id>
    <published>2020-09-24T06:36:24.000Z</published>
    <updated>2020-09-24T06:42:12.699Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DevOps"><a href="#DevOps" class="headerlink" title="DevOps"></a>DevOps</h1><p>DevOps（Development+Operations）强调共同对业务目标负责，以实现用户价值作为唯一的评判标准：保证产品功能及时实现、成功部署和稳定使用；</p><ul><li>是一种重视软件开发人员（Dev）和IT运维技术人员（Ops）之间沟通合作的文化、运动或惯例，改善团队之间的协作关系；</li><li>是一组过程、方法与系统的统称，包含开发、测试和运维；</li><li>用于促进开发（应用程序/软件工程）、技术运营和质量保障（QA）部门之间的沟通、协作与整合；</li><li>透过自动化“软件交付”和“架构变更”的流程，使得构建、测试、发布软件能够更加地快捷、频繁和可靠，按时交付软件产品和服务；</li></ul><p><img src="/2020/09/24/DevOps/devops1.png" alt="img"></p><p>从定义来看，其实devops就是为了让开发、运维和QA可以高效协作的流程。（可以把DevOps看作开发、技术运营和质量保障（QA）三者的交集。）</p><p>总的说来：</p><ul><li>DevOps 是把人员、流程、产品进行结合，给用户提供持续价值的一个过程，既涉及到人员、流程、工具，也涉及到产品。</li><li>DevOps 最终目的是给客户提供持续交付的价值，流程包括：产品的规划跟踪、软件开发、构建测试、产品部署、运维、监控和优化。</li><li>通常把 DevOps 这些流程通过一个流水线的方式串联起来称为一个 DevOps 的流水线，其核心目标就是持续给用户交付有价值的产品。</li></ul><p>简而言之，DevOps不仅涉及技术背景，还包括非技术的文化方面。<br>在软件开发和应用周期中，提供了一个机制或模式来培育“协作”意识，帮助不同角色的成员紧密协作，充分利用现有资源，遵循交付的商业价值，共同对“输出”负责，对质量负责。</p><h2 id="DevOps的好处与价值"><a href="#DevOps的好处与价值" class="headerlink" title="DevOps的好处与价值"></a>DevOps的好处与价值</h2><p>对于业务与产品而言，DevOps的好处更多基于持续部署与交付。<br>从组织结构而言，DevOps是部门间沟通协作的一组流程和方法，有助于改善公司组织文化、提高员工的参与感。</p><ul><li>代码的提交直接触发：消除等待时间，快速反馈</li><li>每个变化对应一个交付管道：使问题定位和调试变得简单</li><li>全开发流程高效自动化：稳定，快速，交付结果可预测</li><li>持续进行自动化回归测试：提升交付质量</li><li>设施共享并按需提供：资源利用最大化</li></ul><h2 id="可能的几个关注点"><a href="#可能的几个关注点" class="headerlink" title="可能的几个关注点"></a>可能的几个关注点</h2><p>DevOps绝不是推荐一定要在某一方面达到极致，而是从“整体”入手，充分激发“体系”的最佳效率。</p><ul><li>虽然真正实现DevOps的成本高昂，但任何时候都是实现DevOps的最佳时机，因为随着业务发展，成本一定是越来越高的；</li><li>组织文化上的变革，鼓励不同的个体与部门共同协作，减少“内耗”；</li><li>合适的DevOps人员（最起码保证在“向DevOps转换阶段”中，研发人员知晓运维，运维人员了解业务）；</li><li>统一的标准、环境、工具、流程，例如：开发/测试环境尽可能地和生产环境保持一致；</li><li>自动化和持续交付，简化重复性工作和减少不必要的等待</li><li>涉及多个技术支撑：敏捷开发、持续集成&amp;部署、微服务、容器、云环境等；</li><li>个体和团队的成效都放在整个产品开发&amp;运维生命周期内来进行评价；</li></ul><h2 id="DevOps能力环"><a href="#DevOps能力环" class="headerlink" title="DevOps能力环"></a>DevOps能力环</h2><p><img src="/2020/09/24/DevOps/devops2.png" alt="img"></p><h2 id="DevOps与持续集成、持续交付"><a href="#DevOps与持续集成、持续交付" class="headerlink" title="DevOps与持续集成、持续交付"></a>DevOps与持续集成、持续交付</h2><p>DevOps的应用场景往往是一个庞大复杂的背景和流程的场景，大都包含一个持续交付流水线。</p><ul><li>开发人员：IDE、Git等开发和编译工具</li><li>版本控制系统：分支策略、语义化版本</li><li>构建服务器：持续集成、代码质量检查</li><li>工件库：存放二进制包</li><li>系统的包管理器：编译或测试环境系统上管理二进制包</li><li>环境一致性</li><li>预发布或生产：预发布环境与生产环境互换（蓝绿发布）</li><li>发布管理：在高程度自动化测试的基础上实践自动化或半自动化（人工介入）部署</li><li>问题管理系统</li><li>。。。。。。<br>因此，DevOps 是一个完整的面向IT运维的工作流，以 IT 自动化以及持续集成（CI）、持续部署（CD）为基础，来优化程式开发、测试、系统运维等所有环节。<br>DevOps的技术要点由“持续集成/部署“”一线贯穿，主干开发是进行持续集成的前提，自动化以及代码周边集中管理是实施持续集成的必要条件。<br>换而言之，DevOps 是持续集成思想的延伸，持续集成/部署是 DevOps 的技术核心，在没有自动化测试、持续集成/部署之下，DevOps就是空中楼阁。</li></ul><h2 id="一个完整的过程"><a href="#一个完整的过程" class="headerlink" title="一个完整的过程"></a>一个完整的过程</h2><ol><li>开发团队接到任务，需要完成一个变更</li><li>为了更加顺利地开发，将这个变更分拆为几个小变更</li><li>开发人员在本地开发并且测试，如果使用了测试驱动开发，在编写功能代码之前会先编写测试，然后编写能够让测试通过的实际代码</li><li>开发人员将代码提交到企业内部的Git版本控制系统上</li><li>构建服务器获取这个变更并初始化构建流程，单元测试之后，变更可以被发布到二进制库里</li><li>配置管理系统根据“策略”，在测试环境中安装应用了新的变更</li><li>新安装触发自动化回归测试，测试成功后，质量保证团队开始做人工测试</li><li>人工测试通过后，质量保证团队将“已通过”标识给予这个变革</li><li>变更在预发布环境中进行验收测试</li><li>验收测试完成后，预发布环境被切换成生产环境，而生产环境变为新的预发布环境</li></ol><h2 id="典型的CICD流水线过程"><a href="#典型的CICD流水线过程" class="headerlink" title="典型的CICD流水线过程"></a>典型的CICD流水线过程</h2><ol><li>项目开发编写代码，然后把代码推送到 GitLab 里存储，通过 GitLab 的 hook 使 Jenkins 执行一些 CI 的过程，比如做一些单元测试，构建 Docker image</li><li>再把这个 Docker image 调用 helm 部署到开发环境或测试环境</li><li>在测试环境里通过 Jenkins 触发一个集成测试的功能</li><li>完成后就可以把它部署到生产环境</li><li>通过 Kubernetes addon 的方式，把 Prometheus、Grafana 等监控组件部署到集群里，实现一整套从 CI 到 CD 的监控过程<br><img src="/2020/09/24/DevOps/devops3.png" alt="img"></li></ol><h2 id="DevOps黄金思维圈"><a href="#DevOps黄金思维圈" class="headerlink" title="DevOps黄金思维圈"></a>DevOps黄金思维圈</h2><p>时刻关注正在做什么，尝试识别问题范围，找出解决方案和改善途径。<br>Why—》How—》What</p><h3 id="Why（目的、理念）"><a href="#Why（目的、理念）" class="headerlink" title="Why（目的、理念）"></a>Why（目的、理念）</h3><p>持续且快速、可靠的自动交付软件给用户：</p><ol><li>实现价值的持续交付，赢得市场竞争</li><li>提升研发（增值活动）的时间，极大化增值活动产出</li></ol><h3 id="How（方法、措施）"><a href="#How（方法、措施）" class="headerlink" title="How（方法、措施）"></a>How（方法、措施）</h3><ul><li>建设自动化、可重复、可靠的持续交付流水线（IT服务供应链）</li><li>主要包括代码管理、持续集成、自动化测试、自动化部署、基础设施自动化管理等方面的工程能力</li></ul><h3 id="What（现象、成果）"><a href="#What（现象、成果）" class="headerlink" title="What（现象、成果）"></a>What（现象、成果）</h3><ol><li>每次代码提交都需要经过流水线验证</li><li>每次部署的版本都经过多环境验证</li><li>部署频率可以得到提升</li><li>周期时间（从代码提交到部署上线）的时间可以到分钟级</li><li>部署失败率低</li><li>部署失败的修复时间短，影响小</li></ol><h1 id="一些图示"><a href="#一些图示" class="headerlink" title="一些图示"></a>一些图示</h1><h2 id="关系与演进"><a href="#关系与演进" class="headerlink" title="关系与演进"></a>关系与演进</h2><p><img src="/2020/09/24/DevOps/devops4.png" alt="img"></p><h2 id="涉及的工具"><a href="#涉及的工具" class="headerlink" title="涉及的工具"></a>涉及的工具</h2><p>DevOps的目标不是单靠一款工具就能实现的。<br>在各个阶段，每个都有其单独对应的目标。<br>依赖于组织的选择，有着各种各样的工具可以在相应的背景和趋势下，实现当前业务目标，满足中远期的需求。<br><img src="/2020/09/24/DevOps/devops5.jpg" alt="img"></p><p><img src="/2020/09/24/DevOps/devops6.png" alt="img"></p><p><strong>DevOps对应用程序发布的影响</strong></p><p>在很多企业中，应用程序发布是一项涉及多个团队、压力很大、风险很高的活动。然而在具备DevOps能力的组织中，应用程序发布的风险很低，原因如下 [2] ：</p><p><strong>（1）减少变更范围</strong></p><p>与传统的瀑布模式模型相比，采用敏捷或迭代式开发意味着更频繁的发布、每次发布包含的变化更少。由于部署经常进行，因此每次部署不会对生产系统造成巨大影响，应用程序会以平滑的速率逐渐生长。</p><p><strong>（2）加强发布协调</strong></p><p>靠强有力的发布协调人来弥合开发与运营之间的技能鸿沟和沟通鸿沟；采用电子数据表、电话会议和企业门户（wiki、sharepoint）等协作工具来确保所有相关人员理解变更的内容并全力合作。</p><p><strong>（3）自动化</strong></p><p>强大的部署自动化手段确保部署任务的可重复性、减少部署出错的可能性。</p><p>与传统开发方法那种大规模的、不频繁的发布（通常以“季度”或“年”为单位）相比，敏捷方法大大提升了发布频率（通常以“天”或“周”为单位）。</p><p><strong>实现DevOps需要什么？</strong></p><p><strong>硬性要求：工具上的准备</strong></p><p>上文提到了工具链的打通，那么工具自然就需要做好准备。现将工具类型及对应的不完全列举整理如下：</p><p>代码管理（SCM）：<strong>GitHub</strong>、GitLab、BitBucket、SubVersion</p><p>构建工具：<strong>Ant</strong>、Gradle、<strong>maven</strong></p><p>自动部署：Capistrano、CodeDeploy</p><p>持续集成（CI）：Bamboo、Hudson、Jenkins</p><p>配置管理：Ansible、Chef、Puppet、SaltStack、ScriptRock GuardRail</p><p>容器：<strong>Docker</strong>、LXC、第三方厂商如AWS</p><p>编排：Kubernetes、Core、Apache Mesos、DC/OS</p><p>服务注册与发现：<strong>Zookeeper</strong>、etcd、Consul</p><p>脚本语言：python、ruby、shell</p><p>日志管理：ELK、Logentries</p><p>系统监控：Datadog、Graphite、Icinga、Nagios</p><p>性能监控：AppDynamics、New Relic、Splunk</p><p>压力测试：JMeter、Blaze Meter、loader.io</p><p>预警：PagerDuty、pingdom、厂商自带如AWS SNS</p><p>HTTP加速器：Varnish</p><p>消息总线：ActiveMQ、SQS</p><p>应用服务器：Tomcat、JBoss</p><p>Web服务器：Apache、Nginx、IIS</p><p>数据库：MySQL、Oracle、PostgreSQL等关系型数据库；cassandra、mongoDB、redis等NoSQL数据库</p><p>项目管理（PM）：Jira、Asana、Taiga、Trello、Basecamp、Pivotal Tracker</p><p>在工具的选择上，需要结合公司业务需求和技术团队情况而定。（注：更多关于工具的详细介绍可以参见此文：51 Best DevOps Tools for #DevOps Engineers）</p><p><strong>软性需求：文化和人</strong></p><p>DevOps成功与否，公司组织是否利于协作是关键。开发人员和运维人员可以良好沟通互相学习，从而拥有高生产力。并且协作也存在于业务人员与开发人员之间。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;DevOps&quot;&gt;&lt;a href=&quot;#DevOps&quot; class=&quot;headerlink&quot; title=&quot;DevOps&quot;&gt;&lt;/a&gt;DevOps&lt;/h1&gt;&lt;p&gt;DevOps（Development+Operations）强调共同对业务目标负责，以实现用户价值作为唯一的</summary>
      
    
    
    
    <category term="敏捷开发" scheme="http://example.com/categories/%E6%95%8F%E6%8D%B7%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="DevOps" scheme="http://example.com/tags/DevOps/"/>
    
  </entry>
  
  <entry>
    <title>Nginx功能及配置</title>
    <link href="http://example.com/2020/09/21/Nginx%E5%8A%9F%E8%83%BD%E5%8F%8A%E9%85%8D%E7%BD%AE/"/>
    <id>http://example.com/2020/09/21/Nginx%E5%8A%9F%E8%83%BD%E5%8F%8A%E9%85%8D%E7%BD%AE/</id>
    <published>2020-09-21T05:09:32.000Z</published>
    <updated>2020-09-21T05:10:54.482Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Nginx功能概述"><a href="#Nginx功能概述" class="headerlink" title="Nginx功能概述"></a>Nginx功能概述</h1><p><strong><strong>HTTP基础功能：</strong></strong></p><ul><li>处理静态文件，索引文件以及自动索引；</li><li>反向代理加速(无缓存)，简单的负载均衡和容错；</li><li>FastCGI，简单的负载均衡和容错；</li><li>模块化的结构。过滤器包括gzipping, byte ranges, chunked responses, 以及 SSI-filter 。在SSI过滤器中，到同一个 proxy 或者 FastCGI 的多个子请求并发处理；</li><li>SSL 和 TLS SNI 支持；</li></ul><p><strong><strong>IMAP/POP3 代理服务功能：</strong></strong></p><ul><li>使用外部 HTTP 认证服务器重定向用户到 IMAP/POP3 后端；</li><li>使用外部 HTTP 认证服务器认证用户后连接重定向到内部的 SMTP 后端；</li><li>认证方法：</li><li>POP3: POP3 USER/PASS, APOP, AUTH LOGIN PLAIN CRAM-MD5;</li><li>IMAP: IMAP LOGIN;</li><li>SMTP: AUTH LOGIN PLAIN CRAM-MD5;</li><li>SSL 支持；</li><li>在 IMAP 和 POP3 模式下的 STARTTLS 和 STLS 支持；</li></ul><p><strong><strong>支持的操作系统：</strong></strong></p><ul><li>FreeBSD 3.x, 4.x, 5.x, 6.x i386; FreeBSD 5.x, 6.x amd64;</li><li>Linux 2.2, 2.4, 2.6 i386; Linux 2.6 amd64;</li><li>Solaris 8 i386; Solaris 9 i386 and sun4u; Solaris 10 i386;</li><li>MacOS X (10.4) PPC;</li></ul><p><strong><strong>结构与扩展：</strong></strong></p><ul><li>一个主进程和多个工作进程。工作进程是单线程的，且不需要特殊授权即可运行；</li><li>kqueue (FreeBSD 4.1+), epoll (Linux 2.6+), rt signals (Linux 2.2.19+), /dev/poll (Solaris 7 11/99+), select, 以及 poll 支持；</li><li>kqueue支持的不同功能包括 EV_CLEAR, EV_DISABLE （临时禁止事件）， NOTE_LOWAT, EV_EOF, 有效数据的数目，错误代码；</li><li>sendfile (FreeBSD 3.1+), sendfile (Linux 2.2+), sendfile64 (Linux 2.4.21+), 和 sendfilev (Solaris 8 7/01+) 支持；</li><li>输入过滤 (FreeBSD 4.1+) 以及 TCP_DEFER_ACCEPT (Linux 2.4+) 支持；</li><li>10,000 非活动的 HTTP keep-alive 连接仅需要 2.5M 内存。</li><li>最小化的数据拷贝操作；</li></ul><p><strong><strong>其他HTTP功能：</strong></strong></p><ul><li>基于IP 和名称的虚拟主机服务；</li><li>Memcached 的 GET 接口；</li><li>支持 keep-alive 和管道连接；</li><li>灵活简单的配置；</li><li>重新配置和在线升级而无须中断客户的工作进程；</li><li>可定制的访问日志，日志写入缓存，以及快捷的日志回卷；</li><li>4xx-5xx 错误代码重定向；</li><li>基于 PCRE 的 rewrite 重写模块；</li><li>基于客户端 IP 地址和 HTTP 基本认证的访问控制；</li><li>PUT, DELETE, 和 MKCOL 方法；</li><li>支持 FLV （Flash 视频）；</li><li>带宽限制；</li></ul><p><strong><strong>实验特性：</strong></strong></p><ul><li>内嵌的<code>perl</code></li><li>通过<code>aio_read() / aio_write()</code>的套接字工作的实验模块，仅在 FreeBSD 下。</li><li>对线程的实验化支持，FreeBSD 4.x 的实现基于 rfork()</li></ul><p>Nginx 主要的英语站点是 <a href="http://sysoev.ru/en/">http://sysoev.ru/en/</a></p><p>英语文档草稿由 Aleksandar Lazic 完成 <a href="http://nginx.net/">点击</a> 。</p><h1 id="Nginx安装"><a href="#Nginx安装" class="headerlink" title="Nginx安装"></a>Nginx安装</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">nginx可以使用各平台的默认包来安装，本文是介绍使用源码编译安装，包括具体的编译参数信息。</span></span><br><span class="line"></span><br><span class="line"><span class="string">正式开始前，编译环境gcc</span> <span class="string">g++</span> <span class="string">开发库之类的需要提前装好，这里默认你已经装好。</span></span><br><span class="line"></span><br><span class="line"><span class="string">ububtu平台编译环境可以使用以下指令</span></span><br><span class="line"><span class="string">apt-get</span> <span class="string">install</span> <span class="string">build-essential</span></span><br><span class="line"><span class="string">apt-get</span> <span class="string">install</span> <span class="string">libtool</span></span><br><span class="line"><span class="string">centos平台编译环境使用如下指令</span></span><br><span class="line"></span><br><span class="line"><span class="string">安装make：</span></span><br><span class="line"><span class="string">yum</span> <span class="string">-y</span> <span class="string">install</span> <span class="string">gcc</span> <span class="string">automake</span> <span class="string">autoconf</span> <span class="string">libtool</span> <span class="string">make</span></span><br><span class="line"><span class="string">安装g++:</span></span><br><span class="line"><span class="string">yum</span> <span class="string">install</span> <span class="string">gcc</span> <span class="string">gcc-c++</span></span><br><span class="line"><span class="string">下面正式开始</span></span><br><span class="line"><span class="string">---------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">一般我们都需要先装pcre,</span> <span class="string">zlib，前者为了重写rewrite，后者为了gzip压缩。</span></span><br><span class="line"><span class="number">1</span><span class="string">.选定源码目录</span></span><br><span class="line"><span class="string">可以是任何目录，本文选定的是/usr/local/src</span></span><br><span class="line"><span class="string">cd</span> <span class="string">/usr/local/src</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span><span class="string">.安装PCRE库</span></span><br><span class="line"><span class="string">https://ftp.pcre.org/pub/pcre/</span> <span class="string">下载最新的</span> <span class="string">PCRE</span> <span class="string">源码包，使用下面命令下载编译和安装</span> <span class="string">PCRE</span> <span class="string">包：</span></span><br><span class="line"><span class="string">cd</span> <span class="string">/usr/local/src</span></span><br><span class="line"><span class="string">wget</span> <span class="string">https://ftp.pcre.org/pub/pcre/pcre-8.44.tar.gz</span> </span><br><span class="line"><span class="string">tar</span> <span class="string">-zxvf</span> <span class="string">pcre-8.44.tar.gz</span></span><br><span class="line"><span class="string">cd</span> <span class="string">pcre-8.44</span></span><br><span class="line"><span class="string">./configure</span></span><br><span class="line"><span class="string">make</span></span><br><span class="line"><span class="string">make</span> <span class="string">install</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span><span class="string">.安装zlib库</span></span><br><span class="line"><span class="string">http://zlib.net/zlib-1.2.11.tar.gz</span> <span class="string">下载最新的</span> <span class="string">zlib</span> <span class="string">源码包，使用下面命令下载编译和安装</span> <span class="string">zlib包：</span></span><br><span class="line"><span class="string">cd</span> <span class="string">/usr/local/src</span></span><br><span class="line"><span class="string">wget</span> <span class="string">http://zlib.net/zlib-1.2.11.tar.gz</span></span><br><span class="line"><span class="string">tar</span> <span class="string">-zxvf</span> <span class="string">zlib-1.2.11.tar.gz</span></span><br><span class="line"><span class="string">cd</span> <span class="string">zlib-1.2.11</span></span><br><span class="line"><span class="string">./configure</span></span><br><span class="line"><span class="string">make</span></span><br><span class="line"><span class="string">make</span> <span class="string">install</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span><span class="string">.安装ssl（某些vps默认没装ssl)</span></span><br><span class="line"><span class="string">cd</span> <span class="string">/usr/local/src</span></span><br><span class="line"><span class="string">wget</span> <span class="string">https://www.openssl.org/source/openssl-1.1.1g.tar.gz</span></span><br><span class="line"><span class="string">tar</span> <span class="string">-zxvf</span> <span class="string">openssl-1.1.1g.tar.gz</span></span><br><span class="line"><span class="number">5</span><span class="string">.安装nginx</span></span><br><span class="line"></span><br><span class="line"><span class="string">Nginx</span> <span class="string">一般有两个版本，分别是稳定版和开发版，您可以根据您的目的来选择这两个版本的其中一个，下面是把</span> <span class="string">Nginx</span> <span class="string">安装到</span> <span class="string">/usr/local/nginx</span> <span class="string">目录下的详细步骤：</span></span><br><span class="line"></span><br><span class="line"><span class="string">cd</span> <span class="string">/usr/local/src</span></span><br><span class="line"><span class="string">wget</span> <span class="string">http://nginx.org/download/nginx-1.18.0.tar.gz</span></span><br><span class="line"><span class="string">tar</span> <span class="string">-zxvf</span> <span class="string">nginx-1.18.0.tar.gz</span></span><br><span class="line"><span class="string">cd</span> <span class="string">nginx-1.18.0</span></span><br><span class="line"> </span><br><span class="line"><span class="string">./configure</span> <span class="string">--sbin-path=/usr/local/nginx/nginx</span> <span class="string">\</span></span><br><span class="line"><span class="string">--conf-path=/usr/local/nginx/nginx.conf</span> <span class="string">\</span></span><br><span class="line"><span class="string">--pid-path=/usr/local/nginx/nginx.pid</span> <span class="string">\</span></span><br><span class="line"><span class="string">--with-http_gzip_static_module</span> <span class="string">\</span></span><br><span class="line"><span class="string">--with-http_stub_status_module</span> <span class="string">\</span></span><br><span class="line"><span class="string">--with-file-aio</span> <span class="string">\</span></span><br><span class="line"><span class="string">--with-http_realip_module</span> <span class="string">\</span></span><br><span class="line"><span class="string">--with-http_ssl_module</span> <span class="string">\</span></span><br><span class="line"><span class="string">--with-pcre=/usr/local/src/pcre-8.44</span> <span class="string">\</span></span><br><span class="line"><span class="string">--with-zlib=/usr/local/src/zlib-1.2.11</span> <span class="string">\</span></span><br><span class="line"><span class="string">--with-openssl=/usr/local/src/openssl-1.1.1g</span></span><br><span class="line"> </span><br><span class="line"><span class="string">make</span> <span class="string">-j2</span></span><br><span class="line"><span class="string">make</span> <span class="string">install</span></span><br><span class="line"><span class="string">--with-pcre=/usr/local/src/pcre-8.44</span> <span class="string">指的是pcre-8.44</span> <span class="string">的源码路径。</span></span><br><span class="line"><span class="string">--with-zlib=/usr/local/src/zlib-1.2.11指的是zlib-1.2.11</span> <span class="string">的源码路径。</span></span><br><span class="line"></span><br><span class="line"><span class="string">安装成功后</span> <span class="string">/usr/local/nginx</span> <span class="string">目录下如下</span></span><br><span class="line"><span class="string">fastcgi.conf</span>            <span class="string">koi-win</span>             <span class="string">nginx.conf.default</span></span><br><span class="line"><span class="string">fastcgi.conf.default</span>    <span class="string">logs</span>                <span class="string">scgi_params</span></span><br><span class="line"><span class="string">fastcgi_params</span>          <span class="string">mime.types</span>          <span class="string">scgi_params.default</span></span><br><span class="line"><span class="string">fastcgi_params.default</span>  <span class="string">mime.types.default</span>  <span class="string">uwsgi_params</span></span><br><span class="line"><span class="string">html</span>                    <span class="string">nginx</span>               <span class="string">uwsgi_params.default</span></span><br><span class="line"><span class="string">koi-utf</span>                 <span class="string">nginx.conf</span>          <span class="string">win-utf</span></span><br><span class="line"></span><br><span class="line"><span class="number">6</span><span class="string">.启动</span></span><br><span class="line"><span class="string">确保系统的</span> <span class="number">80</span> <span class="string">端口没被其他程序占用，运行/usr/local/nginx/nginx</span> <span class="string">命令来启动</span> <span class="string">Nginx，</span></span><br><span class="line"><span class="string">netstat</span> <span class="string">-ano|grep</span> <span class="number">80</span></span><br><span class="line"><span class="string">如果查不到结果后执行，有结果则忽略此步骤（ubuntu下必须用sudo启动，不然只能在前台运行）</span></span><br><span class="line"></span><br><span class="line"><span class="string">sudo</span> <span class="string">/usr/local/nginx/nginx</span></span><br><span class="line"><span class="string">打开浏览器访问此机器的</span> <span class="string">IP，如果浏览器出现</span> <span class="string">Welcome</span> <span class="string">to</span> <span class="string">nginx!</span> <span class="string">则表示</span> <span class="string">Nginx</span> <span class="string">已经安装并运行成功。</span></span><br><span class="line"></span><br><span class="line"><span class="type">![nginx](nginx11.png)</span></span><br><span class="line"></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="string">到这里nginx就安装完成了，如果只是处理静态html就不用继续安装了</span></span><br><span class="line"></span><br><span class="line"><span class="string">如果你需要处理php脚本的话，还需要安装php-fpm。</span></span><br><span class="line"></span><br><span class="line"><span class="string">下面安装排错</span></span><br><span class="line"></span><br><span class="line"><span class="string">附：可能遇到的错误和一些帮助信息</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.1</span><span class="string">编译pcre错误</span></span><br><span class="line"><span class="attr">libtool: compile:</span> <span class="string">unrecognized</span> <span class="string">option</span> <span class="string">`-DHAVE_CONFIG_H&#x27;</span></span><br><span class="line"><span class="attr">libtool: compile:</span> <span class="string">Try</span> <span class="string">`libtool</span> <span class="string">--help&#x27;</span> <span class="string">for</span> <span class="string">more</span> <span class="string">information.</span></span><br><span class="line"><span class="string">make[1]:</span> <span class="string">***</span> [<span class="string">pcrecpp.lo</span>] <span class="string">Error</span> <span class="number">1</span></span><br><span class="line"><span class="string">make[1]:</span> <span class="string">Leaving</span> <span class="string">directory</span> <span class="string">`/usr/local/src/pcre-8.34&#x27;</span></span><br><span class="line"><span class="attr">make:</span> <span class="string">***</span> [<span class="string">all</span>] <span class="string">Error</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="type">![nginx](nginx22.png)</span></span><br><span class="line"></span><br><span class="line"><span class="string">解决办法：安装g++,别忘了重新configure</span></span><br><span class="line"><span class="string">apt-get</span> <span class="string">install</span> <span class="string">g++</span></span><br><span class="line"><span class="string">apt-get</span> <span class="string">install</span> <span class="string">build-essential</span></span><br><span class="line"><span class="string">make</span> <span class="string">clean</span></span><br><span class="line"><span class="string">./configure</span></span><br><span class="line"><span class="string">make</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.2</span> <span class="string">make出错</span></span><br><span class="line"><span class="attr">make:</span> <span class="string">***</span> <span class="literal">No</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">make</span> <span class="string">target</span> <span class="string">`build&#x27;,</span> <span class="string">needed</span> <span class="string">by</span> <span class="string">`default&#x27;.</span>  <span class="string">Stop.</span></span><br><span class="line"><span class="string">./configure:</span> <span class="attr">error:</span> <span class="string">SSL</span> <span class="string">modules</span> <span class="string">require</span> <span class="string">the</span> <span class="string">OpenSSL</span> <span class="string">library.</span></span><br><span class="line"><span class="string">You</span> <span class="string">can</span> <span class="string">either</span> <span class="string">do</span> <span class="string">not</span> <span class="string">enable</span> <span class="string">the</span> <span class="string">modules,</span> <span class="string">or</span> <span class="string">install</span> <span class="string">the</span> <span class="string">OpenSSL</span> <span class="string">library</span></span><br><span class="line"><span class="string">into</span> <span class="string">the</span> <span class="string">system,</span> <span class="string">or</span> <span class="string">build</span> <span class="string">the</span> <span class="string">OpenSSL</span> <span class="string">library</span> <span class="string">statically</span> <span class="string">from</span> <span class="string">the</span> <span class="string">source</span></span><br><span class="line"><span class="string">with</span> <span class="string">nginx</span> <span class="string">by</span> <span class="string">using</span> <span class="string">--with-openssl=</span> <span class="string">option.</span></span><br><span class="line"><span class="string">按照第4步的安装方法或</span></span><br><span class="line"><span class="string">ubuntu下</span></span><br><span class="line"><span class="string">apt-get</span> <span class="string">install</span> <span class="string">openssl</span></span><br><span class="line"><span class="string">apt-get</span> <span class="string">install</span> <span class="string">libssl-dev</span></span><br><span class="line"><span class="string">centos下</span></span><br><span class="line"></span><br><span class="line"><span class="string">yum</span> <span class="string">-y</span> <span class="string">install</span> <span class="string">openssl</span> <span class="string">openssl-devel</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span><span class="string">nginx编译选项</span></span><br><span class="line"></span><br><span class="line"><span class="string">make是用来编译的，它从Makefile中读取指令，然后编译。</span></span><br><span class="line"></span><br><span class="line"><span class="string">make</span> <span class="string">install是用来安装的，它也从Makefile中读取指令，安装到指定的位置。</span></span><br><span class="line"></span><br><span class="line"><span class="string">configure命令是用来检测你的安装平台的目标特征的。它定义了系统的各个方面，包括nginx的被允许使用的连接处理的方法，比如它会检测你是不是有CC或GCC，并不是需要CC或GCC，它是个shell脚本，执行结束时，它会创建一个Makefile文件。nginx的configure命令支持以下参数：</span></span><br><span class="line"></span><br><span class="line"><span class="string">--prefix=path</span>    <span class="string">定义一个目录，存放服务器上的文件</span> <span class="string">，也就是nginx的安装目录。默认使用</span> <span class="string">/usr/local/nginx。</span></span><br><span class="line"><span class="string">--sbin-path=path</span> <span class="string">设置nginx的可执行文件的路径，默认为</span>  <span class="string">prefix/sbin/nginx.</span></span><br><span class="line"><span class="string">--conf-path=path</span>  <span class="string">设置在nginx.conf配置文件的路径。nginx允许使用不同的配置文件启动，通过命令行中的-c选项。默认为prefix/conf/nginx.conf.</span></span><br><span class="line"><span class="string">--pid-path=path</span>  <span class="string">设置nginx.pid文件，将存储的主进程的进程号。安装完成后，可以随时改变的文件名</span> <span class="string">，</span> <span class="string">在nginx.conf配置文件中使用</span> <span class="string">PID指令。默认情况下，文件名</span> <span class="string">为prefix/logs/nginx.pid.</span></span><br><span class="line"><span class="string">--error-log-path=path</span> <span class="string">设置主错误，警告，和诊断文件的名称。安装完成后，可以随时改变的文件名</span> <span class="string">，在nginx.conf配置文件中</span> <span class="string">使用</span> <span class="string">的error_log指令。默认情况下，文件名</span> <span class="string">为prefix/logs/error.log.</span></span><br><span class="line"><span class="string">--http-log-path=path</span>  <span class="string">设置主请求的HTTP服务器的日志文件的名称。安装完成后，可以随时改变的文件名</span> <span class="string">，在nginx.conf配置文件中</span> <span class="string">使用</span> <span class="string">的access_log指令。默认情况下，文件名</span> <span class="string">为prefix/logs/access.log.</span></span><br><span class="line"><span class="string">--user=name</span>  <span class="string">设置nginx工作进程的用户。安装完成后，可以随时更改的名称在nginx.conf配置文件中</span> <span class="string">使用的</span> <span class="string">user指令。默认的用户名是nobody。</span></span><br><span class="line"><span class="string">--group=name</span>  <span class="string">设置nginx工作进程的用户组。安装完成后，可以随时更改的名称在nginx.conf配置文件中</span> <span class="string">使用的</span> <span class="string">user指令。默认的为非特权用户。</span></span><br><span class="line"><span class="string">--with-select_module</span> <span class="string">--without-select_module</span> <span class="string">启用或禁用构建一个模块来允许服务器使用select()方法。该模块将自动建立，如果平台不支持的kqueue，epoll，rtsig或/dev/poll。</span></span><br><span class="line"><span class="string">--with-poll_module</span> <span class="string">--without-poll_module</span> <span class="string">启用或禁用构建一个模块来允许服务器使用poll()方法。该模块将自动建立，如果平台不支持的kqueue，epoll，rtsig或/dev/poll。</span></span><br><span class="line"><span class="string">--without-http_gzip_module</span> <span class="string">—</span> <span class="string">不编译压缩的HTTP服务器的响应模块。编译并运行此模块需要zlib库。</span></span><br><span class="line"><span class="string">--without-http_rewrite_module</span>  <span class="string">不编译重写模块。编译并运行此模块需要PCRE库支持。</span></span><br><span class="line"><span class="string">--without-http_proxy_module</span> <span class="string">—</span> <span class="string">不编译http_proxy模块。</span></span><br><span class="line"><span class="string">--with-http_ssl_module</span> <span class="string">—</span> <span class="string">使用https协议模块。默认情况下，该模块没有被构建。建立并运行此模块的OpenSSL库是必需的。</span></span><br><span class="line"><span class="string">--with-pcre=path</span> <span class="string">—</span> <span class="string">设置PCRE库的源码路径。PCRE库的源码（版本4.4</span> <span class="bullet">-</span> <span class="number">8.30</span><span class="string">）需要从PCRE网站下载并解压。其余的工作是Nginx的./</span> <span class="string">configure和make来完成。正则表达式使用在location指令和</span> <span class="string">ngx_http_rewrite_module</span> <span class="string">模块中。</span></span><br><span class="line"><span class="string">--with-pcre-jit</span> <span class="string">—编译PCRE包含“just-in-time</span> <span class="string">compilation”（1.1.12中，</span> <span class="string">pcre_jit指令）。</span></span><br><span class="line"><span class="string">--with-zlib=path</span> <span class="string">—设置的zlib库的源码路径。要下载从</span> <span class="string">zlib（版本1.1.3</span> <span class="bullet">-</span> <span class="number">1.2</span><span class="number">.5</span><span class="string">）的并解压。其余的工作是Nginx的./</span> <span class="string">configure和make完成。ngx_http_gzip_module模块需要使用zlib</span> <span class="string">。</span></span><br><span class="line"><span class="string">--with-cc-opt=parameters</span> <span class="string">—</span> <span class="string">设置额外的参数将被添加到CFLAGS变量。例如,当你在FreeBSD上使用PCRE库时需要使用:--with-cc-opt=&quot;-I</span> <span class="string">/usr/local/include。.如需要需要增加</span> <span class="string">select()支持的文件数量:--with-cc-opt=&quot;-D</span> <span class="string">FD_SETSIZE=2048&quot;.</span></span><br><span class="line"><span class="string">--with-ld-opt=parameters</span> <span class="string">—设置附加的参数，将用于在链接期间。例如，当在FreeBSD下使用该系统的PCRE库,应指定:--with-ld-opt=&quot;-L</span> <span class="string">/usr/local/lib&quot;.</span></span><br><span class="line"><span class="string">典型实例(下面为了展示需要写在多行，执行时内容需要在同一行)</span></span><br><span class="line"></span><br><span class="line"><span class="string">./configure</span></span><br><span class="line">    <span class="string">--sbin-path=/usr/local/nginx/nginx</span></span><br><span class="line">    <span class="string">--conf-path=/usr/local/nginx/nginx.conf</span></span><br><span class="line">    <span class="string">--pid-path=/usr/local/nginx/nginx.pid</span></span><br><span class="line">    <span class="string">--with-http_ssl_module</span></span><br><span class="line">    <span class="string">--with-pcre=../pcre-4.4</span></span><br><span class="line">    <span class="string">--with-zlib=../zlib-1.1.3</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="nginx基本配置与参数说明"><a href="#nginx基本配置与参数说明" class="headerlink" title="nginx基本配置与参数说明"></a>nginx基本配置与参数说明</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#运行用户</span></span><br><span class="line"><span class="string">user</span> <span class="string">nobody;</span></span><br><span class="line"><span class="comment">#启动进程,通常设置成和cpu的数量相等</span></span><br><span class="line"><span class="string">worker_processes</span>  <span class="number">1</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#全局错误日志及PID文件</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#工作模式及连接数上限</span></span><br><span class="line"><span class="string">events</span> &#123;</span><br><span class="line">    <span class="comment">#epoll是多路复用IO(I/O Multiplexing)中的一种方式,</span></span><br><span class="line">    <span class="comment">#仅用于linux2.6以上内核,可以大大提高nginx的性能</span></span><br><span class="line">    <span class="string">use</span>   <span class="string">epoll;</span> </span><br><span class="line"></span><br><span class="line">    <span class="comment">#单个后台worker process进程的最大并发链接数    </span></span><br><span class="line">    <span class="string">worker_connections</span>  <span class="number">1024</span><span class="string">;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 并发总数是 worker_processes 和 worker_connections 的乘积</span></span><br><span class="line">    <span class="comment"># 即 max_clients = worker_processes * worker_connections</span></span><br><span class="line">    <span class="comment"># 在设置了反向代理的情况下，max_clients = worker_processes * worker_connections / 4  为什么</span></span><br><span class="line">    <span class="comment"># 为什么上面反向代理要除以4，应该说是一个经验值</span></span><br><span class="line">    <span class="comment"># 根据以上条件，正常情况下的Nginx Server可以应付的最大连接数为：4 * 8000 = 32000</span></span><br><span class="line">    <span class="comment"># worker_connections 值的设置跟物理内存大小有关</span></span><br><span class="line">    <span class="comment"># 因为并发受IO约束，max_clients的值须小于系统可以打开的最大文件数</span></span><br><span class="line">    <span class="comment"># 而系统可以打开的最大文件数和内存大小成正比，一般1GB内存的机器上可以打开的文件数大约是10万左右</span></span><br><span class="line">    <span class="comment"># 我们来看看360M内存的VPS可以打开的文件句柄数是多少：</span></span><br><span class="line">    <span class="comment"># $ cat /proc/sys/fs/file-max</span></span><br><span class="line">    <span class="comment"># 输出 34336</span></span><br><span class="line">    <span class="comment"># 32000 &lt; 34336，即并发连接总数小于系统可以打开的文件句柄总数，这样就在操作系统可以承受的范围之内</span></span><br><span class="line">    <span class="comment"># 所以，worker_connections 的值需根据 worker_processes 进程数目和系统可以打开的最大文件总数进行适当地进行设置</span></span><br><span class="line">    <span class="comment"># 使得并发总数小于操作系统可以打开的最大文件数目</span></span><br><span class="line">    <span class="comment"># 其实质也就是根据主机的物理CPU和内存进行配置</span></span><br><span class="line">    <span class="comment"># 当然，理论上的并发总数可能会和实际有所偏差，因为主机还有其他的工作进程需要消耗系统资源。</span></span><br><span class="line">    <span class="comment"># ulimit -SHn 65535</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">http</span> &#123;</span><br><span class="line">    <span class="comment">#设定mime类型,类型由mime.type文件定义</span></span><br><span class="line">    <span class="string">include</span>    <span class="string">mime.types;</span></span><br><span class="line">    <span class="string">default_type</span>  <span class="string">application/octet-stream;</span></span><br><span class="line">    <span class="comment">#设定日志格式</span></span><br><span class="line">    <span class="string">log_format</span>  <span class="string">main</span>  <span class="string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">access_log</span>  <span class="string">logs/access.log</span>  <span class="string">main;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#sendfile 指令指定 nginx 是否调用 sendfile 函数（zero copy 方式）来输出文件，</span></span><br><span class="line">    <span class="comment">#对于普通应用，必须设为 on,</span></span><br><span class="line">    <span class="comment">#如果用来进行下载等应用磁盘IO重负载应用，可设置为 off，</span></span><br><span class="line">    <span class="comment">#以平衡磁盘与网络I/O处理速度，降低系统的uptime.</span></span><br><span class="line">    <span class="string">sendfile</span>     <span class="string">on;</span></span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#连接超时时间</span></span><br><span class="line">    <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">    <span class="string">keepalive_timeout</span>  <span class="number">65</span><span class="string">;</span></span><br><span class="line">    <span class="string">tcp_nodelay</span>     <span class="string">on;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#开启gzip压缩</span></span><br><span class="line">    <span class="string">gzip</span>  <span class="string">on;</span></span><br><span class="line">    <span class="string">gzip_disable</span> <span class="string">&quot;MSIE [1-6].&quot;</span><span class="string">;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#设定请求缓冲</span></span><br><span class="line">    <span class="string">client_header_buffer_size</span>    <span class="string">128k;</span></span><br><span class="line">    <span class="string">large_client_header_buffers</span>  <span class="number">4</span> <span class="string">128k;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#设定虚拟主机配置</span></span><br><span class="line">    <span class="string">server</span> &#123;</span><br><span class="line">        <span class="comment">#侦听80端口</span></span><br><span class="line">        <span class="string">listen</span>    <span class="number">80</span><span class="string">;</span></span><br><span class="line">        <span class="comment">#定义使用 www.nginx.cn访问</span></span><br><span class="line">        <span class="string">server_name</span>  <span class="string">www.nginx.cn;</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">#定义服务器的默认网站根目录位置</span></span><br><span class="line">        <span class="string">root</span> <span class="string">html;</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">#设定本虚拟主机的访问日志</span></span><br><span class="line">        <span class="string">access_log</span>  <span class="string">logs/nginx.access.log</span>  <span class="string">main;</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">#默认请求</span></span><br><span class="line">        <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">#定义首页索引文件的名称</span></span><br><span class="line">            <span class="string">index</span> <span class="string">index.php</span> <span class="string">index.html</span> <span class="string">index.htm;</span>   </span><br><span class="line">    </span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment"># 定义错误提示页面</span></span><br><span class="line">        <span class="string">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> <span class="string">/50x.html;</span></span><br><span class="line">        <span class="string">location</span> <span class="string">=</span> <span class="string">/50x.html</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">#静态文件，nginx自己处理</span></span><br><span class="line">        <span class="string">location</span> <span class="string">~</span> <span class="string">^/(images|javascript|js|css|flash|media|static)/</span> &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">#过期30天，静态文件不怎么更新，过期可以设大一点，</span></span><br><span class="line">            <span class="comment">#如果频繁更新，则可以设置得小一点。</span></span><br><span class="line">            <span class="string">expires</span> <span class="string">30d;</span></span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">#PHP 脚本请求全部转发到 FastCGI处理. 使用FastCGI默认配置.</span></span><br><span class="line">        <span class="string">location</span> <span class="string">~</span> <span class="string">.php$</span> &#123;</span><br><span class="line">            <span class="string">fastcgi_pass</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9000;</span></span><br><span class="line">            <span class="string">fastcgi_index</span> <span class="string">index.php;</span></span><br><span class="line">            <span class="string">fastcgi_param</span>  <span class="string">SCRIPT_FILENAME</span>  <span class="string">$document_root$fastcgi_script_name;</span></span><br><span class="line">            <span class="string">include</span> <span class="string">fastcgi_params;</span></span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">#禁止访问 .htxxx 文件</span></span><br><span class="line">            <span class="string">location</span> <span class="string">~</span> <span class="string">/.ht</span> &#123;</span><br><span class="line">            <span class="string">deny</span> <span class="string">all;</span></span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="运行和控制nginx"><a href="#运行和控制nginx" class="headerlink" title="运行和控制nginx"></a>运行和控制nginx</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">nginx命令行参数</span></span><br><span class="line"><span class="string">不像许多其他软件系统，Nginx</span> <span class="string">仅有几个命令行参数，完全通过配置文件来配置</span></span><br><span class="line"></span><br><span class="line"><span class="string">-c</span> <span class="string">&lt;/path/to/config&gt;</span> <span class="string">为</span> <span class="string">Nginx</span> <span class="string">指定一个配置文件，来代替缺省的。</span></span><br><span class="line"></span><br><span class="line"><span class="string">-t</span> <span class="string">不运行，而仅仅测试配置文件。nginx</span> <span class="string">将检查配置文件的语法的正确性，并尝试打开配置文件中所引用到的文件。</span></span><br><span class="line"></span><br><span class="line"><span class="string">-v</span> <span class="string">显示</span> <span class="string">nginx</span> <span class="string">的版本。</span></span><br><span class="line"></span><br><span class="line"><span class="string">-V</span> <span class="string">显示</span> <span class="string">nginx</span> <span class="string">的版本，编译器版本和配置参数。</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="string">nginx控制信号</span></span><br><span class="line"><span class="string">可以使用信号系统来控制主进程。默认，nginx</span> <span class="string">将其主进程的</span> <span class="string">pid</span> <span class="string">写入到</span> <span class="string">/usr/local/nginx/nginx.pid</span> <span class="string">文件中。通过传递参数给</span> <span class="string">./configure</span> <span class="string">或使用</span> <span class="string">pid</span> <span class="string">指令，来改变该文件的位置。</span></span><br><span class="line"></span><br><span class="line"><span class="string">主进程可以处理以下的信号：</span></span><br><span class="line"></span><br><span class="line"><span class="string">TERM,</span> <span class="string">INT</span><span class="string">快速关闭</span></span><br><span class="line"><span class="string">QUIT</span><span class="string">从容关闭</span></span><br><span class="line"><span class="string">HUP</span><span class="string">重载配置</span></span><br><span class="line"><span class="string">用新的配置开始新的工作进程</span></span><br><span class="line"><span class="string">从容关闭旧的工作进程</span></span><br><span class="line"><span class="string">USR1</span><span class="string">重新打开日志文件</span></span><br><span class="line"><span class="string">USR2</span><span class="string">平滑升级可执行程序。</span></span><br><span class="line"><span class="string">WINCH</span><span class="string">从容关闭工作进程</span></span><br><span class="line"><span class="string">尽管你不必自己操作工作进程，但是，它们也支持一些信号：</span></span><br><span class="line"></span><br><span class="line"><span class="string">TERM,</span> <span class="string">INT</span><span class="string">快速关闭</span></span><br><span class="line"><span class="string">QUIT</span><span class="string">从容关闭</span></span><br><span class="line"><span class="string">USR1</span><span class="string">重新打开日志文件</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="string">nginx</span> <span class="string">启动、停止、重启命令</span></span><br><span class="line"><span class="string">nginx启动</span></span><br><span class="line"></span><br><span class="line"><span class="string">sudo</span> <span class="string">/usr/local/nginx/nginx</span>     <span class="string">(nginx二进制文件绝对路径，可以根据自己安装路径实际决定)</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="string">nginx从容停止命令，等所有请求结束后关闭服务</span></span><br><span class="line"></span><br><span class="line"><span class="string">ps</span> <span class="string">-ef</span> <span class="string">|grep</span> <span class="string">nginx</span></span><br><span class="line"></span><br><span class="line"><span class="string">kill</span> <span class="string">-QUIT</span>  <span class="string">nginx主进程号</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="string">nginx</span> <span class="string">快速停止命令，立刻关闭nginx进程</span></span><br><span class="line"></span><br><span class="line"><span class="string">ps</span> <span class="string">-ef</span> <span class="string">|grep</span> <span class="string">nginx</span></span><br><span class="line"></span><br><span class="line"><span class="string">kill</span> <span class="string">-TERM</span> <span class="string">nginx主进程号</span> </span><br><span class="line"></span><br><span class="line"><span class="string">如果以上命令不管用，可以强制停止</span></span><br><span class="line"></span><br><span class="line"><span class="string">kill</span> <span class="number">-9</span> <span class="string">nginx主进程号</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="string">如果嫌麻烦可以不用查看进程号，直接使用命令进行操作</span></span><br><span class="line"><span class="string">其中/usr/local/nginx/nginx.pid</span> <span class="string">为nginx.conf中pid命令设置的参数，用来存放nginx主进程号的文件</span></span><br><span class="line"><span class="string">kill</span> <span class="string">-信号类型(HUP|TERM|QUIT)</span> <span class="string">cat</span> <span class="string">/usr/local/nginx/nginx.pid</span></span><br><span class="line"><span class="string">例如</span></span><br><span class="line"></span><br><span class="line"><span class="string">kill</span> <span class="string">-QUIT</span> <span class="string">`cat</span> <span class="string">/usr/local/nginx/nginx.pid`</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="string">kill</span> <span class="string">-QUIT</span> <span class="string">`cat</span> <span class="string">/usr/local/nginx/nginx.pid`</span></span><br><span class="line"><span class="string">nginx重启命令</span></span><br><span class="line"></span><br><span class="line"><span class="string">nginx重启可以分成几种类型</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span><span class="string">.简单型，先关闭进程，修改你的配置后，重启进程。</span></span><br><span class="line"><span class="string">kill</span> <span class="string">-QUIT</span> <span class="string">cat</span> <span class="string">/usr/local/nginx/nginx.pid</span></span><br><span class="line"><span class="string">sudo</span> <span class="string">/usr/local/nginx/nginx</span></span><br><span class="line"><span class="number">2</span><span class="string">.重新加载配置文件，不重启进程，不会停止处理请求</span></span><br><span class="line"><span class="number">3</span><span class="string">.平滑更新nginx二进制，不会停止处理请求</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="string">使用信号加载新的配置</span></span><br><span class="line"><span class="string">Nginx</span> <span class="string">支持几个信号，能在它运行时控制其操作。其中最普通的是</span> <span class="number">15</span> <span class="string">，用来中止运行的进程：</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &lt;strong&gt;ps aux | egrep &#x27;(PID|nginx)&#x27;&lt;/strong&gt;</span></span><br><span class="line"><span class="string">USER</span>       <span class="string">PID</span> <span class="string">%CPU</span> <span class="string">%MEM</span>    <span class="string">VSZ</span>   <span class="string">RSS</span> <span class="string">TTY</span>      <span class="string">STAT</span> <span class="string">START</span>   <span class="string">TIME</span> <span class="string">COMMAND</span></span><br><span class="line"><span class="string">root</span>      <span class="number">2213  </span><span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">6784  </span><span class="number">2036</span> <span class="string">?</span>        <span class="attr">Ss   03:01   0:00 nginx:</span> <span class="string">master</span> <span class="string">process</span> <span class="string">/usr/sbin/nginx</span> <span class="string">-c</span> <span class="string">/etc/nginx/nginx.conf</span></span><br><span class="line"><span class="comment"># &lt;strong&gt;kill -15 2213&lt;/strong&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &lt;strong&gt;ps aux | egrep &#x27;(PID|nginx)&#x27;&lt;/strong&gt;</span></span><br><span class="line"><span class="string">USER</span>       <span class="string">PID</span> <span class="string">%CPU</span> <span class="string">%MEM</span>    <span class="string">VSZ</span>   <span class="string">RSS</span> <span class="string">TTY</span>      <span class="string">STAT</span> <span class="string">START</span>   <span class="string">TIME</span> <span class="string">COMMAND</span></span><br><span class="line"><span class="string">root</span>      <span class="number">2213  </span><span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">6784  </span><span class="number">2036</span> <span class="string">?</span>        <span class="attr">Ss   03:01   0:00 nginx:</span> <span class="string">master</span> <span class="string">process</span> <span class="string">/usr/sbin/nginx</span> <span class="string">-c</span> <span class="string">/etc/nginx/nginx.conf</span></span><br><span class="line"><span class="comment"># &lt;strong&gt;kill -15 2213&lt;/strong&gt;</span></span><br><span class="line"><span class="string">而最有趣的是能平滑改变</span> <span class="string">nginx</span> <span class="string">配置的选项（请注意，在重载前，要先测试一下配置文件）：</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">#&lt;strong&gt; nginx -t -c /etc/nginx/nginx.conf&lt;/strong&gt;</span></span><br><span class="line"><span class="number">2006</span><span class="string">/09/16</span> <span class="number">13</span><span class="string">:07:10</span> [<span class="string">info</span>] <span class="number">15686</span><span class="comment">#0: the configuration file /etc/nginx/nginx.conf syntax is ok</span></span><br><span class="line"><span class="number">2006</span><span class="string">/09/16</span> <span class="number">13</span><span class="string">:07:10</span> [<span class="string">info</span>] <span class="number">15686</span><span class="comment">#0: the configuration file /etc/nginx/nginx.conf was tested successfully</span></span><br><span class="line"><span class="comment">#&lt;strong&gt; ps aux | egrep &#x27;(PID|nginx)&#x27;&lt;/strong&gt;</span></span><br><span class="line"><span class="string">USER</span>       <span class="string">PID</span> <span class="string">%CPU</span> <span class="string">%MEM</span>    <span class="string">VSZ</span>   <span class="string">RSS</span> <span class="string">TTY</span>      <span class="string">STAT</span> <span class="string">START</span>   <span class="string">TIME</span> <span class="string">COMMAND</span></span><br><span class="line"><span class="string">root</span>      <span class="number">2213  </span><span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">6784  </span><span class="number">2036</span> <span class="string">?</span>        <span class="attr">Ss   03:01   0:00 nginx:</span> <span class="string">master</span> <span class="string">process</span> <span class="string">/usr/sbin/nginx</span> <span class="string">-c</span> <span class="string">/etc/nginx/nginx.conf</span></span><br><span class="line"><span class="string">&lt;strong&gt;#</span> <span class="string">kill</span> <span class="string">-HUP</span> <span class="number">2213</span><span class="string">&lt;/strong&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&lt;strong&gt; nginx -t -c /etc/nginx/nginx.conf&lt;/strong&gt;</span></span><br><span class="line"><span class="number">2006</span><span class="string">/09/16</span> <span class="number">13</span><span class="string">:07:10</span> [<span class="string">info</span>] <span class="number">15686</span><span class="comment">#0: the configuration file /etc/nginx/nginx.conf syntax is ok</span></span><br><span class="line"><span class="number">2006</span><span class="string">/09/16</span> <span class="number">13</span><span class="string">:07:10</span> [<span class="string">info</span>] <span class="number">15686</span><span class="comment">#0: the configuration file /etc/nginx/nginx.conf was tested successfully</span></span><br><span class="line"><span class="comment">#&lt;strong&gt; ps aux | egrep &#x27;(PID|nginx)&#x27;&lt;/strong&gt;</span></span><br><span class="line"><span class="string">USER</span>       <span class="string">PID</span> <span class="string">%CPU</span> <span class="string">%MEM</span>    <span class="string">VSZ</span>   <span class="string">RSS</span> <span class="string">TTY</span>      <span class="string">STAT</span> <span class="string">START</span>   <span class="string">TIME</span> <span class="string">COMMAND</span></span><br><span class="line"><span class="string">root</span>      <span class="number">2213  </span><span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">6784  </span><span class="number">2036</span> <span class="string">?</span>        <span class="attr">Ss   03:01   0:00 nginx:</span> <span class="string">master</span> <span class="string">process</span> <span class="string">/usr/sbin/nginx</span> <span class="string">-c</span> <span class="string">/etc/nginx/nginx.conf</span></span><br><span class="line"><span class="string">&lt;strong&gt;#</span> <span class="string">kill</span> <span class="string">-HUP</span> <span class="number">2213</span><span class="string">&lt;/strong&gt;</span></span><br><span class="line"><span class="string">当</span> <span class="string">nginx</span> <span class="string">接收到</span> <span class="string">HUP</span> <span class="string">信号，它会尝试先解析配置文件（如果指定配置文件，就使用指定的，否则使用默认的），成功的话，就应用新的配置文件（例如：重新打开日志文件或监听的套接</span> <span class="string">字）。之后，nginx</span> <span class="string">运行新的工作进程并从容关闭旧的工作进程。通知工作进程关闭监听套接字但是继续为当前连接的客户提供服务。所有客户端的服务完成后，旧的工作进程被关闭。</span> <span class="string">如果新的配置文件应用失败，nginx</span> <span class="string">将继续使用旧的配置进行工作。</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="string">平滑升级到新的二进制代码</span></span><br><span class="line"><span class="string">你可以在不中断服务的情况下</span> <span class="bullet">-</span> <span class="string">新的请求也不会丢失，使用新的</span> <span class="string">nginx</span> <span class="string">可执行程序替换旧的（当升级新版本或添加/删除服务器模块时）。</span></span><br><span class="line"></span><br><span class="line"><span class="string">首先，使用新的可执行程序替换旧的（最好做好备份），然后，发送</span> <span class="string">USR2</span> <span class="string">(kill</span> <span class="string">-USR2</span> <span class="string">pid)信号给主进程。主进程将重命名它的</span> <span class="string">.pid</span> <span class="string">文件为</span> <span class="string">.oldbin</span> <span class="string">(比如：/usr/local/nginx/logs/nginx.pid.oldbin)，然后执行新的可执行程序，依次启动新的主进程和新的工作进程：</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  <span class="string">PID</span>  <span class="string">PPID</span> <span class="string">USER</span>    <span class="string">%CPU</span>   <span class="string">VSZ</span> <span class="string">WCHAN</span>  <span class="string">COMMAND</span></span><br><span class="line"><span class="attr">33126     1 root     0.0  1164 pause  nginx:</span> <span class="string">master</span> <span class="string">process</span> <span class="string">/usr/local/nginx/sbin/nginx</span></span><br><span class="line"><span class="attr">33134 33126 nobody   0.0  1368 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">33135 33126 nobody   0.0  1380 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">33136 33126 nobody   0.0  1368 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">36264 33126 root     0.0  1148 pause  nginx:</span> <span class="string">master</span> <span class="string">process</span> <span class="string">/usr/local/nginx/sbin/nginx</span></span><br><span class="line"><span class="attr">36265 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">36266 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">36267 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"></span><br><span class="line">  <span class="string">PID</span>  <span class="string">PPID</span> <span class="string">USER</span>    <span class="string">%CPU</span>   <span class="string">VSZ</span> <span class="string">WCHAN</span>  <span class="string">COMMAND</span></span><br><span class="line"><span class="attr">33126     1 root     0.0  1164 pause  nginx:</span> <span class="string">master</span> <span class="string">process</span> <span class="string">/usr/local/nginx/sbin/nginx</span></span><br><span class="line"><span class="attr">33134 33126 nobody   0.0  1368 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">33135 33126 nobody   0.0  1380 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">33136 33126 nobody   0.0  1368 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">36264 33126 root     0.0  1148 pause  nginx:</span> <span class="string">master</span> <span class="string">process</span> <span class="string">/usr/local/nginx/sbin/nginx</span></span><br><span class="line"><span class="attr">36265 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">36266 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">36267 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="string">在这时，两个</span> <span class="string">nginx</span> <span class="string">实例会同时运行，一起处理输入的请求。要逐步停止旧的实例，你必须发送</span> <span class="string">WINCH</span> <span class="string">信号给旧的主进程，然后，它的工作进程就将开始从容关闭：</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  <span class="string">PID</span>  <span class="string">PPID</span> <span class="string">USER</span>    <span class="string">%CPU</span>   <span class="string">VSZ</span> <span class="string">WCHAN</span>  <span class="string">COMMAND</span></span><br><span class="line"><span class="attr">33126     1 root     0.0  1164 pause  nginx:</span> <span class="string">master</span> <span class="string">process</span> <span class="string">/usr/local/nginx/sbin/nginx</span></span><br><span class="line"><span class="attr">33135 33126 nobody   0.0  1380 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">is</span> <span class="string">shutting</span> <span class="string">down</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">36264 33126 root     0.0  1148 pause  nginx:</span> <span class="string">master</span> <span class="string">process</span> <span class="string">/usr/local/nginx/sbin/nginx</span></span><br><span class="line"><span class="attr">36265 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">36266 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">36267 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"></span><br><span class="line">  <span class="string">PID</span>  <span class="string">PPID</span> <span class="string">USER</span>    <span class="string">%CPU</span>   <span class="string">VSZ</span> <span class="string">WCHAN</span>  <span class="string">COMMAND</span></span><br><span class="line"><span class="attr">33126     1 root     0.0  1164 pause  nginx:</span> <span class="string">master</span> <span class="string">process</span> <span class="string">/usr/local/nginx/sbin/nginx</span></span><br><span class="line"><span class="attr">33135 33126 nobody   0.0  1380 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">is</span> <span class="string">shutting</span> <span class="string">down</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">36264 33126 root     0.0  1148 pause  nginx:</span> <span class="string">master</span> <span class="string">process</span> <span class="string">/usr/local/nginx/sbin/nginx</span></span><br><span class="line"><span class="attr">36265 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">36266 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">36267 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="string">一段时间后，旧的工作进程处理了所有已连接的请求后退出，就仅由新的工作进程来处理输入的请求了：</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  <span class="string">PID</span>  <span class="string">PPID</span> <span class="string">USER</span>    <span class="string">%CPU</span>   <span class="string">VSZ</span> <span class="string">WCHAN</span>  <span class="string">COMMAND</span></span><br><span class="line"><span class="attr">33126     1 root     0.0  1164 pause  nginx:</span> <span class="string">master</span> <span class="string">process</span> <span class="string">/usr/local/nginx/sbin/nginx</span></span><br><span class="line"><span class="attr">36264 33126 root     0.0  1148 pause  nginx:</span> <span class="string">master</span> <span class="string">process</span> <span class="string">/usr/local/nginx/sbin/nginx</span></span><br><span class="line"><span class="attr">36265 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">36266 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">36267 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"></span><br><span class="line">  <span class="string">PID</span>  <span class="string">PPID</span> <span class="string">USER</span>    <span class="string">%CPU</span>   <span class="string">VSZ</span> <span class="string">WCHAN</span>  <span class="string">COMMAND</span></span><br><span class="line"><span class="attr">33126     1 root     0.0  1164 pause  nginx:</span> <span class="string">master</span> <span class="string">process</span> <span class="string">/usr/local/nginx/sbin/nginx</span></span><br><span class="line"><span class="attr">36264 33126 root     0.0  1148 pause  nginx:</span> <span class="string">master</span> <span class="string">process</span> <span class="string">/usr/local/nginx/sbin/nginx</span></span><br><span class="line"><span class="attr">36265 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">36266 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="attr">36267 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"><span class="string">这时，因为旧的服务器还尚未关闭它监听的套接字，所以，通过下面的几步，你仍可以恢复旧的服务器：</span></span><br><span class="line"></span><br><span class="line"><span class="string">发送</span> <span class="string">HUP</span> <span class="string">信号给旧的主进程</span> <span class="bullet">-</span> <span class="string">它将在不重载配置文件的情况下启动它的工作进程</span></span><br><span class="line"><span class="string">发送</span> <span class="string">QUIT</span> <span class="string">信号给新的主进程，要求其从容关闭其工作进程</span></span><br><span class="line"><span class="string">发送</span> <span class="string">TERM</span> <span class="string">信号给新的主进程，迫使其退出</span></span><br><span class="line"><span class="string">如果因为某些原因新的工作进程不能退出，向其发送</span> <span class="string">KILL</span> <span class="string">信号</span></span><br><span class="line"><span class="string">新的主进程退出后，旧的主进程会由移除</span> <span class="string">.oldbin</span> <span class="string">前缀，恢复为它的</span> <span class="string">.pid</span> <span class="string">文件，这样，一切就都恢复到升级之前了。</span></span><br><span class="line"></span><br><span class="line"><span class="string">如果尝试升级成功，而你也希望保留新的服务器时，发送</span> <span class="string">QUIT</span> <span class="string">信号给旧的主进程使其退出而只留下新的服务器运行：</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">      <span class="string">PID</span>  <span class="string">PPID</span> <span class="string">USER</span>    <span class="string">%CPU</span>   <span class="string">VSZ</span> <span class="string">WCHAN</span>  <span class="string">COMMAND</span></span><br><span class="line">    <span class="attr">36264     1 root     0.0  1148 pause  nginx:</span> <span class="string">master</span> <span class="string">process</span> <span class="string">/usr/local/nginx/sbin/nginx</span></span><br><span class="line">    <span class="attr">36265 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line">    <span class="attr">36266 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line">    <span class="attr">36267 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line"></span><br><span class="line">      <span class="string">PID</span>  <span class="string">PPID</span> <span class="string">USER</span>    <span class="string">%CPU</span>   <span class="string">VSZ</span> <span class="string">WCHAN</span>  <span class="string">COMMAND</span></span><br><span class="line">    <span class="attr">36264     1 root     0.0  1148 pause  nginx:</span> <span class="string">master</span> <span class="string">process</span> <span class="string">/usr/local/nginx/sbin/nginx</span></span><br><span class="line">    <span class="attr">36265 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line">    <span class="attr">36266 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br><span class="line">    <span class="attr">36267 36264 nobody   0.0  1364 kqread nginx:</span> <span class="string">worker</span> <span class="string">process</span> <span class="string">(nginx)</span></span><br></pre></td></tr></table></figure><h1 id="nginx反向代理配置"><a href="#nginx反向代理配置" class="headerlink" title="nginx反向代理配置"></a>nginx反向代理配置</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">nginx作为web服务器一个重要的功能就是反向代理。</span></span><br><span class="line"></span><br><span class="line"><span class="string">当然你也可以使用nginx配置正向代理，本是介绍如何配置nginx的反向代理。</span></span><br><span class="line"></span><br><span class="line"><span class="string">nginx反向代理的指令不需要新增额外的模块，默认自带proxy_pass指令，只需要修改配置文件就可以实现反向代理。</span></span><br><span class="line"></span><br><span class="line"><span class="string">什么是反向代理服务器</span></span><br><span class="line"><span class="string">反向代理功能是nginx的三大主要功能之一（静态web服务器、反向代理、负载均衡）。nginx一般同时做为静态web服务器和反向代理服务器，做为web服务器访问静态文件图片、css、js、html等文件，做为反向代理服务器把请求发给后端业务处理服务，如果有多个后端处理节点，会配置负载均衡功能。</span></span><br><span class="line"></span><br><span class="line"><span class="string">反向代理服务器是一种代理服务器，用于管理从外部网络到内部网络的连接或任何特定请求。它保护、路由和管理从外部网络到内部网络、Web服务器或专用网络的流量。</span></span><br><span class="line"><span class="type">![nginx](nginx33.png)</span></span><br><span class="line"></span><br><span class="line"><span class="string">外网客户机：我们平时打开浏览器输入网址访问www.nginx.cn的场景中，我们的笔记本就可以理解为一个外网客户机。</span></span><br><span class="line"></span><br><span class="line"><span class="string">nginx反向代理服务：浏览器输入网址并回车后，会发起一个http请求给nginx（反向代理服务器），这个请求如果是访问静态文件，那么nginx作为web服务器直接返回请求的内容，如果是访问的后台服务逻辑，那么nginx把请求转发给后端的服务处理。</span></span><br><span class="line"></span><br><span class="line"><span class="string">内网web服务：后端的服务可以是很多种类型，LNMP环境下的php-fpm进程，Java环境下的tomcat、jetty等容器，通过程序逻辑处理http请求，生成html页面或者json串返回给客户端。对于小型应用，后端服务可以和nginx部署在同一台机器上。</span></span><br><span class="line"></span><br><span class="line"><span class="string">反向代理服务器的好处</span></span><br><span class="line"><span class="string">nginx反向代理重要的作用是配合upstream实现负载均衡。</span></span><br><span class="line"></span><br><span class="line"><span class="string">同时增加安全性，客户端不能直接访问后端服务，多了一个中间的屏障。</span></span><br><span class="line"></span><br><span class="line"><span class="string">提升性能，通过异步非阻塞的方式把请求传给后端，提升了并发处理能力。</span></span><br><span class="line"></span><br><span class="line"><span class="string">也可利用缓存、压缩响应提高响应速度。</span></span><br><span class="line"></span><br><span class="line"><span class="string">nginx如何配置反向代理</span></span><br><span class="line"><span class="string">nginx反向代理不需要编译额外的模块，默认自带proxy_pass和fastcgi_pass指令，通过在location配置块中增加指令就可以实现反向代理功能。</span></span><br><span class="line"></span><br><span class="line"><span class="string">以www.nginx.cn为例，这个网站用的wordpress程序，wordpress是php语言编写，那么需要通过php运行环境，可以选择apache的php扩展或者php-fpm环境，主流的选择是php-fpm，php-fpm设置为Unix</span> <span class="string">socket模式或者ip:端口模式</span> <span class="string">。</span></span><br><span class="line"></span><br><span class="line"><span class="string">Unix</span> <span class="string">socket后端服务配置</span></span><br><span class="line"><span class="string">server</span> &#123;</span><br><span class="line">    <span class="string">listen</span> <span class="number">80</span><span class="string">;</span></span><br><span class="line">    <span class="string">server_name</span> <span class="string">www.nginx.cn</span> <span class="string">nginx.cn;</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">location</span> <span class="string">/app</span> &#123;</span><br><span class="line">       <span class="string">fastcgi_pass</span>  <span class="string">unix:/tmp/php-cgi.sock;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">ip端口后端服务配置</span></span><br><span class="line"><span class="string">server</span> &#123;</span><br><span class="line">    <span class="string">listen</span> <span class="number">80</span><span class="string">;</span></span><br><span class="line">    <span class="string">server_name</span> <span class="string">www.nginx.cn</span> <span class="string">nginx.cn;</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">location</span> <span class="string">/app</span> &#123;</span><br><span class="line">       <span class="string">proxy_pass</span> <span class="string">http://127.0.0.1:8080;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">proxy_pass和fastcgi_pass区别</span></span><br><span class="line"><span class="string">对于上面介绍的两种情况下proxy_pass和fastcgi_pass可以互相替代使用，不过两者还是有区别的，从名字我们就可以看出来，fastcgi_pass是用来反向代理fastcgi协议，proxy_pass可以代理包括fastcgi协议在内的其它协议。</span></span><br><span class="line"></span><br><span class="line"><span class="string">例如镜像一个网站，这种情况下就需要proxy_pass：</span></span><br><span class="line"><span class="string">location</span> <span class="string">/&#123;</span></span><br><span class="line">    <span class="string">proxy_pass</span> <span class="string">http://www.baidu.com;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="nginx-location匹配规则"><a href="#nginx-location匹配规则" class="headerlink" title="nginx location匹配规则"></a>nginx location匹配规则</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">location匹配命令</span></span><br><span class="line"></span><br><span class="line"><span class="string">~</span>      <span class="comment">#波浪线表示执行一个正则匹配，区分大小写</span></span><br><span class="line"><span class="string">~*</span>    <span class="comment">#表示执行一个正则匹配，不区分大小写</span></span><br><span class="line"><span class="string">^~</span>    <span class="comment">#^~表示普通字符匹配，如果该选项匹配，只匹配该选项，不匹配别的选项，一般用来匹配目录</span></span><br><span class="line"><span class="string">=</span>      <span class="comment">#进行普通字符精确匹配</span></span><br><span class="line"><span class="string">@</span>     <span class="comment">#&quot;@&quot; 定义一个命名的 location，使用在内部定向时，例如 error_page, try_files</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">location</span> <span class="string">匹配的优先级(与location在配置文件中的顺序无关)</span></span><br><span class="line"><span class="string">=</span> <span class="string">精确匹配会第一个被处理。如果发现精确匹配，nginx停止搜索其他匹配。</span></span><br><span class="line"><span class="string">普通字符匹配，正则表达式规则和长的块规则将被优先和查询匹配，也就是说如果该项匹配还需去看有没有正则表达式匹配和更长的匹配。</span></span><br><span class="line"><span class="string">^~</span> <span class="string">则只匹配该规则，nginx停止搜索其他匹配，否则nginx会继续处理其他location指令。</span></span><br><span class="line"><span class="string">最后匹配理带有&quot;~&quot;和&quot;~*&quot;的指令，如果找到相应的匹配，则nginx停止搜索其他匹配；当没有正则表达式或者没有正则表达式被匹配的情况下，那么匹配程度最高的逐字匹配指令会被使用。</span></span><br><span class="line"></span><br><span class="line"><span class="string">location</span> <span class="string">优先级官方文档</span></span><br><span class="line"></span><br><span class="line"><span class="string">Directives</span> <span class="string">with</span> <span class="string">the</span> <span class="string">=</span> <span class="string">prefix</span> <span class="string">that</span> <span class="string">match</span> <span class="string">the</span> <span class="string">query</span> <span class="string">exactly.</span> <span class="string">If</span> <span class="string">found,</span> <span class="string">searching</span> <span class="string">stops.</span></span><br><span class="line"><span class="string">All</span> <span class="string">remaining</span> <span class="string">directives</span> <span class="string">with</span> <span class="string">conventional</span> <span class="string">strings,</span> <span class="string">longest</span> <span class="string">match</span> <span class="string">first.</span> <span class="string">If</span> <span class="string">this</span> <span class="string">match</span> <span class="string">used</span> <span class="string">the</span> <span class="string">^~</span> <span class="string">prefix,</span> <span class="string">searching</span> <span class="string">stops.</span></span><br><span class="line"><span class="string">Regular</span> <span class="string">expressions,</span> <span class="string">in</span> <span class="string">order</span> <span class="string">of</span> <span class="string">definition</span> <span class="string">in</span> <span class="string">the</span> <span class="string">configuration</span> <span class="string">file.</span></span><br><span class="line"><span class="string">If</span> <span class="comment">#3 yielded a match, that result is used. Else the match from #2 is used.</span></span><br><span class="line"><span class="string">=前缀的指令严格匹配这个查询。如果找到，停止搜索。</span></span><br><span class="line"><span class="string">所有剩下的常规字符串，最长的匹配。如果这个匹配使用^〜前缀，搜索停止。</span></span><br><span class="line"><span class="string">正则表达式，在配置文件中定义的顺序。</span></span><br><span class="line"><span class="string">如果第3条规则产生匹配的话，结果被使用。否则，使用第2条规则的结果。</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="string">例如</span></span><br><span class="line"><span class="string">location</span>  <span class="string">=</span> <span class="string">/</span> &#123;</span><br><span class="line">  <span class="comment"># 只匹配&quot;/&quot;.</span></span><br><span class="line">  [ <span class="string">configuration</span> <span class="string">A</span> ] </span><br><span class="line">&#125;</span><br><span class="line"><span class="string">location</span>  <span class="string">/</span> &#123;</span><br><span class="line">  <span class="comment"># 匹配任何请求，因为所有请求都是以&quot;/&quot;开始</span></span><br><span class="line">  <span class="comment"># 但是更长字符匹配或者正则表达式匹配会优先匹配</span></span><br><span class="line">  [ <span class="string">configuration</span> <span class="string">B</span> ] </span><br><span class="line">&#125;</span><br><span class="line"><span class="string">location</span> <span class="string">^~</span> <span class="string">/images/</span> &#123;</span><br><span class="line">  <span class="comment"># 匹配任何以 /images/ 开始的请求，并停止匹配 其它location</span></span><br><span class="line">  [ <span class="string">configuration</span> <span class="string">C</span> ] </span><br><span class="line">&#125;</span><br><span class="line"><span class="string">location</span> <span class="string">~*</span> <span class="string">.(gif|jpg|jpeg)$</span> &#123;</span><br><span class="line">  <span class="comment"># 匹配以 gif, jpg, or jpeg结尾的请求. </span></span><br><span class="line">  <span class="comment"># 但是所有 /images/ 目录的请求将由 [Configuration C]处理.   </span></span><br><span class="line">  [ <span class="string">configuration</span> <span class="string">D</span> ] </span><br><span class="line">&#125;</span><br><span class="line"><span class="string">请求URI例子:</span></span><br><span class="line"></span><br><span class="line"><span class="string">/</span> <span class="string">-&gt;</span> <span class="string">符合configuration</span> <span class="string">A</span></span><br><span class="line"><span class="string">/documents/document.html</span> <span class="string">-&gt;</span> <span class="string">符合configuration</span> <span class="string">B</span></span><br><span class="line"><span class="string">/images/1.gif</span> <span class="string">-&gt;</span> <span class="string">符合configuration</span> <span class="string">C</span></span><br><span class="line"><span class="string">/documents/1.jpg</span> <span class="string">-&gt;符合</span> <span class="string">configuration</span> <span class="string">D</span></span><br><span class="line"><span class="string">@location</span> <span class="string">例子</span></span><br><span class="line"><span class="string">error_page</span> <span class="number">404</span> <span class="string">=</span> <span class="string">@fetch;</span></span><br><span class="line"></span><br><span class="line"><span class="string">location</span> <span class="string">@fetch(</span></span><br><span class="line"><span class="string">proxy_pass</span> <span class="string">http://fetch;</span></span><br><span class="line"><span class="string">)</span></span><br></pre></td></tr></table></figure><h1 id="nginx-upstream-配置和作用"><a href="#nginx-upstream-配置和作用" class="headerlink" title="nginx upstream 配置和作用"></a>nginx upstream 配置和作用</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">配置例子</span></span><br><span class="line"><span class="string">upstream</span> <span class="string">backend</span> &#123;</span><br><span class="line">    <span class="string">server</span> <span class="string">backend1.example.com</span>       <span class="string">weight=5;</span></span><br><span class="line">    <span class="string">server</span> <span class="string">backend2.example.com:8080;</span></span><br><span class="line">    <span class="string">server</span> <span class="string">unix:/tmp/backend3;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">server</span> <span class="string">backup1.example.com:8080</span>   <span class="string">backup;</span></span><br><span class="line">    <span class="string">server</span> <span class="string">backup2.example.com:8080</span>   <span class="string">backup;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">server</span> &#123;</span><br><span class="line">    <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">        <span class="string">proxy_pass</span> <span class="string">http://backend;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">指令</span></span><br><span class="line"><span class="string">语法:</span><span class="string">upstream</span> <span class="string">name</span> &#123; <span class="string">...</span> &#125;</span><br><span class="line"><span class="string">默认值:</span><span class="string">—</span></span><br><span class="line"><span class="string">上下文:</span><span class="string">http</span></span><br><span class="line"><span class="string">定义一组服务器。</span> <span class="string">这些服务器可以监听不同的端口。</span> <span class="string">而且，监听在TCP和UNIX域套接字的服务器可以混用。</span></span><br><span class="line"></span><br><span class="line"><span class="string">例子：</span></span><br><span class="line"></span><br><span class="line"><span class="string">upstream</span> <span class="string">backend</span> &#123;</span><br><span class="line">    <span class="string">server</span> <span class="string">backend1.example.com</span> <span class="string">weight=5;</span></span><br><span class="line">    <span class="string">server</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8080</span>       <span class="string">max_fails=3</span> <span class="string">fail_timeout=30s;</span></span><br><span class="line">    <span class="string">server</span> <span class="string">unix:/tmp/backend3;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">默认情况下，nginx按加权轮转的方式将请求分发到各服务器。</span> <span class="string">在上面的例子中，每7个请求会通过以下方式分发：</span> <span class="number">5</span><span class="string">个请求分到backend1.example.com，</span> <span class="string">一个请求分到第二个服务器，一个请求分到第三个服务器。</span> <span class="string">与服务器通信的时候，如果出现错误，请求会被传给下一个服务器，直到所有可用的服务器都被尝试过。</span> <span class="string">如果所有服务器都返回失败，客户端将会得到最后通信的那个服务器的（失败）响应结果。</span></span><br><span class="line"></span><br><span class="line"><span class="string">语法:</span><span class="string">server</span> <span class="string">address</span> [<span class="string">parameters</span>]<span class="string">;</span></span><br><span class="line"><span class="string">默认值:</span><span class="string">—</span></span><br><span class="line"><span class="string">上下文:</span><span class="string">upstream</span></span><br><span class="line"><span class="string">定义服务器的地址address和其他参数parameters。</span> <span class="string">地址可以是域名或者IP地址，端口是可选的，或者是指定“unix:”前缀的UNIX域套接字的路径。如果没有指定端口，就使用80端口。</span> <span class="string">如果一个域名解析到多个IP，本质上是定义了多个server。</span></span><br><span class="line"></span><br><span class="line"><span class="string">你可以定义下面的参数：weight=number设定服务器的权重，默认是1。max_fails=number设定Nginx与服务器通信的尝试失败的次数。在fail_timeout参数定义的时间段内，如果失败的次数达到此值，Nginx就认为服务器不可用。在下一个fail_timeout时间段，服务器不会再被尝试。</span> <span class="string">失败的尝试次数默认是1。设为0就会停止统计尝试次数，认为服务器是一直可用的。</span> <span class="string">你可以通过指令proxy_next_upstream、</span> <span class="string">fastcgi_next_upstream和memcached_next_upstream来配置什么是失败的尝试。</span> <span class="string">默认配置时，http_404状态不被认为是失败的尝试。fail_timeout=time设定</span></span><br><span class="line"></span><br><span class="line"><span class="string">统计失败尝试次数的时间段。在这段时间中，服务器失败次数达到指定的尝试次数，服务器就被认为不可用。</span></span><br><span class="line"><span class="string">服务器被认为不可用的时间段。</span></span><br><span class="line"><span class="string">默认情况下，该超时时间是10秒。backup标记为备用服务器。当主服务器不可用以后，请求会被传给这些服务器。down标记服务器永久不可用，可以跟ip_hash指令一起使用。</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Example:</span></span><br><span class="line"></span><br><span class="line"><span class="string">upstream</span> <span class="string">backend</span> &#123;</span><br><span class="line">    <span class="string">server</span> <span class="string">backend1.example.com</span>     <span class="string">weight=5;</span></span><br><span class="line">    <span class="string">server</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8080</span>           <span class="string">max_fails=3</span> <span class="string">fail_timeout=30s;</span></span><br><span class="line">    <span class="string">server</span> <span class="string">unix:/tmp/backend3;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">server</span> <span class="string">backup1.example.com:8080</span> <span class="string">backup;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">语法:</span><span class="string">ip_hash;</span></span><br><span class="line"><span class="string">默认值:</span><span class="string">—</span></span><br><span class="line"><span class="string">上下文:</span><span class="string">upstream</span></span><br><span class="line"><span class="string">指定服务器组的负载均衡方法，请求基于客户端的IP地址在服务器间进行分发。</span> <span class="string">IPv4地址的前三个字节或者IPv6的整个地址，会被用来作为一个散列key。</span> <span class="string">这种方法可以确保从同一个客户端过来的请求，会被传给同一台服务器。除了当服务器被认为不可用的时候，这些客户端的请求会被传给其他服务器，而且很有可能也是同一台服务器。</span></span><br><span class="line"></span><br><span class="line"><span class="string">从1.3.2和1.2.2版本开始支持IPv6地址。</span></span><br><span class="line"></span><br><span class="line"><span class="string">如果其中一个服务器想暂时移除，应该加上down参数。这样可以保留当前客户端IP地址散列分布。</span></span><br><span class="line"></span><br><span class="line"><span class="string">例子：</span></span><br><span class="line"></span><br><span class="line"><span class="string">upstream</span> <span class="string">backend</span> &#123;</span><br><span class="line">    <span class="string">ip_hash;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">server</span> <span class="string">backend1.example.com;</span></span><br><span class="line">    <span class="string">server</span> <span class="string">backend2.example.com;</span></span><br><span class="line">    <span class="string">server</span> <span class="string">backend3.example.com</span> <span class="string">down;</span></span><br><span class="line">    <span class="string">server</span> <span class="string">backend4.example.com;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">从1.3.1和1.2.2版本开始，ip_hash的负载均衡方法才支持设置服务器权重值。</span></span><br><span class="line"></span><br><span class="line"><span class="string">语法:</span><span class="string">keepalive</span> <span class="string">connections;</span></span><br><span class="line"><span class="string">默认值:</span><span class="string">—</span></span><br><span class="line"><span class="string">上下文:</span><span class="string">upstream</span></span><br><span class="line"><span class="string">这个指令出现在版本</span> <span class="number">1.1</span><span class="number">.4</span><span class="string">.</span></span><br><span class="line"></span><br><span class="line"><span class="string">激活对上游服务器的连接进行缓存。</span></span><br><span class="line"></span><br><span class="line"><span class="string">connections参数设置每个worker进程与后端服务器保持连接的最大数量。这些保持的连接会被放入缓存。</span> <span class="string">如果连接数大于这个值时，最久未使用的连接会被关闭。</span></span><br><span class="line"></span><br><span class="line"><span class="string">需要注意的是，keepalive指令不会限制Nginx进程与上游服务器的连接总数。</span> <span class="string">新的连接总会按需被创建。</span> <span class="string">connections参数应该稍微设低一点，以便上游服务器也能处理额外新进来的连接。</span></span><br><span class="line"></span><br><span class="line"><span class="string">配置memcached上游服务器连接keepalive的例子：</span></span><br><span class="line"></span><br><span class="line"><span class="string">upstream</span> <span class="string">memcached_backend</span> &#123;</span><br><span class="line">    <span class="string">server</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:11211;</span></span><br><span class="line">    <span class="string">server</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.2</span><span class="string">:11211;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">keepalive</span> <span class="number">32</span><span class="string">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">server</span> &#123;</span><br><span class="line">    <span class="string">...</span></span><br><span class="line"></span><br><span class="line">    <span class="string">location</span> <span class="string">/memcached/</span> &#123;</span><br><span class="line">        <span class="string">set</span> <span class="string">$memcached_key</span> <span class="string">$uri;</span></span><br><span class="line">        <span class="string">memcached_pass</span> <span class="string">memcached_backend;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">对于HTTP代理，proxy_http_version指令应该设置为“1.1”，同时“Connection”头的值也应被清空。</span></span><br><span class="line"></span><br><span class="line"><span class="string">upstream</span> <span class="string">http_backend</span> &#123;</span><br><span class="line">    <span class="string">server</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8080;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">keepalive</span> <span class="number">16</span><span class="string">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">server</span> &#123;</span><br><span class="line">    <span class="string">...</span></span><br><span class="line"></span><br><span class="line">    <span class="string">location</span> <span class="string">/http/</span> &#123;</span><br><span class="line">        <span class="string">proxy_pass</span> <span class="string">http://http_backend;</span></span><br><span class="line">        <span class="string">proxy_http_version</span> <span class="number">1.1</span><span class="string">;</span></span><br><span class="line">        <span class="string">proxy_set_header</span> <span class="string">Connection</span> <span class="string">&quot;&quot;</span><span class="string">;</span></span><br><span class="line">        <span class="string">...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">另外一种选择是，HTTP/1.0协议的持久连接也可以通过发送“Connection:</span> <span class="string">Keep-Alive”头来实现。不过不建议这样用。</span></span><br><span class="line"></span><br><span class="line"><span class="string">对于FastCGI的服务器，需要设置</span> <span class="string">fastcgi_keep_conn</span> <span class="string">指令来让连接keepalive工作：</span></span><br><span class="line"></span><br><span class="line"><span class="string">upstream</span> <span class="string">fastcgi_backend</span> &#123;</span><br><span class="line">    <span class="string">server</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9000;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">keepalive</span> <span class="number">8</span><span class="string">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">server</span> &#123;</span><br><span class="line">    <span class="string">...</span></span><br><span class="line"></span><br><span class="line">    <span class="string">location</span> <span class="string">/fastcgi/</span> &#123;</span><br><span class="line">        <span class="string">fastcgi_pass</span> <span class="string">fastcgi_backend;</span></span><br><span class="line">        <span class="string">fastcgi_keep_conn</span> <span class="string">on;</span></span><br><span class="line">        <span class="string">...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">当使用的负载均衡方法不是默认的轮转法时，必须在keepalive</span> <span class="string">指令之前配置。</span></span><br><span class="line"></span><br><span class="line"><span class="string">针对SCGI和uwsgi协议，还没有实现其keepalive连接的打算。</span></span><br><span class="line"></span><br><span class="line"><span class="string">语法:</span><span class="string">least_conn;</span></span><br><span class="line"><span class="string">默认值:</span><span class="string">—</span></span><br><span class="line"><span class="string">上下文:</span><span class="string">upstream</span></span><br><span class="line"><span class="string">这个指令出现在版本</span> <span class="number">1.3</span><span class="number">.1</span> <span class="string">和</span> <span class="number">1.2</span><span class="number">.2</span><span class="string">.</span></span><br><span class="line"></span><br><span class="line"><span class="string">指定服务器组的负载均衡方法，根据其权重值，将请求发送到活跃连接数最少的那台服务器。</span> <span class="string">如果这样的服务器有多台，那就采取有权重的轮转法进行尝试。</span></span><br><span class="line"></span><br><span class="line"><span class="string">嵌入的变量</span></span><br><span class="line"><span class="string">ngx_http_upstream_module模块支持以下嵌入变量：</span></span><br><span class="line"></span><br><span class="line"><span class="string">$upstream_addr保存服务器的IP地址和端口或者是UNIX域套接字的路径。</span> <span class="string">在请求处理过程中，如果有多台服务器被尝试了，它们的地址会被拼接起来，以逗号隔开，比如：</span> <span class="string">“192.168.1.1:80,</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span><span class="string">:80,</span> <span class="string">unix:/tmp/sock”。</span> <span class="string">如果在服务器之间通过“X-Accel-Redirect”头或者error_page有内部跳转，那么这些服务器组之间会以冒号隔开，比如：“192.168.1.1:80,</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span><span class="string">:80,</span> <span class="attr">unix:/tmp/sock :</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.1</span><span class="string">:80,</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.2</span><span class="string">:80”。$upstream_response_time以毫秒的精度保留服务器的响应时间，（输出）单位是秒。</span> <span class="string">出现多个响应时，也是以逗号和冒号隔开。$upstream_status保存服务器的响应代码。</span> <span class="string">出现多个响应时，也是以逗号和冒号隔开。$upstream_http_...保存服务器的响应头的值。比如“Server”响应头的值可以通过$upstream_http_server变量来获取。</span> <span class="string">需要注意的是只有最后一个响应的头会被保留下来。</span></span><br></pre></td></tr></table></figure><h1 id="nginx-rewrite-指令"><a href="#nginx-rewrite-指令" class="headerlink" title="nginx rewrite 指令"></a>nginx rewrite 指令</h1><p>nginx通过ngx_http_rewrite_module模块支持url重写、支持if条件判断，但不支持else。</p><p>该模块需要PCRE支持，应在编译nginx时指定PCRE源码目录, <a href="http://www.nginx.cn/install">nginx安装方法</a>。</p><h3 id="nginx-rewrite指令执行顺序："><a href="#nginx-rewrite指令执行顺序：" class="headerlink" title="nginx rewrite指令执行顺序："></a><strong>nginx rewrite指令执行顺序：</strong></h3><p>1.执行server块的rewrite指令(这里的块指的是server关键字后{}包围的区域，其它xx块类似)<br>2.执行location匹配<br>3.执行选定的location中的rewrite指令<br>如果其中某步URI被重写，则重新循环执行1-3，直到找到真实存在的文件</p><p>如果循环超过10次，则返回500 Internal Server Error错误</p><h3 id="break指令"><a href="#break指令" class="headerlink" title="break指令"></a>break指令</h3><p>语法：break;<br>默认值：无<br>作用域：server,location,if</p><p>停止执行当前虚拟主机的后续rewrite指令集<br>break指令实例：</p><table><thead><tr><th>1234</th><th>if ($slow) {   limit_rate 10k;   break; }</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><h3 id="if指令"><a href="#if指令" class="headerlink" title="if指令"></a><strong>if指令</strong></h3><p>语法：if(condition){…}<br>默认值：无<br>作用域：server,location<br>对给定的条件condition进行判断。如果为真，大括号内的rewrite指令将被执行。<br>if条件(conditon)可以是如下任何内容:</p><ul><li>一个变量名；false如果这个变量是空字符串或者以0开始的字符串；</li><li>使用= ,!= 比较的一个变量和字符串</li><li>是用~， ~*与正则表达式匹配的变量，如果这个正则表达式中包含}，;则整个表达式需要用” 或’ 包围</li><li>使用-f ，!-f 检查一个文件是否存在</li><li>使用-d, !-d 检查一个目录是否存在</li><li>使用-e ，!-e 检查一个文件、目录、符号链接是否存在</li><li>使用-x ， !-x 检查一个文件是否可执行</li></ul><p>if指令实例</p><table><thead><tr><th>12345678910111213141516171819</th><th>if ($http_user_agent ~ MSIE) {   rewrite ^(.<em>)$ /msie/$1 break; } if ($http_cookie ~</em> “id=([^;]+)(?:;|$)”) {   set $id $1; } if ($request_method = POST) {   return 405; } if ($slow) {   limit_rate 10k; } if ($invalid_referer) {   return 403; }</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><h3 id="return指令"><a href="#return指令" class="headerlink" title="return指令"></a><strong>return指令</strong></h3><p>语法：return code;</p><p>return code URL;</p><p><em>return URL;<br>默认值：无<br>作用域：server,location,if</em></p><p>停止处理并返回指定状态码(code)给客户端。<br>非标准状态码444表示关闭连接且不给客户端发响应头。<br>从0.8.42版本起，return 支持响应URL重定向(对于301，302，303，307），或者文本响应(对于其他状态码).<br>对于文本或者URL重定向可以包含变量</p><h3 id="rewrite指令"><a href="#rewrite指令" class="headerlink" title="rewrite指令"></a><strong>rewrite指令</strong></h3><p>语法：rewrite regex replacement [flag];<br>默认值：无<br>作用域：server,location,if<br>如果一个URI匹配指定的正则表达式regex，URI就按照replacement重写。<br>rewrite按配置文件中出现的顺序执行。flags标志可以停止继续处理。<br>如果replacement以”http://“或”https://“开始，将不再继续处理，这个重定向将返回给客户端。<br>flag可以是如下参数<br>last 停止处理后续rewrite指令集，然后对当前重写的新URI在rewrite指令集上重新查找。<br>break 停止处理后续rewrite指令集，并不在重新查找,但是当前location内剩余非rewrite语句和location外的的非rewrite语句可以执行。<br>redirect 如果replacement不是以http:// 或https://开始，返回302临时重定向<br>permant 返回301永久重定向<br>最终完整的重定向URL包括请求scheme(http://,https://等),请求的server_name_in_redirect和 port_in_redirec三部分 ，说白了也就是http协议 域名 端口三部分组成。</p><p>rewrite实例</p><table><thead><tr><th>1234567</th><th>server {   …   rewrite ^(/download/.<em>)/media/(.</em>)..<em>$ $1/mp3/$2.mp3 last;   rewrite ^(/download/.</em>)/audio/(.<em>)..</em>$ $1/mp3/$2.ra last;   return 403;   … }</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><p>如果这些rewrite放到 “<code>/download/</code>” location如下所示, 那么应使用break而不是last , 使用last将循环10次匹配，然后返回 500错误:</p><table><thead><tr><th>12345</th><th>location /download/ {   rewrite ^(/download/.<em>)/media/(.</em>)..<em>$ $1/mp3/$2.mp3 break;   rewrite ^(/download/.</em>)/audio/(.<em>)..</em>$ $1/mp3/$2.ra break;   return 403; }</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><p>对于重写后的URL（replacement）包含原请求的请求参数，原URL的?后的内容。如果不想带原请求的参数 ，可以在replacement后加一个问号。如下，我们加了一个自定义的参数user=$1,然后在结尾处放了一个问号?,把原请的参数去掉。</p><table><thead><tr><th>1</th><th>rewrite ^/users/(.*)$ /show?user=$1? last;</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><p>如果正则表达regex式中包含 “<code>&#125;</code>” 或 “<code>;</code>”, 那么整个表达式需要用双引号或单引号包围.</p><h3 id="rewrite-log指令"><a href="#rewrite-log指令" class="headerlink" title="rewrite_log指令"></a><strong>rewrite_log指令</strong></h3><p>语法：rewrite_log on|off;<br>默认值：rewrite_log off;<br>作用域：http,server,location,if<br>开启或关闭以notice级别打印rewrite处理日志到error log文件。</p><p>nginx打开rewrite log例子</p><p>rewrite_log on;<br>error_log logs/xxx.error.log notice;</p><p>1.打开rewrite on<br>2.把error log的级别调整到 notice</p><h3 id="set指令"><a href="#set指令" class="headerlink" title="set指令"></a><strong>set指令</strong></h3><p>语法：set variable value;<br>默认值：none<br>作用域：server,location,if<br>定义一个变量并赋值，值可以是文本，变量或者文本变量混合体。</p><h3 id="uninitialized-variable-warn指令"><a href="#uninitialized-variable-warn指令" class="headerlink" title="uninitialized_variable_warn指令"></a><strong>uninitialized_variable_warn指令</strong></h3><p>语法：uninitialized_variable_warn on | off;<br>默认值：uninitialized_variable_warn on<br>作用域：http,server,location,if</p><p>控制是否输出为初始化的变量到日志</p><h1 id="nginx的虚拟主机功能（nginx多站点，绑定多个域名）"><a href="#nginx的虚拟主机功能（nginx多站点，绑定多个域名）" class="headerlink" title="nginx的虚拟主机功能（nginx多站点，绑定多个域名）"></a>nginx的虚拟主机功能（nginx多站点，绑定多个域名）</h1><h2 id="两个虚拟主机-纯静态-html-支持-Two-Virtual-Hosts-Serving-Static-Files"><a href="#两个虚拟主机-纯静态-html-支持-Two-Virtual-Hosts-Serving-Static-Files" class="headerlink" title="两个虚拟主机(纯静态-html 支持) - Two Virtual Hosts, Serving Static Files"></a>两个虚拟主机(纯静态-html 支持) - Two Virtual Hosts, Serving Static Files</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">http</span> &#123;</span><br><span class="line">    <span class="string">server</span> &#123;</span><br><span class="line">        <span class="string">listen</span>          <span class="number">80</span><span class="string">;</span></span><br><span class="line">        <span class="string">server_name</span>     <span class="string">www.domain1.com;</span></span><br><span class="line">        <span class="string">access_log</span>      <span class="string">logs/domain1.access.log</span> <span class="string">main;</span></span><br><span class="line">        <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">            <span class="string">index</span> <span class="string">index.html;</span></span><br><span class="line">            <span class="string">root</span>  <span class="string">/var/www/domain1.com/htdocs;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">server</span> &#123;</span><br><span class="line">        <span class="string">listen</span>          <span class="number">80</span><span class="string">;</span></span><br><span class="line">        <span class="string">server_name</span>     <span class="string">www.domain2.com;</span></span><br><span class="line">        <span class="string">access_log</span>      <span class="string">logs/domain2.access.log</span> <span class="string">main;</span></span><br><span class="line">        <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">            <span class="string">index</span> <span class="string">index.html;</span></span><br><span class="line">            <span class="string">root</span>  <span class="string">/var/www/domain2.com/htdocs;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="string">虚拟主机标准配置(简化)</span> <span class="bullet">-</span> <span class="string">A</span> <span class="string">Default</span> <span class="string">Catchall</span> <span class="string">Virtual</span> <span class="string">Host</span></span><br><span class="line"><span class="string">http</span> &#123;</span><br><span class="line">    <span class="string">server</span> &#123;</span><br><span class="line">        <span class="string">listen</span>          <span class="number">80</span> <span class="string">default;</span></span><br><span class="line">        <span class="string">server_name</span>     <span class="string">_</span> <span class="string">*;</span></span><br><span class="line">        <span class="string">access_log</span>      <span class="string">logs/default.access.log</span> <span class="string">main;</span></span><br><span class="line">        <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">            <span class="string">index</span> <span class="string">index.html;</span></span><br><span class="line">            <span class="string">root</span>  <span class="string">/var/www/default/htdocs;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="string">在父文件夹中建立子文件夹以指向子域名</span> <span class="bullet">-</span> <span class="string">Wildcard</span> <span class="string">Subdomains</span> <span class="string">in</span> <span class="string">a</span> <span class="string">Parent</span> <span class="string">Folder</span></span><br><span class="line"><span class="string">这是一个添加子域名(或是当DNS已指向服务器时添加一个新域名)的简单方法。需要注意的是，我已经将FCGI配置进该文件了。如果你只想使服务器为静态文件服务，可以直接将FCGI配置信息注释掉，然后将默认主页文件变成index.html。</span></span><br><span class="line"></span><br><span class="line"><span class="string">这个简单的方法比起为每一个域名建立一个</span> <span class="string">vhost.conf</span> <span class="string">配置文件来讲，只需要在现有的配置文件中增加如下内容：</span></span><br><span class="line"></span><br><span class="line"><span class="string">This</span> <span class="string">is</span> <span class="string">just</span> <span class="string">a</span> <span class="string">really</span> <span class="string">easy</span> <span class="string">way</span> <span class="string">to</span> <span class="string">keep</span> <span class="string">adding</span> <span class="string">new</span> <span class="string">subdomains,</span> <span class="string">or</span> <span class="string">to</span> <span class="string">add</span> <span class="string">new</span> <span class="string">domains</span> <span class="string">automatically</span> <span class="string">when</span> <span class="string">DNS</span> <span class="string">records</span> <span class="string">are</span> <span class="string">pointed</span> <span class="string">at</span> <span class="string">the</span> <span class="string">server.</span> <span class="string">Note</span> <span class="string">that</span> <span class="string">I</span> <span class="string">have</span> <span class="string">included</span> <span class="string">FCGI</span> <span class="string">here</span> <span class="string">as</span> <span class="string">well.</span> <span class="string">If</span> <span class="string">you</span> <span class="string">want</span> <span class="string">to</span> <span class="string">just</span> <span class="string">serve</span> <span class="string">static</span> <span class="string">files,</span> <span class="string">strip</span> <span class="string">out</span> <span class="string">the</span> <span class="string">FCGI</span> <span class="string">config</span> <span class="string">and</span> <span class="string">change</span> <span class="string">the</span> <span class="string">default</span> <span class="string">document</span> <span class="string">to</span> <span class="string">index.html.</span> <span class="string">Rather</span> <span class="string">than</span> <span class="string">creating</span> <span class="string">a</span> <span class="string">new</span> <span class="string">vhost.conf</span> <span class="string">file</span> <span class="string">for</span> <span class="string">every</span> <span class="string">domain,</span> <span class="attr">just create one of these:</span></span><br><span class="line"><span class="string">server</span> &#123;</span><br><span class="line">        <span class="comment"># Replace this port with the right one for your requirements</span></span><br><span class="line">        <span class="comment"># 根据你的需求改变此端口</span></span><br><span class="line">        <span class="string">listen</span>       <span class="number">80</span><span class="string">;</span>  <span class="comment">#could also be 1.2.3.4:80 也可以是1.2.3.4:80的形式</span></span><br><span class="line">        <span class="comment"># Multiple hostnames seperated by spaces.  Replace these as well.</span></span><br><span class="line">        <span class="comment"># 多个主机名可以用空格隔开，当然这个信息也是需要按照你的需求而改变的。</span></span><br><span class="line">        <span class="string">server_name</span>  <span class="string">star.yourdomain.com</span> <span class="string">*.yourdomain.com</span> <span class="string">www.*.yourdomain.com;</span></span><br><span class="line">        <span class="comment">#Alternately: _ *</span></span><br><span class="line">        <span class="comment">#或者可以使用：_ * (具体内容参见本维基其他页面)</span></span><br><span class="line">        <span class="string">root</span> <span class="string">/PATH/TO/WEBROOT/$host;</span></span><br><span class="line">        <span class="string">error_page</span>  <span class="number">404</span>              <span class="string">http://yourdomain.com/errors/404.html;</span></span><br><span class="line">        <span class="string">access_log</span>  <span class="string">logs/star.yourdomain.com.access.log;</span></span><br><span class="line">        <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">            <span class="string">root</span>   <span class="string">/PATH/TO/WEBROOT/$host/;</span></span><br><span class="line">            <span class="string">index</span>  <span class="string">index.php;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># serve static files directly</span></span><br><span class="line">        <span class="comment"># 直接支持静态文件 (爱月说：???从配置上看来不是直接支持啊～有问题有问题～)</span></span><br><span class="line">        <span class="string">location</span> <span class="string">~*</span> <span class="string">^.+.(jpg|jpeg|gif|css|png|js|ico|html)$</span> &#123;</span><br><span class="line">            <span class="string">access_log</span>        <span class="string">off;</span></span><br><span class="line">            <span class="string">expires</span>           <span class="string">30d;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">location</span> <span class="string">~</span> <span class="string">.php$</span> &#123;</span><br><span class="line">          <span class="comment"># By all means use a different server for the fcgi processes if you need to</span></span><br><span class="line">          <span class="comment"># 如果需要，你可以为不同的FCGI进程设置不同的服务信息</span></span><br><span class="line">          <span class="string">fastcgi_pass</span>   <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:YOURFCGIPORTHERE;</span></span><br><span class="line">          <span class="string">fastcgi_index</span>  <span class="string">index.php;</span></span><br><span class="line">          <span class="string">fastcgi_param</span>  <span class="string">SCRIPT_FILENAME</span>  <span class="string">/PATH/TO/WEBROOT/$host/$fastcgi_script_name;</span></span><br><span class="line">          <span class="string">fastcgi_param</span>  <span class="string">QUERY_STRING</span>     <span class="string">$query_string;</span></span><br><span class="line">          <span class="string">fastcgi_param</span>  <span class="string">REQUEST_METHOD</span>   <span class="string">$request_method;</span></span><br><span class="line">          <span class="string">fastcgi_param</span>  <span class="string">CONTENT_TYPE</span>     <span class="string">$content_type;</span></span><br><span class="line">          <span class="string">fastcgi_param</span>  <span class="string">CONTENT_LENGTH</span>   <span class="string">$content_length;</span></span><br><span class="line">          <span class="string">fastcgi_intercept_errors</span> <span class="string">on;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">location</span> <span class="string">~</span> <span class="string">/.ht</span> &#123;</span><br><span class="line">            <span class="string">deny</span>  <span class="string">all;</span></span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure><h1 id="如何使用nginx配置负载均衡"><a href="#如何使用nginx配置负载均衡" class="headerlink" title="如何使用nginx配置负载均衡"></a>如何使用nginx配置负载均衡</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">负载均衡是扩展应用程序并提高其性能和冗余的绝佳方法。Nginx是一种流行的Web服务器软件，可以配置为简单但功能强大的负载均衡器，以提高服务器资源的可用性和效率。在负载</span> <span class="string">均衡配置中，nginx充当在多个单独服务器上工作的分布式Web应用程序的单个入口点。</span></span><br><span class="line"></span><br><span class="line"><span class="string">在Web场上进行负载平衡</span></span><br><span class="line"><span class="string">本文介绍如何使用nginx为云服务器配置负载均衡。作为先决条件，您需要至少安装两台主机并安装Web服务器软件，以便了解负载均衡器的优势。</span></span><br><span class="line"></span><br><span class="line"><span class="string">安装nginx</span></span><br><span class="line"><span class="string">目前，最新版本的CentOS，Debian和Ubuntu都提供nginx软件包，可以使用命令快速安装nginx。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Debian和Ubuntu </span></span><br><span class="line"><span class="string">sudo</span> <span class="string">apt-get</span> <span class="string">update</span> </span><br><span class="line"><span class="comment">#然后安装Nginx开源版 </span></span><br><span class="line"><span class="string">sudo</span> <span class="string">apt-get</span> <span class="string">install</span> <span class="string">nginx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Debian和Ubuntu </span></span><br><span class="line"><span class="string">sudo</span> <span class="string">apt-get</span> <span class="string">update</span> </span><br><span class="line"><span class="comment">#然后安装Nginx开源版 </span></span><br><span class="line"><span class="string">sudo</span> <span class="string">apt-get</span> <span class="string">install</span> <span class="string">nginx</span></span><br><span class="line"><span class="comment">#CentOS </span></span><br><span class="line"><span class="comment">#安装额外的软件包存储库 </span></span><br><span class="line"><span class="string">sudo</span> <span class="string">yum</span> <span class="string">install</span> <span class="string">epel-release</span></span><br><span class="line"><span class="comment">#更新存储库并安装Nginx </span></span><br><span class="line"><span class="string">sudo</span> <span class="string">yum</span> <span class="string">update</span> </span><br><span class="line"><span class="string">sudo</span> <span class="string">yum</span> <span class="string">install</span> <span class="string">nginx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#CentOS </span></span><br><span class="line"><span class="comment">#安装额外的软件包存储库 </span></span><br><span class="line"><span class="string">sudo</span> <span class="string">yum</span> <span class="string">install</span> <span class="string">epel-release</span></span><br><span class="line"><span class="comment">#更新存储库并安装Nginx </span></span><br><span class="line"><span class="string">sudo</span> <span class="string">yum</span> <span class="string">update</span> </span><br><span class="line"><span class="string">sudo</span> <span class="string">yum</span> <span class="string">install</span> <span class="string">nginx</span></span><br><span class="line"><span class="string">安装完成后，进入nginx主配置文件夹。</span></span><br><span class="line"><span class="string">cd</span> <span class="string">/etc/nginx/</span></span><br><span class="line"></span><br><span class="line"><span class="string">根据您的操作系统不同，Web服务器配置文件将位于两个位置之一。</span></span><br><span class="line"></span><br><span class="line"><span class="string">Ubuntu和Debian遵循在</span> <span class="string">/etc/nginx/sites-available/中存储虚拟主机文件的规则，这些规则通过符号链接到</span> <span class="string">/etc/nginx/sites-enabled/来启用。可以使用以下命令启用任何新的虚拟主机文件。</span></span><br><span class="line"><span class="string">sudo</span> <span class="string">ln</span> <span class="string">-s</span> <span class="string">/etc/nginx/sites-available/vhost</span> <span class="string">/etc/nginx/sites-enabled/vhost</span></span><br><span class="line"></span><br><span class="line"><span class="string">CentOS用户可以在/etc/nginx/conf.d/下找到其主机配置文件，nginx会加载此文件加下所有.conf类型的虚拟主机文件。可以在这个目录中至少找到一个默认配置default.conf，然后重新启动nginx。</span></span><br><span class="line"></span><br><span class="line"><span class="string">sudo</span> <span class="string">systemctl</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line"><span class="string">通过在Web浏览器中打开负载均衡服务器的IP地址来测试服务器是否回复HTTP请求。当您看到nginx的默认欢迎页面时，nginx安装成功。</span></span><br><span class="line"></span><br><span class="line"><span class="string">Nginx默认欢迎页面。</span></span><br><span class="line"><span class="string">如果您在加载页面时遇到问题，请检查防火墙是否阻止了您的连接。例如，在CentOS</span> <span class="number">7</span><span class="string">上，默认防火墙规则不允许HTTP流量，请使用以下命令启用它。</span></span><br><span class="line"></span><br><span class="line"><span class="string">sudo</span> <span class="string">firewall-cmd</span> <span class="string">--add-service=http</span> <span class="string">--permanent</span> </span><br><span class="line"><span class="string">sudo</span> <span class="string">firewall-cmd</span> <span class="string">--reload</span></span><br><span class="line"></span><br><span class="line"><span class="string">然后尝试刷新浏览器。</span></span><br><span class="line"></span><br><span class="line"><span class="string">将nginx配置为负载均衡器</span></span><br><span class="line"><span class="string">安装并测试nginx后，您可以开始配置nginx以实现负载平衡功能。从本质上讲，需要做的就是设置nginx，其中包含要监听的连接类型以及重定向位置的说明。要实现此目的，请使用您喜欢的任何文本编辑器创建新的配置文件，例如使用vi：</span></span><br><span class="line"></span><br><span class="line"><span class="string">sudo</span> <span class="string">vi</span> <span class="string">/etc/nginx/conf.d/load-balancer.conf</span></span><br><span class="line"></span><br><span class="line"><span class="string">在load-balancer.conf中，您需要定义以下两个段：upstream</span> <span class="string">和server</span> <span class="string">，请参阅下面的示例。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义要包含在负载均衡方案中的服务器。  </span></span><br><span class="line"><span class="comment">#最好使用服务器的私有IP以获得更好的性能和安全性。 </span></span><br><span class="line"><span class="string">http</span> &#123;</span><br><span class="line">    <span class="string">upstream</span> <span class="string">backend</span> &#123;</span><br><span class="line">       <span class="string">server</span> <span class="number">10.1</span><span class="number">.0</span><span class="number">.101</span><span class="string">;</span></span><br><span class="line">       <span class="string">server</span> <span class="number">10.1</span><span class="number">.0</span><span class="number">.102</span><span class="string">;</span></span><br><span class="line">       <span class="string">server</span> <span class="number">10.1</span><span class="number">.0</span><span class="number">.103</span><span class="string">;</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">#该服务器接受到端口80的所有流量并将其传递给上游upstream 。</span></span><br><span class="line">    <span class="comment">#请注意，upstream名称和proxy_pass需要匹配。</span></span><br><span class="line">    <span class="string">server</span> &#123;</span><br><span class="line">       <span class="string">listen</span> <span class="number">80</span><span class="string">;</span></span><br><span class="line">        <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">           <span class="string">proxy_pass</span> <span class="string">http://backend;</span></span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"><span class="string">然后保存文件并退出编辑器。</span></span><br><span class="line"></span><br><span class="line"><span class="string">接下来，您需要禁用先前在安装后测试的默认服务器配置。同样取决于您的操作系统，这部分略有不同。</span></span><br><span class="line"></span><br><span class="line"><span class="string">在Debian和Ubuntu系统上，您需要从启用站点的文件夹中删除默认符号链接。</span></span><br><span class="line"><span class="string">sudo</span> <span class="string">rm</span> <span class="string">/etc/nginx/sites-enabled/default</span></span><br><span class="line"></span><br><span class="line"><span class="string">CentOS的主机不使用相同的链接，而是简单地将重命名default.conf在conf.d</span> <span class="string">/目录下的东西，不是结束的.conf，例如：</span></span><br><span class="line"><span class="string">sudo</span> <span class="string">mv</span> <span class="string">/etc/nginx/conf.d/default.conf</span> <span class="string">/etc/nginx/conf.d/default.conf.disabled</span></span><br><span class="line"></span><br><span class="line"><span class="string">然后使用以下命令重新启动nginx</span></span><br><span class="line"><span class="string">sudo</span> <span class="string">systemctl</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line"></span><br><span class="line"><span class="string">检查nginx是否成功启动。如果重新启动失败，请查看刚刚创建的</span>  <span class="string">/etc/nginx/conf.d/load-balancer.conf，以确保没有错误类型或缺少分号。</span></span><br><span class="line"></span><br><span class="line"><span class="string">在Web浏览器中输入负载均衡nginx的IP地址时，请求会被传递到后端其中一个服务器。</span></span><br><span class="line"></span><br><span class="line"><span class="string">负载均衡方法</span></span><br><span class="line"><span class="string">如果没有定义其他方法，默认情况下nginx负载均衡会使用循环算法，如上面的第一个示例所示。使用循环方案，将根据您在load-balancer.conf</span>  <span class="string">文件中设置的顺序轮流选择每个服务器。这平衡了短期操作的请求数量。</span></span><br><span class="line"></span><br><span class="line"><span class="string">基于最少连接的负载均衡是另一种简单的方法。顾名思义，此方法将请求定向到当时具有最少活动连接的服务器。对于请求有时可能需要更长时间才能完成的应用程序，它比循环法更有效。</span></span><br><span class="line"></span><br><span class="line"><span class="string">要启用最少连接均衡方法，请将参数least_conn添加到上游</span>  <span class="string">部分，如下例所示。</span></span><br><span class="line"><span class="string">upstream</span> <span class="string">backend</span> &#123;</span><br><span class="line">    <span class="string">least_conn;</span></span><br><span class="line">    <span class="string">server</span> <span class="number">10.1</span><span class="number">.0</span><span class="number">.101</span><span class="string">;</span></span><br><span class="line">     <span class="string">server</span> <span class="number">10.1</span><span class="number">.0</span><span class="number">.102</span><span class="string">;</span></span><br><span class="line">    <span class="string">server</span> <span class="number">10.1</span><span class="number">.0</span><span class="number">.103</span><span class="string">;</span></span><br><span class="line"> &#125;</span><br><span class="line"><span class="string">虽然循环和最少连接平衡方案是公平的并且有其用途，但是它们不能提供会话持久性。如果您的Web应用程序要求用户随后被定向到与之前连接相同的后端服务器，则应使用IPhash方法。IPhash使用访问者IP地址作为密钥来确定应选择哪个主机来为请求提供服务。这允许访问者每次被定向到同一服务器。</span></span><br><span class="line"></span><br><span class="line"><span class="string">要使用此方法，请将ip_hash</span> <span class="string">添加到</span> <span class="string">upstream</span> <span class="string">段，如下面的示例所示。</span></span><br><span class="line"><span class="string">upstream</span> <span class="string">backend</span> &#123;</span><br><span class="line">    <span class="string">ip_hash;</span></span><br><span class="line">    <span class="string">server</span> <span class="number">10.1</span><span class="number">.0</span><span class="number">.101</span><span class="string">;</span></span><br><span class="line">    <span class="string">server</span> <span class="number">10.1</span><span class="number">.0</span><span class="number">.102</span><span class="string">;</span></span><br><span class="line">    <span class="string">server</span> <span class="number">10.1</span><span class="number">.0</span><span class="number">.103</span><span class="string">;</span></span><br><span class="line"> &#125;</span><br><span class="line"><span class="string">在一组主机之间的可用资源不相等的服务器配置中，可能希望某些服务器优先于其它服务器。定义服务器权重允许您进一步微调</span> <span class="string">nginx</span> <span class="string">负载均衡。负载均衡中权重最高的服务器最常选择。</span></span><br><span class="line"><span class="string">upstream</span> <span class="string">backend</span> &#123;</span><br><span class="line">    <span class="string">server</span> <span class="number">10.1</span><span class="number">.0</span><span class="number">.101</span> <span class="string">weight=4;</span></span><br><span class="line">    <span class="string">server</span> <span class="number">10.1</span><span class="number">.0</span><span class="number">.102</span> <span class="string">weight=2;</span></span><br><span class="line">    <span class="string">server</span> <span class="number">10.1</span><span class="number">.0</span><span class="number">.103</span><span class="string">;</span></span><br><span class="line"> &#125;</span><br><span class="line"><span class="string">例如，在上面的配置中，第一个服务器的选择频率是第二个服务器的两倍，是第三个服务器的四倍。</span></span><br><span class="line"></span><br><span class="line"><span class="string">启用HTTPS的负载均衡</span></span><br><span class="line"><span class="string">为您的网站启用HTTPS是保护访问者及其数据的好方法。建议大家开启https，可以提高搜索排名。了解如何在nginx上安装Let&#x27;s</span> <span class="string">Encrypt。</span></span><br><span class="line"></span><br><span class="line"><span class="string">在负载均衡器中使用https加密比想象的要容易。需要做的就是在负载均衡器配置文件中添加另一个服务器server，该server使用SSL监听端口443上的HTTPS流量，并为</span> <span class="string">upstream</span> <span class="string">段设置</span> <span class="string">proxy_pass</span> <span class="string">，就像上一个示例中的HTTP一样。</span></span><br><span class="line"></span><br><span class="line"><span class="string">再次打开配置文件进行编辑。</span></span><br><span class="line"><span class="string">sudo</span> <span class="string">vi</span> <span class="string">/etc/nginx/conf.d/load-balancer.conf</span></span><br><span class="line"><span class="string">然后将以下服务器段添加到文件末尾。</span></span><br><span class="line"><span class="string">server</span> &#123;</span><br><span class="line">    <span class="string">listen</span> <span class="number">443</span> <span class="string">ssl;</span></span><br><span class="line">    <span class="string">server_name</span> <span class="string">domain_name;</span></span><br><span class="line">    <span class="string">ssl_certificate</span> <span class="string">/etc/letsencrypt/live/domain_name/cert.pem;</span></span><br><span class="line">    <span class="string">ssl_certificate_key</span> <span class="string">/etc/letsencrypt/live/domain_name/privkey.pem;</span></span><br><span class="line">    <span class="string">ssl_protocols</span> <span class="string">TLSv1</span> <span class="string">TLSv1.1</span> <span class="string">TLSv1.2;</span></span><br><span class="line">    <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">       <span class="string">proxy_pass</span> <span class="string">http://backend;</span></span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"><span class="string">然后保存文件，退出编辑器并再次重新启动nginx。</span></span><br><span class="line"><span class="string">sudo</span> <span class="string">systemctl</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line"><span class="string">健康检查</span></span><br><span class="line"><span class="string">为了知道哪些服务器可用，nginx的反向代理实现包括被动服务器健康检查。如果服务器无法响应请求或回复错误，nginx会检测到服务失败，并将尝试一段时间内避免转发请求到该服务器。</span></span><br><span class="line"></span><br><span class="line"><span class="string">通过将参数max_fails设置为服务器行，可以在负载均衡器配置文件中定义特定时间段内连续不成功的连接尝试次数。默认情况下，如果未指定max_fails，则将此值设置为1.（可选）将max_fails设置为0将禁用对该服务器的运行状况检查。</span></span><br><span class="line"></span><br><span class="line"><span class="string">如果将max_fails设置为大于1的值，则后续失败必须在特定时间范围内发生，以便无法计数。此时间范围由参数fail_timeout指定，该参数还定义服务器应被视为失败的时间。默认情况下，fail_timeout设置为10秒。</span></span><br><span class="line"></span><br><span class="line"><span class="string">在服务器标记失败并且fail_timeout设置的时间已过后，nginx将开始使用客户端请求正常探测服务器。如果探测返回成功，则服务器再次标记为可用并且正常包含在负载平衡中。</span></span><br><span class="line"><span class="string">upstream</span> <span class="string">backend</span> &#123;</span><br><span class="line">    <span class="string">server</span> <span class="number">10.1</span><span class="number">.0</span><span class="number">.101</span> <span class="string">weight=5;</span></span><br><span class="line">    <span class="string">server</span> <span class="number">10.1</span><span class="number">.0</span><span class="number">.102</span> <span class="string">max_fails=3</span> <span class="string">fail_timeout=30s;</span></span><br><span class="line">    <span class="string">server</span> <span class="number">10.1</span><span class="number">.0</span><span class="number">.103</span><span class="string">;</span></span><br><span class="line"> &#125;</span><br><span class="line"><span class="string">使用运行状况检查可以根据需要通过启动或关闭主机来使服务器后端适应当前需求。在高流量期间启动其他服务器可以在新资源自动供负载均衡器使用时轻松提高应用程序性能。</span></span><br><span class="line"></span><br><span class="line"><span class="string">结论</span></span><br><span class="line"><span class="string">如果您希望提高Web应用程序的性能和可用性，那么设置负载均衡器绝对值得考虑。使用nginx进行负载均衡功能强大且设置相对简单，并且与简单的加密解决方案（例如Let&#x27;s</span> <span class="string">Encrypt客户端）一起使用，它为您的Web场提供了一个很好的前端。</span></span><br><span class="line"></span><br><span class="line"><span class="string">虽然使用多个主机可以保护您的Web服务具有冗余，但负载均衡器本身仍然可能单点故障。您可以通过在多个nginx之间设置浮动IP来进一步提高高可用性。</span></span><br></pre></td></tr></table></figure><h1 id="使用nginx的proxy-cache做网站缓存"><a href="#使用nginx的proxy-cache做网站缓存" class="headerlink" title="使用nginx的proxy_cache做网站缓存"></a>使用nginx的proxy_cache做网站缓存</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">为什么要做web</span> <span class="string">cache，我想大家最主要的是解决流量的压力。随着网站流量的提升，如果只是单台机器既处理静态文件，又处理动态脚本，显然效率很难上升，不能处理日益上涨的流量压力。与此同时某些网站的页面内容并不是经常变化，因此我们可以分两层架构来组织网站。前端web缓存+后端web服务器，可以参看这里配置nginx反向代理配置</span></span><br><span class="line"></span><br><span class="line"><span class="string">前端web缓存有多重方式实现，原理就是队请求结果页面静态化并设置一个超时期限，缓存页面过期后，新请求到达时重新到后端web服务器获取内容更新；没有nginx前比较流行的方法是squid，但squid不能充分利用处理器的多核特性，越来越多的网站选用nginx来做前端的web缓存。</span></span><br><span class="line"></span><br><span class="line"><span class="string">要想使用nginx的缓存功能要保证nginx添加了proxy模块。我们可以使用-V选项(大写的V，小写的v是看版本号的)来查看nginx的编译参数。我使用的是默认的参数编译的，如下所示：</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">root@SNDA-172-17-12-117:/usr/local/nginx#</span> <span class="string">./nginx</span> <span class="string">-V</span></span><br><span class="line"><span class="attr">nginx version:</span> <span class="string">nginx/1.2.3</span></span><br><span class="line"><span class="string">built</span> <span class="string">by</span> <span class="string">gcc</span> <span class="number">4.4</span><span class="number">.3</span> <span class="string">(Ubuntu</span> <span class="number">4.4</span><span class="number">.3</span><span class="string">-4ubuntu5.1)</span></span><br><span class="line"><span class="string">TLS</span> <span class="string">SNI</span> <span class="string">support</span> <span class="string">enabled</span></span><br><span class="line"><span class="attr">configure arguments:</span> <span class="string">--sbin-path=/usr/local/nginx/nginx</span> <span class="string">--conf-path=/usr/local/nginx/nginx.conf</span> <span class="string">--pid-path=/usr/local/nginx/nginx.pid</span> <span class="string">--with-http_ssl_module</span> <span class="string">--with-pcre=/usr/local/src/pcre-8.21</span> <span class="string">--with-zlib=/usr/local/src/zlib-1.2.7</span></span><br><span class="line"></span><br><span class="line"><span class="string">nginx的所有模块必须在编译的时候添加，不能再运行的时候动态加载，默认的编译选项下包含的模块，如果你不是显示的用参数关闭它。</span></span><br><span class="line"></span><br><span class="line"><span class="string">nginx默认安装的模块如下</span></span><br><span class="line"></span><br><span class="line"><span class="string">模块名称</span><span class="string">描述</span><span class="string">版本</span><span class="string">如何禁用</span></span><br><span class="line"><span class="string">Core</span><span class="string">Control</span> <span class="string">ports,</span> <span class="string">locations,</span> <span class="string">error</span> <span class="string">pages,</span> <span class="string">aliases,</span> <span class="string">and</span> <span class="string">other</span> <span class="string">essentials.</span><span class="string">--without-http</span></span><br><span class="line"><span class="string">Access</span><span class="string">Allow/deny</span> <span class="string">based</span> <span class="string">on</span> <span class="string">IP</span> <span class="string">address.</span><span class="string">--without-http_access_module</span></span><br><span class="line"><span class="string">Auth</span> <span class="string">Basic</span><span class="string">Basic</span> <span class="string">HTTP</span> <span class="string">authentication.</span><span class="string">--without-http_auth_basic_module</span></span><br><span class="line"><span class="string">Auto</span> <span class="string">Index</span><span class="string">Generates</span> <span class="string">automatic</span> <span class="string">directory</span> <span class="string">listings.</span><span class="string">--without-http_autoindex_module</span></span><br><span class="line"><span class="string">Browser</span><span class="string">Interpret</span> <span class="string">&quot;User-Agent&quot;</span> <span class="string">string.</span><span class="number">0.4</span><span class="number">.3</span><span class="string">--without-http_browser_module</span></span><br><span class="line"><span class="string">Charset</span><span class="string">Recode</span> <span class="string">web</span> <span class="string">pages.</span><span class="string">--without-http_charset_module</span></span><br><span class="line"><span class="string">Empty</span> <span class="string">GIF</span><span class="string">Serve</span> <span class="string">a</span> <span class="string">1x1</span> <span class="string">image</span> <span class="string">from</span> <span class="string">memory.</span><span class="number">0.3</span><span class="number">.10</span><span class="string">--without-http_empty_gif_module</span></span><br><span class="line"><span class="string">FastCGI</span><span class="string">FastCGI</span> <span class="string">Support.</span><span class="string">--without-http_fastcgi_module</span></span><br><span class="line"><span class="string">Geo</span><span class="string">Set</span> <span class="string">config</span> <span class="string">variables</span> <span class="string">using</span> <span class="string">key/value</span> <span class="string">pairs</span> <span class="string">of</span> <span class="string">IP</span> <span class="string">addresses.</span><span class="number">0.1</span><span class="number">.17</span><span class="string">--without-http_geo_module</span></span><br><span class="line"><span class="string">Gzip</span><span class="string">Gzip</span> <span class="string">responses.</span><span class="string">--without-http_gzip_module</span></span><br><span class="line"><span class="string">Headers</span><span class="string">Set</span> <span class="string">arbitrary</span> <span class="string">HTTP</span> <span class="string">response</span> <span class="string">headers.</span></span><br><span class="line"><span class="string">Index</span><span class="string">Controls</span> <span class="string">which</span> <span class="string">files</span> <span class="string">are</span> <span class="string">to</span> <span class="string">be</span> <span class="string">used</span> <span class="string">as</span> <span class="string">index.</span></span><br><span class="line"><span class="string">Limit</span> <span class="string">Requests</span><span class="string">Limit</span> <span class="string">frequency</span> <span class="string">of</span> <span class="string">connections</span> <span class="string">from</span> <span class="string">a</span> <span class="string">client.</span><span class="number">0.7</span><span class="number">.20</span><span class="string">--without-http_limit_req_module</span></span><br><span class="line"><span class="string">Limit</span> <span class="string">Zone</span><span class="string">Limit</span> <span class="string">simultaneous</span> <span class="string">connections</span> <span class="string">from</span> <span class="string">a</span> <span class="string">client.</span> <span class="string">Deprecated</span> <span class="string">in</span> <span class="number">1.1</span><span class="number">.8</span><span class="string">,</span> <span class="string">use</span> <span class="string">Limit</span> <span class="string">Conn</span> <span class="string">Instead.</span><span class="number">0.5</span><span class="number">.6</span><span class="string">--without-http_limit_zone_module</span></span><br><span class="line"><span class="string">Limit</span> <span class="string">Conn</span><span class="string">Limit</span> <span class="string">concurrent</span> <span class="string">connections</span> <span class="string">based</span> <span class="string">on</span> <span class="string">a</span> <span class="string">variable.</span><span class="string">--without-http_limit_conn_module</span></span><br><span class="line"><span class="string">Log</span><span class="string">Customize</span> <span class="string">access</span> <span class="string">logs.</span></span><br><span class="line"><span class="string">Map</span><span class="string">Set</span> <span class="string">config</span> <span class="string">variables</span> <span class="string">using</span> <span class="string">arbitrary</span> <span class="string">key/value</span> <span class="string">pairs.</span><span class="number">0.3</span><span class="number">.16</span><span class="string">--without-http_map_module</span></span><br><span class="line"><span class="string">Memcached</span><span class="string">Memcached</span> <span class="string">support.</span><span class="string">--without-http_memcached_module</span></span><br><span class="line"><span class="string">Proxy</span><span class="string">Proxy</span> <span class="string">to</span> <span class="string">upstream</span> <span class="string">servers.</span><span class="string">--without-http_proxy_module</span></span><br><span class="line"><span class="string">Referer</span><span class="string">Filter</span> <span class="string">requests</span> <span class="string">based</span> <span class="string">on</span> <span class="string">Referer</span> <span class="string">header.</span><span class="string">--without-http_referer_module</span></span><br><span class="line"><span class="string">Rewrite</span><span class="string">Request</span> <span class="string">rewriting</span> <span class="string">using</span> <span class="string">regular</span> <span class="string">expressions.</span><span class="string">--without-http_rewrite_module</span></span><br><span class="line"><span class="string">SCGI</span><span class="string">SCGI</span> <span class="string">protocol</span> <span class="string">support.</span><span class="number">0.8</span><span class="number">.42</span><span class="string">--without-http_scgi_module</span></span><br><span class="line"><span class="string">Split</span> <span class="string">Clients</span><span class="string">Splits</span> <span class="string">clients</span> <span class="string">based</span> <span class="string">on</span> <span class="string">some</span> <span class="string">conditions</span><span class="number">0.8</span><span class="number">.37</span><span class="string">--without-http_split_clients_module</span></span><br><span class="line"><span class="string">SSI</span><span class="string">Server-side</span> <span class="string">includes.</span><span class="string">--without-http_ssi_module</span></span><br><span class="line"><span class="string">Upstream</span><span class="string">For</span> <span class="string">load-balancing.</span><span class="string">--without-http_upstream_ip_hash_module</span> <span class="string">(ip_hash</span> <span class="string">directive</span> <span class="string">only)</span></span><br><span class="line"><span class="string">User</span> <span class="string">ID</span><span class="string">Issue</span> <span class="string">identifying</span> <span class="string">cookies.</span><span class="string">--without-http_userid_module</span></span><br><span class="line"><span class="string">uWSGI</span><span class="string">uWSGI</span> <span class="string">protocol</span> <span class="string">support.</span><span class="number">0.8</span><span class="number">.40</span><span class="string">--without-http_uwsgi_module</span></span><br><span class="line"><span class="string">X-Accel</span><span class="string">X-Sendfile-like</span> <span class="string">module.</span></span><br><span class="line"><span class="string">proxy模块中常用的指令时proxy_pass和proxy_cache.</span></span><br><span class="line"></span><br><span class="line"><span class="string">nginx的web缓存功能的主要是由proxy_cache、fastcgi_cache指令集和相关指令集完成，proxy_cache指令负责反向代理缓存后端服务器的静态内容，fastcgi_cache主要用来处理FastCGI动态进程缓存(这里我不是很清楚这两个指令的区别，好像功能上都差不多，尤其后面这句话的意思，是我翻译过来的)。</span></span><br><span class="line"></span><br><span class="line"><span class="string">确认proxy模块安装好后，下面对nginx的配置文件进行设置，重点部分如标红字体所示。</span></span><br><span class="line"></span><br><span class="line"><span class="string">这是我的nginx.conf配置文件。</span></span><br><span class="line"></span><br><span class="line"><span class="string">user</span> <span class="string">www-data;</span></span><br><span class="line"><span class="string">worker_processes</span> <span class="number">1</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#error_log logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log logs/error.log notice;</span></span><br><span class="line"><span class="comment">#error_log logs/error.log info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid logs/nginx.pid;</span></span><br><span class="line"><span class="string">events</span> &#123;</span><br><span class="line"><span class="string">worker_connections</span> <span class="number">1024</span><span class="string">;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">http</span> &#123;</span><br><span class="line"><span class="string">include</span> <span class="string">mime.types;</span></span><br><span class="line"><span class="string">default_type</span> <span class="string">application/octet-stream;</span></span><br><span class="line"></span><br><span class="line"><span class="string">log_format</span> <span class="string">main</span> <span class="string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line"><span class="string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line"><span class="string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot; &quot;$host&quot;&#x27;</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#access_log logs/access.log main;</span></span><br><span class="line"></span><br><span class="line"><span class="string">sendfile</span> <span class="string">on;</span></span><br><span class="line"><span class="comment">#tcp_nopush on;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#keepalive_timeout 0;</span></span><br><span class="line"><span class="string">keepalive_timeout</span> <span class="number">65</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Compression Settings</span></span><br><span class="line"><span class="string">gzip</span> <span class="string">on;</span></span><br><span class="line"><span class="string">gzip_http_version</span> <span class="number">1.0</span><span class="string">;</span></span><br><span class="line"><span class="string">gzip_comp_level</span> <span class="number">2</span><span class="string">;</span></span><br><span class="line"><span class="string">gzip_proxied</span> <span class="string">any;</span></span><br><span class="line"><span class="string">gzip_min_length</span> <span class="number">1100</span><span class="string">;</span></span><br><span class="line"><span class="string">gzip_buffers</span> <span class="number">16</span> <span class="string">8k;</span></span><br><span class="line"><span class="string">gzip_types</span> <span class="string">text/plain</span> <span class="string">text/css</span> <span class="string">application/x-javascript</span> <span class="string">text/xml</span> <span class="string">application/xml</span> <span class="string">application/xml+rss</span> <span class="string">text/javascript;</span></span><br><span class="line"><span class="comment"># Some version of IE 6 don&#x27;t handle compression well on some mime-types,</span></span><br><span class="line"><span class="comment"># so just disable for them</span></span><br><span class="line"><span class="string">gzip_disable</span> <span class="string">&quot;MSIE [1-6].(?!.*SV1)&quot;</span><span class="string">;</span></span><br><span class="line"><span class="comment"># Set a vary header so downstream proxies don&#x27;t send cached gzipped</span></span><br><span class="line"><span class="comment"># content to IE6</span></span><br><span class="line"><span class="string">gzip_vary</span> <span class="string">on;</span></span><br><span class="line"><span class="comment">#end gzip</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#cache begin</span></span><br><span class="line"><span class="string">proxy_buffering</span> <span class="string">on;</span></span><br><span class="line"><span class="string">proxy_cache_valid</span> <span class="string">any</span> <span class="string">10m;</span></span><br><span class="line"><span class="string">proxy_cache_path</span> <span class="string">/data/cache</span> <span class="string">levels=1:2</span> <span class="string">keys_zone=my-cache:8m</span> <span class="string">max_size=1000m</span> <span class="string">inactive=600m;</span></span><br><span class="line"><span class="string">proxy_temp_path</span> <span class="string">/data/temp;</span></span><br><span class="line"><span class="string">proxy_buffer_size</span> <span class="string">4k;</span></span><br><span class="line"><span class="string">proxy_buffers</span> <span class="number">100</span> <span class="string">8k;</span></span><br><span class="line"><span class="comment">#cache end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Basic reverse proxy server ##</span></span><br><span class="line"><span class="comment">## Apache (vm02) backend for www.example.com ##</span></span><br><span class="line"><span class="string">upstream</span> <span class="string">apachephp</span> &#123;</span><br><span class="line"><span class="string">server</span> <span class="string">www.quancha.cn:8080;</span> <span class="comment">#Apache1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## Start www.quancha.cn ##</span></span><br><span class="line"><span class="string">server</span> &#123;</span><br><span class="line"><span class="string">listen</span> <span class="number">80</span><span class="string">;</span></span><br><span class="line"><span class="string">server_name</span> <span class="string">*.quancha.cn;</span></span><br><span class="line"></span><br><span class="line"><span class="string">access_log</span> <span class="string">logs/quancha.access.log</span> <span class="string">main;</span></span><br><span class="line"><span class="string">error_log</span> <span class="string">logs/quancha.error.log;</span></span><br><span class="line"><span class="string">root</span> <span class="string">html;</span></span><br><span class="line"><span class="string">index</span> <span class="string">index.html</span> <span class="string">index.htm</span> <span class="string">index.php;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## send request back to apache1 ##</span></span><br><span class="line"><span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line"><span class="string">proxy_pass</span> <span class="string">http://apachephp;</span></span><br><span class="line"><span class="string">proxy_cache</span> <span class="string">my-cache;</span></span><br><span class="line"><span class="string">proxy_cache_valid</span> <span class="number">200</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Proxy Settings</span></span><br><span class="line"><span class="string">proxy_redirect</span> <span class="string">off;</span></span><br><span class="line"><span class="string">proxy_set_header</span> <span class="string">Host</span> <span class="string">$host;</span></span><br><span class="line"><span class="string">proxy_set_header</span> <span class="string">X-Real-IP</span> <span class="string">$remote_addr;</span></span><br><span class="line"><span class="string">proxy_set_header</span> <span class="string">X-Forwarded-For</span> <span class="string">$proxy_add_x_forwarded_for;</span></span><br><span class="line"><span class="string">proxy_next_upstream</span> <span class="string">error</span> <span class="string">timeout</span> <span class="string">invalid_header</span> <span class="string">http_500</span> <span class="string">http_502</span> <span class="string">http_503</span> <span class="string">http_504;</span></span><br><span class="line"><span class="string">proxy_max_temp_file_size</span> <span class="number">0</span><span class="string">;</span></span><br><span class="line"><span class="string">proxy_connect_timeout</span> <span class="number">90</span><span class="string">;</span></span><br><span class="line"><span class="string">proxy_send_timeout</span> <span class="number">90</span><span class="string">;</span></span><br><span class="line"><span class="string">proxy_read_timeout</span> <span class="number">90</span><span class="string">;</span></span><br><span class="line"><span class="string">proxy_buffer_size</span> <span class="string">4k;</span></span><br><span class="line"><span class="string">proxy_buffers</span> <span class="number">4</span> <span class="string">32k;</span></span><br><span class="line"><span class="string">proxy_busy_buffers_size</span> <span class="string">64k;</span></span><br><span class="line"><span class="string">proxy_temp_file_write_size</span> <span class="string">64k;</span></span><br><span class="line"><span class="comment">##End Proxy Settings</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">## End www.quancha.cn ##</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">配置文件中以proxy_开头的指令我们大都可以字面意思得到理解。请务必注意一点proxy_cache_path和proxy_temp_path设置的目录需要在同一分区，因为它们之间是硬链接的关系。</span></span><br><span class="line"></span><br><span class="line"><span class="string">最后启动nginx，来迎接着激动人心的时刻吧。我已经迫不及待了。如果文章哪里有问题或者你遇到了什么麻烦，可以留言让我知道。</span></span><br></pre></td></tr></table></figure><h1 id="nginx屏蔽ip"><a href="#nginx屏蔽ip" class="headerlink" title="nginx屏蔽ip"></a>nginx屏蔽ip</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">采集和防止采集是一个经久不息的话题，一方面都想搞别人的东西，另一方面不想自己的东西被别人搞走。</span></span><br><span class="line"></span><br><span class="line"><span class="string">本文介绍如何利用nginx屏蔽ip来实现防止采集，当然也可以通过iptable来实现。</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span><span class="string">.查找要屏蔽的ip</span></span><br><span class="line"><span class="string">awk</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> <span class="string">nginx.access.log</span> <span class="string">|sort</span> <span class="string">|uniq</span> <span class="string">-c|sort</span> <span class="string">-n</span></span><br><span class="line"><span class="string">nginx.access.log</span> <span class="string">为日志文件，</span></span><br><span class="line"></span><br><span class="line"><span class="string">会到如下结果，前面是ip的访问次数，后面是ip，很明显我们需要把访问次数多的ip并且不是蜘蛛的ip屏蔽掉，本例当中我们屏蔽掉165.91.122.67</span></span><br><span class="line"> <span class="string">...</span></span><br><span class="line">  <span class="number">13610</span> <span class="number">202.112</span><span class="number">.113</span><span class="number">.192</span></span><br><span class="line">  <span class="number">95772</span> <span class="number">180.169</span><span class="number">.22</span><span class="number">.135</span></span><br><span class="line"> <span class="number">337418</span> <span class="number">219.220</span><span class="number">.141</span><span class="number">.2</span></span><br><span class="line"> <span class="number">558378</span> <span class="number">165.91</span><span class="number">.122</span><span class="number">.67</span></span><br><span class="line"><span class="number">2</span><span class="string">.在nginx的安装目录下面,新建屏蔽ip文件，命名为blockip.conf，以后新增加屏蔽ip只需编辑这个文件即可。</span> <span class="string">加入如下内容</span></span><br><span class="line"><span class="string">deny</span> <span class="number">165.91</span><span class="number">.122</span><span class="number">.67</span><span class="string">;</span> </span><br><span class="line"><span class="string">保存一下。</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span><span class="string">.在nginx的配置文件nginx.conf中加入如下配置，可以放到http,</span> <span class="string">server,</span> <span class="string">location,</span> <span class="string">limit_except语句块，需要注意相对路径，本例当中nginx.conf，blocksip.conf在同一个目录中。</span></span><br><span class="line"><span class="string">include</span> <span class="string">blockip.conf;</span> </span><br><span class="line"></span><br><span class="line"><span class="number">4</span><span class="string">.重启一下nginx的服务：/usr/local/nginx/nginx</span> <span class="string">-s</span> <span class="string">reload</span> <span class="string">就可以生效了。</span></span><br><span class="line"></span><br><span class="line"><span class="string">高级用法：</span></span><br><span class="line"></span><br><span class="line"><span class="string">屏蔽ip的配置文件既可以屏蔽单个ip，也可以屏蔽ip段，或者只允许某个ip或者某个ip段访问。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 屏蔽单个ip访问</span></span><br><span class="line"><span class="string">deny</span> <span class="string">IP;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许单个ip访问</span></span><br><span class="line"><span class="string">allow</span> <span class="string">IP;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 屏蔽所有ip访问</span></span><br><span class="line"><span class="string">deny</span> <span class="string">all;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许所有ip访问</span></span><br><span class="line"><span class="string">allow</span> <span class="string">all;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#屏蔽整个段即从123.0.0.1到123.255.255.254访问的命令</span></span><br><span class="line"><span class="string">deny</span> <span class="number">123.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#屏蔽IP段即从123.45.0.1到123.45.255.254访问的命令</span></span><br><span class="line"><span class="string">deny</span> <span class="number">124.45</span><span class="number">.0</span><span class="number">.0</span><span class="string">/16</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#屏蔽IP段即从123.45.6.1到123.45.6.254访问的命令</span></span><br><span class="line"><span class="string">deny</span> <span class="number">123.45</span><span class="number">.6</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line"></span><br><span class="line"><span class="string">如果你想实现这样的应用，除了几个IP外，其他全部拒绝，</span></span><br><span class="line"><span class="string">那需要你在blockip.conf中这样写</span></span><br><span class="line"><span class="string">allow</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span><span class="string">;</span> </span><br><span class="line"><span class="string">allow</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.2</span><span class="string">;</span></span><br><span class="line"><span class="string">deny</span> <span class="string">all;</span> </span><br><span class="line"><span class="string">单独网站屏蔽IP的方法，把include</span> <span class="string">blocksip.conf;</span> <span class="string">放到网址对应的在server&#123;&#125;语句块，</span></span><br><span class="line"><span class="string">所有网站屏蔽IP的方法，把include</span> <span class="string">blocksip.conf;</span> <span class="string">放到http</span> &#123;&#125;<span class="string">语句块。</span></span><br></pre></td></tr></table></figure><h1 id="nginx-“403-Forbidden”-错误"><a href="#nginx-“403-Forbidden”-错误" class="headerlink" title="nginx “403 Forbidden” 错误"></a>nginx “403 Forbidden” 错误</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">nginx</span> <span class="string">的</span> <span class="number">403</span> <span class="string">Forbidden</span> <span class="string">errors</span> <span class="string">表示你在请求一个资源文件但是nginx不允许你查看。</span></span><br><span class="line"><span class="number">403</span> <span class="string">Forbidden</span> <span class="string">只是一个HTTP状态码，像404,200一样不是技术上的错误。</span></span><br><span class="line"><span class="string">哪些场景需要返回403状态码的场景？</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span><span class="string">.网站禁止特定的用户访问所有内容，例：网站屏蔽某个ip访问。</span></span><br><span class="line"><span class="number">2</span><span class="string">.访问禁止目录浏览的目录，例：设置autoindex</span> <span class="string">off后访问目录。</span></span><br><span class="line"><span class="number">3</span><span class="string">.用户访问只能被内网访问的文件。</span></span><br><span class="line"></span><br><span class="line"><span class="string">以上几种常见的需要返回</span> <span class="number">403</span> <span class="string">Forbidden</span> <span class="string">的场景。</span></span><br><span class="line"></span><br><span class="line"><span class="string">由于服务器端的错误配置导致在不希望nginx返回403时返回403</span> <span class="string">Forbidden。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">1</span><span class="string">.权限配置不正确</span></span><br><span class="line"></span><br><span class="line"><span class="string">这个是nginx出现403</span> <span class="string">forbidden最常见的原因。</span></span><br><span class="line"></span><br><span class="line"><span class="string">为了保证文件能正确执行，nginx既需要文件的读权限,又需要文件所有父目录的可执行权限。</span></span><br><span class="line"></span><br><span class="line"><span class="string">例如，当访问/usr/local/nginx/html/image.jpg时，nginx既需要image.jpg文件的可读权限，也需要/,/usr,/usr/local,/usr/local/nginx,/usr/local/nginx/html的可以执行权限。</span></span><br><span class="line"></span><br><span class="line"><span class="string">解决办法:设置所有父目录为755权限，设置文件为644权限可以避免权限不正确。</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="number">2</span><span class="string">.目录索引设置错误（index指令配置）</span></span><br><span class="line"></span><br><span class="line"><span class="string">网站根目录不包含index指令设置的文件。</span></span><br><span class="line"></span><br><span class="line"><span class="string">例如，运行PHP的网站，通常像这样配置index</span></span><br><span class="line"></span><br><span class="line"><span class="string">index</span>  <span class="string">index.html</span> <span class="string">index.htm</span> <span class="string">index.php;</span></span><br><span class="line"></span><br><span class="line"><span class="string">当访问该网站的时，nginx</span> <span class="string">会按照</span> <span class="string">index.html，index.htm</span> <span class="string">，index.php</span> <span class="string">的先后顺序在根目录中查找文件。如果这三个文件都不存在，那么nginx就会返回403</span> <span class="string">Forbidden。</span></span><br><span class="line"></span><br><span class="line"><span class="string">如果index中不定义</span> <span class="string">index.php</span> <span class="string">，nginx直接返回403</span> <span class="string">Forbidden而不会去检查index.php是否存在。</span></span><br><span class="line"></span><br><span class="line"><span class="string">同样对于如果运行jsp,</span> <span class="string">py时也需要添加index.jsp,index.py到目录索引指令index中。</span></span><br><span class="line"></span><br><span class="line"><span class="string">解决办法:添加首页文件到index指令，常见的是index.php，index.jsp，index.jsp或者自定义首页文件。</span></span><br></pre></td></tr></table></figure><h1 id="nginx-File-not-found-错误"><a href="#nginx-File-not-found-错误" class="headerlink" title="nginx File not found 错误"></a>nginx File not found 错误</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">使用php-fpm解析PHP，&quot;No</span> <span class="string">input</span> <span class="string">file</span> <span class="string">specified&quot;，&quot;File</span> <span class="string">not</span> <span class="string">found&quot;是令nginx新手头疼的常见错误，原因是php-fpm进程找不到SCRIPT_FILENAME配置的要执行的.php文件，php-fpm返回给nginx的默认404错误提示。</span></span><br><span class="line"></span><br><span class="line"><span class="string">比如我的网站doucument_root下没有test.php，访问这个文件时通过抓包可以看到返回的内容。</span></span><br><span class="line"></span><br><span class="line"><span class="string">HTTP/1.1</span> <span class="number">404</span> <span class="string">Not</span> <span class="string">Found</span></span><br><span class="line"><span class="attr">Date:</span> <span class="string">Fri,</span> <span class="number">21</span> <span class="string">Dec</span> <span class="number">2012 08:15:28 </span><span class="string">GMT</span></span><br><span class="line"><span class="attr">Content-Type:</span> <span class="string">text/html</span></span><br><span class="line"><span class="attr">Proxy-Connection:</span> <span class="string">close</span></span><br><span class="line"><span class="attr">Server:</span> <span class="string">nginx/1.2.5</span></span><br><span class="line"><span class="attr">X-Powered-By:</span> <span class="string">PHP/5.4.7</span></span><br><span class="line"><span class="attr">Via:</span> <span class="number">1.1</span> <span class="string">c3300</span> <span class="string">(NetCache</span> <span class="string">NetApp/6.0.7)</span></span><br><span class="line"><span class="attr">Content-Length:</span> <span class="number">16</span></span><br><span class="line"></span><br><span class="line"><span class="string">File</span> <span class="string">not</span> <span class="string">found.</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="string">很多人不想用户直接看到这个默认的404错误信息，想自定义404错误.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">给出解决办法前我们来先分析下如何避免出现这类404错误，然后再说真的遇到这种情况(比如用户输入一个错误不存在的路径)时该怎么办，才能显示自定义的404错误页。</span></span><br><span class="line"></span><br><span class="line"><span class="string">一、错误的路径被发送到php-fpm进程</span></span><br><span class="line"><span class="string">出现这类错误，十个有九个是后端fastcgi进程收到错误路径(SCRIPT_FILENAME)，而后端fastcgi收到错误路径的原因大都是配置错误。</span></span><br><span class="line"></span><br><span class="line"><span class="string">常见的nginx.conf的配置如下：</span></span><br><span class="line"><span class="string">server</span> &#123;</span><br><span class="line">    <span class="string">listen</span>   [<span class="string">::</span>]<span class="string">:80;</span></span><br><span class="line">    <span class="string">server_name</span>  <span class="string">example.com</span> <span class="string">www.example.com;</span></span><br><span class="line">    <span class="string">access_log</span>  <span class="string">/var/www/logs/example.com.access.log;</span>  </span><br><span class="line"> </span><br><span class="line">    <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">        <span class="string">root</span>   <span class="string">/var/www/example.com;</span></span><br><span class="line">        <span class="string">index</span>  <span class="string">index.html</span> <span class="string">index.htm</span> <span class="string">index.pl;</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="string">location</span> <span class="string">/images</span> &#123;</span><br><span class="line">        <span class="string">autoindex</span> <span class="string">on;</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="string">location</span> <span class="string">~</span> <span class="string">.php$</span> &#123;</span><br><span class="line">        <span class="string">fastcgi_pass</span>   <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9000;</span></span><br><span class="line">        <span class="string">fastcgi_index</span>  <span class="string">index.php;</span></span><br><span class="line">        <span class="string">fastcgi_param</span>  <span class="string">SCRIPT_FILENAME</span>  <span class="string">/var/www/example.com$fastcgi_script_name;</span></span><br><span class="line">        <span class="string">include</span> <span class="string">fastcgi_params;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">这个配置中有很多不合理的地方，其中一个明显的问题就是root指令被放到了location</span> <span class="string">/</span> <span class="string">块。如果root指令被定义在location块中那么该root指令只能对其所在的location生效。其它locaiont中没有root指令，像location</span> <span class="string">/images块不会匹配任何请求，需要在每个请求中重复配置root指令来解决这个问题。因此我们需要把root指令放在server块，这样各个location就会继承父server块定义的$document_root，如果某个location需要定义一个不同的$document_root，则可以在location单独定义一个root指令。</span></span><br><span class="line"></span><br><span class="line"><span class="string">另一个问题就是fastCGI参数SCRIPT_FILENAME</span> <span class="string">是写死的。如果修改了root指令的值或者移动文件到别的目录，php-fpm会返回“No</span> <span class="string">input</span> <span class="string">file</span> <span class="string">specified”错误，因为SCRIPT_FILENAME在配置中是写死的并没有随着$doucument_root变化而变化，我们可以修改SCRIPT_FILENAME配置如下：</span></span><br><span class="line"></span><br><span class="line"><span class="string">fastcgi_param</span>  <span class="string">SCRIPT_FILENAME</span>  <span class="string">$document_root$fastcgi_script_name;</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="string">所以我们不能忘记在server块中配置root指令，不然$document_root的值为空，只会传$fastcgi_script_name到php-fpm，这样就会导致“No</span> <span class="string">input</span> <span class="string">file</span> <span class="string">specified”错误。</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="string">二、请求的文件真的不存在</span></span><br><span class="line"><span class="string">当nginx收到一个不在的.php文件的请求时,因为nginx只会检查$uri是否是.php结尾，不会对文件是否存在进行判断，.php结尾的请求nginx会直接发给php-fpm处理。php-fpm处理时找不到文件就会返回“No</span> <span class="string">input</span> <span class="string">file</span> <span class="string">specified”带着“404</span> <span class="string">Not</span> <span class="string">Found”头。</span></span><br><span class="line"></span><br><span class="line"><span class="string">解决办法</span></span><br><span class="line"><span class="string">我们在nginx拦截不存在的文件，请求并返回自定义404错误</span></span><br><span class="line"></span><br><span class="line"><span class="string">使用</span> <span class="string">try_files</span> <span class="string">捕捉不存在的urls并返回错误。</span></span><br><span class="line"><span class="string">location</span> <span class="string">~</span> <span class="string">.php$</span> &#123;</span><br><span class="line"> <span class="string">try_files</span> <span class="string">$uri</span> <span class="string">=404;</span></span><br><span class="line"> <span class="string">fastcgi_pass</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9000;</span></span><br><span class="line"> <span class="string">fastcgi_index</span> <span class="string">index.php;</span></span><br><span class="line"> <span class="string">fastcgi_param</span> <span class="string">SCRIPT_FILENAME</span> <span class="string">....</span></span><br><span class="line"> <span class="string">...................................</span></span><br><span class="line"> <span class="string">...................................</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">上面的配置会检查.php文件是否存在，如果不存在，会返回404页面。</span></span><br></pre></td></tr></table></figure><h1 id="nginx将POST数据写到日志里"><a href="#nginx将POST数据写到日志里" class="headerlink" title="nginx将POST数据写到日志里"></a>nginx将POST数据写到日志里</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">NGINX</span> <span class="string">是一个强大的web服务器，可以很容易的应对高负载的HTTP流量。nginx每处理一个连接，就会记录一条日志信息，包括诸如：IP地址，回复内容大小、http状态码等信息。</span></span><br><span class="line"></span><br><span class="line"><span class="string">某种情况下，需要了解请求内容是什么，特别</span> <span class="string">POST</span> <span class="string">请求。</span> <span class="string">NGINX</span> <span class="string">默认只支持记录GET请求，对于记录POST请求需要使用额外的模块，例如，</span> <span class="string">Echo</span> <span class="string">module,</span> <span class="string">这个模块提供很多有用的指令:</span> <span class="string">echo,</span> <span class="string">time,</span> <span class="string">and</span> <span class="string">sleep。</span></span><br><span class="line"></span><br><span class="line"><span class="string">记录POST请求我们需要使用到其中的</span> <span class="string">echo_read_request_body</span> <span class="string">命令和</span> <span class="string">$request_body</span> <span class="string">变量。</span></span><br><span class="line"></span><br><span class="line"><span class="string">源码编译nginx增加echo模块步骤:</span></span><br><span class="line"><span class="number">1</span><span class="string">.下载nginx和echo模块的源码：</span></span><br><span class="line"><span class="string">curl</span> <span class="string">-L</span> <span class="string">-O</span> <span class="string">&#x27;https://github.com/openresty/echo-nginx-module/archive/v0.61.tar.gz&#x27;</span></span><br><span class="line"><span class="string">tar</span> <span class="string">-xzvf</span> <span class="string">v0.61.tar.gz</span> <span class="string">&amp;&amp;</span> <span class="string">rm</span> <span class="string">-f</span> <span class="string">v0.61.tar.gz</span></span><br><span class="line"><span class="string">mv</span> <span class="string">echo-nginx-module-0.61</span> <span class="string">/tmp/echo-nginx-module</span></span><br><span class="line"><span class="string">wget</span> <span class="string">https://www.openssl.org/source/openssl-1.1.1g.tar.gz</span></span><br><span class="line"><span class="string">tar</span> <span class="string">-zxvf</span> <span class="string">openssl-1.1.1g.tar.gz</span> <span class="string">&amp;&amp;</span> <span class="string">openssl-1.1.1g.tar.gz</span></span><br><span class="line"><span class="string">mv</span> <span class="string">openssl-1.1.1g</span> <span class="string">/tmp/openssl-1.1.1g</span></span><br><span class="line"><span class="string">curl</span> <span class="string">-O</span> <span class="string">&#x27;http://nginx.org/download/nginx-1.18.0.tar.gz&#x27;</span></span><br><span class="line"><span class="string">tar</span> <span class="string">-xzvf</span> <span class="string">nginx-1.18.0.tar.gz</span> <span class="string">&amp;&amp;</span> <span class="string">rm</span> <span class="string">-f</span> <span class="string">nginx-1.18.0.tar.gz</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span><span class="string">.创建</span> <span class="string">nginx</span> <span class="string">用户，</span> <span class="string">用来运行nginx进程：</span></span><br><span class="line"><span class="string">groupadd</span> <span class="string">nginx</span></span><br><span class="line"><span class="string">useradd</span> <span class="string">-g</span> <span class="string">nginx</span> <span class="string">nginx</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span><span class="string">.从源码编译安装nginx：</span></span><br><span class="line"><span class="string">cd</span> <span class="string">nginx-1.18.0/</span> <span class="string">&amp;&amp;</span> <span class="string">./configure</span> <span class="string">\</span></span><br><span class="line"> <span class="string">--user=nginx</span> <span class="string">\</span></span><br><span class="line"> <span class="string">--group=nginx</span> <span class="string">\</span></span><br><span class="line"> <span class="string">--prefix=/usr/local/nginx</span> <span class="string">\</span></span><br><span class="line"> <span class="string">--with-http_gzip_static_module</span> <span class="string">\</span></span><br><span class="line"> <span class="string">--with-http_stub_status_module</span> <span class="string">\</span></span><br><span class="line"> <span class="string">--with-http_ssl_module</span> <span class="string">\</span></span><br><span class="line"> <span class="string">--with-pcre</span> <span class="string">\</span></span><br><span class="line"> <span class="string">--with-file-aio</span> <span class="string">\</span></span><br><span class="line"> <span class="string">--with-http_realip_module</span> <span class="string">\</span></span><br><span class="line"> <span class="string">--with-openssl=/tmp/openssl-1.1.1g</span> <span class="string">\</span></span><br><span class="line"> <span class="string">--add-module=/tmp/echo-nginx-module</span></span><br><span class="line"> </span><br><span class="line"><span class="string">make</span> <span class="string">-j2</span></span><br><span class="line"><span class="string">make</span> <span class="string">install</span></span><br><span class="line"> </span><br><span class="line"><span class="string">现在，nginx已安装完成，可以启动了。启动之前我们需要修改nginx的默认配置文件</span> <span class="string">/usr/local/nginx/conf/nginx.conf</span>  <span class="string">来记录</span> <span class="string">HTTP</span> <span class="string">request</span> <span class="string">body</span> <span class="string">到日志文件。</span></span><br><span class="line"></span><br><span class="line"><span class="string">NGINX</span> <span class="string">使用</span> <span class="string">access_log</span> <span class="string">指令记录多种</span> <span class="string">HTTP</span> <span class="string">请求相关的信息，哪些信息会或不会被记录则通过</span> <span class="string">log_format</span> <span class="string">指令来设置。Echo</span> <span class="string">模块通过调用</span> <span class="string">echo_read_request_body</span> <span class="string">方法存储</span> <span class="string">request</span> <span class="string">body</span> <span class="string">到</span> <span class="string">request_body</span> <span class="string">变量中。为了记录</span> <span class="string">POST</span> <span class="string">请求体需要在配置文件中修改这些指令:</span></span><br><span class="line"></span><br><span class="line"><span class="string">http</span> &#123;</span><br><span class="line"> <span class="string">...</span></span><br><span class="line"> <span class="string">log_format</span> <span class="string">custom</span> <span class="string">&#x27;$request_body&#x27;</span><span class="string">;</span></span><br><span class="line"> <span class="string">access_log</span> <span class="string">logs/access.log</span> <span class="string">custom;</span></span><br><span class="line"> <span class="string">...</span></span><br><span class="line"> <span class="string">server</span> &#123;</span><br><span class="line">  <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">   <span class="string">echo_read_request_body;</span></span><br><span class="line">    <span class="string">...</span></span><br><span class="line">  &#125; </span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">如果你的系统负载很高，你可以通过提高Linux打开文件数参数的大小来提高</span> <span class="string">NGINX</span> <span class="string">的处理能力。通过如下指令增加配置到文件末尾或直接修改相应的配置文件。</span></span><br><span class="line"></span><br><span class="line"><span class="string">echo</span> <span class="string">&quot;fs.file-max = 1073741824&quot;</span> <span class="string">&gt;&gt;</span> <span class="string">/etc/sysctl.conf</span></span><br><span class="line"><span class="string">echo</span> <span class="string">&quot;nginx soft nofile 40960&quot;</span> <span class="string">&gt;&gt;</span> <span class="string">/etc/security/limits.conf</span></span><br><span class="line"><span class="string">echo</span> <span class="string">&quot;nginx hard nofile 81920&quot;</span> <span class="string">&gt;&gt;</span> <span class="string">/etc/security/limits.conf</span></span><br><span class="line"><span class="string">终于可以启动nginx并记录POST的请求内容了，运行nginx命令：</span></span><br><span class="line"></span><br><span class="line"><span class="string">/usr/local/nginx/sbin/nginx</span></span><br><span class="line"><span class="string">测试</span></span><br><span class="line"><span class="string">修改配置文件增加上面提到的三个配置。</span></span><br><span class="line"></span><br><span class="line">[<span class="string">root@67</span> <span class="string">nginx</span>]<span class="comment"># cd /usr/local/nginx/conf/</span></span><br><span class="line"></span><br><span class="line">[<span class="string">root@67</span> <span class="string">conf</span>]<span class="comment"># vi nginx.conf</span></span><br><span class="line"></span><br><span class="line"><span class="string">测试并重新加载配置文件</span></span><br><span class="line"></span><br><span class="line">[<span class="string">root@67</span> <span class="string">conf</span>]<span class="comment"># /usr/local/nginx/sbin/nginx -t</span></span><br><span class="line"></span><br><span class="line"><span class="attr">nginx:</span> <span class="string">the</span> <span class="string">configuration</span> <span class="string">file</span> <span class="string">/usr/local/nginx/conf/nginx.conf</span> <span class="string">syntax</span> <span class="string">is</span> <span class="string">ok</span></span><br><span class="line"></span><br><span class="line"><span class="attr">nginx:</span> <span class="string">configuration</span> <span class="string">file</span> <span class="string">/usr/local/nginx/conf/nginx.conf</span> <span class="string">test</span> <span class="string">is</span> <span class="string">successful</span></span><br><span class="line"></span><br><span class="line">[<span class="string">root@67</span> <span class="string">conf</span>]<span class="comment"># /usr/local/nginx/sbin/nginx -s reload</span></span><br><span class="line"></span><br><span class="line"><span class="string">不带post参数会记录一个短横</span></span><br><span class="line"></span><br><span class="line">[<span class="string">root@67</span> <span class="string">conf</span>]<span class="comment"># curl 127.0.0.1</span></span><br><span class="line"></span><br><span class="line">[<span class="string">root@67</span> <span class="string">conf</span>]<span class="comment"># curl 127.0.0.1</span></span><br><span class="line"></span><br><span class="line">[<span class="string">root@67</span> <span class="string">conf</span>]<span class="comment"># cd ../logs/</span></span><br><span class="line"></span><br><span class="line">[<span class="string">root@67</span> <span class="string">logs</span>]<span class="comment"># tail -f access.log </span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line"></span><br><span class="line">[<span class="string">root@67</span> <span class="string">logs</span>]<span class="comment"># curl -d &quot;site=redis.com.cn&quot; 127.0.0.1</span></span><br><span class="line"></span><br><span class="line">[<span class="string">root@67</span> <span class="string">logs</span>]<span class="comment"># tail -f access.log </span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line"></span><br><span class="line"><span class="string">site=redis.com.cn</span></span><br><span class="line"></span><br><span class="line"><span class="string">排错</span></span><br><span class="line"><span class="number">1</span><span class="string">.</span></span><br><span class="line"></span><br><span class="line"><span class="string">checking</span> <span class="string">for</span> <span class="string">getaddrinfo()</span> <span class="string">...</span> <span class="string">found</span></span><br><span class="line"></span><br><span class="line"><span class="string">configuring</span> <span class="string">additional</span> <span class="string">modules</span></span><br><span class="line"></span><br><span class="line"><span class="string">adding</span> <span class="string">module</span> <span class="string">in</span> <span class="string">/tmp/echo-nginx-module</span></span><br><span class="line"></span><br><span class="line"><span class="string">/tmp/echo-nginx-module/config:</span> <span class="attr">line 41:</span> [<span class="string">:</span> <span class="type">!=:</span> <span class="string">unary</span> <span class="string">operator</span> <span class="string">expected</span></span><br><span class="line"></span><br><span class="line"> <span class="string">+</span> <span class="string">ngx_http_echo_module</span> <span class="string">was</span> <span class="string">configured</span></span><br><span class="line"></span><br><span class="line"><span class="string">checking</span> <span class="string">for</span> <span class="string">PCRE</span> <span class="string">library</span> <span class="string">...</span> <span class="string">not</span> <span class="string">found</span></span><br><span class="line"></span><br><span class="line"><span class="string">checking</span> <span class="string">for</span> <span class="string">PCRE</span> <span class="string">library</span> <span class="string">in</span> <span class="string">/usr/local/</span> <span class="string">...</span> <span class="string">not</span> <span class="string">found</span></span><br><span class="line"></span><br><span class="line"><span class="string">checking</span> <span class="string">for</span> <span class="string">PCRE</span> <span class="string">library</span> <span class="string">in</span> <span class="string">/usr/include/pcre/</span> <span class="string">...</span> <span class="string">not</span> <span class="string">found</span></span><br><span class="line"></span><br><span class="line"><span class="string">checking</span> <span class="string">for</span> <span class="string">PCRE</span> <span class="string">library</span> <span class="string">in</span> <span class="string">/usr/pkg/</span> <span class="string">...</span> <span class="string">not</span> <span class="string">found</span></span><br><span class="line"></span><br><span class="line"><span class="string">checking</span> <span class="string">for</span> <span class="string">PCRE</span> <span class="string">library</span> <span class="string">in</span> <span class="string">/opt/local/</span> <span class="string">...</span> <span class="string">not</span> <span class="string">found</span></span><br><span class="line"></span><br><span class="line"><span class="string">./configure:</span> <span class="attr">error:</span> <span class="string">the</span> <span class="string">HTTP</span> <span class="string">rewrite</span> <span class="string">module</span> <span class="string">requires</span> <span class="string">the</span> <span class="string">PCRE</span> <span class="string">library.</span></span><br><span class="line"></span><br><span class="line"><span class="string">You</span> <span class="string">can</span> <span class="string">either</span> <span class="string">disable</span> <span class="string">the</span> <span class="string">module</span> <span class="string">by</span> <span class="string">using</span> <span class="string">--without-http_rewrite_module</span></span><br><span class="line"></span><br><span class="line"><span class="string">option</span>, <span class="string">or</span> <span class="string">install</span> <span class="string">the</span> <span class="string">PCRE</span> <span class="string">library</span> <span class="string">into</span> <span class="string">the</span> <span class="string">system</span>, <span class="string">or</span> <span class="string">build</span> <span class="string">the</span> <span class="string">PCRE</span> <span class="string">library</span></span><br><span class="line"></span><br><span class="line"><span class="string">statically</span> <span class="string">from</span> <span class="string">the</span> <span class="string">source</span> <span class="string">with</span> <span class="string">nginx</span> <span class="string">by</span> <span class="string">using</span> <span class="string">--with-pcre=&lt;path&gt;</span> <span class="string">option.</span></span><br><span class="line"></span><br><span class="line"><span class="string">缺少PCRE、ZLIB参考nginx安装教程先安装对应的源码包</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span><span class="string">.</span></span><br><span class="line"></span><br><span class="line"><span class="string">checking</span> <span class="string">for</span> <span class="string">OpenSSL</span> <span class="string">library</span> <span class="string">...</span> <span class="string">not</span> <span class="string">found</span></span><br><span class="line"></span><br><span class="line"><span class="string">checking</span> <span class="string">for</span> <span class="string">OpenSSL</span> <span class="string">library</span> <span class="string">in</span> <span class="string">/usr/local/</span> <span class="string">...</span> <span class="string">not</span> <span class="string">found</span></span><br><span class="line"></span><br><span class="line"><span class="string">checking</span> <span class="string">for</span> <span class="string">OpenSSL</span> <span class="string">library</span> <span class="string">in</span> <span class="string">/usr/pkg/</span> <span class="string">...</span> <span class="string">not</span> <span class="string">found</span></span><br><span class="line"></span><br><span class="line"><span class="string">checking</span> <span class="string">for</span> <span class="string">OpenSSL</span> <span class="string">library</span> <span class="string">in</span> <span class="string">/opt/local/</span> <span class="string">...</span> <span class="string">not</span> <span class="string">found</span></span><br><span class="line"></span><br><span class="line"><span class="string">需要下载opensll包，参考nginx安装</span></span><br><span class="line"></span><br><span class="line"><span class="string">cd</span> <span class="string">/tmp</span></span><br><span class="line"><span class="string">wget</span> <span class="string">https://www.openssl.org/source/openssl-1.1.1g.tar.gz</span></span><br><span class="line"><span class="string">tar</span> <span class="string">-zxvf</span> <span class="string">openssl-1.1.1g.tar.gz</span></span><br><span class="line"></span><br><span class="line"><span class="string">--with-openssl=/tmp/openssl-1.1.1g</span></span><br><span class="line"></span><br><span class="line"><span class="string">总结，本文主要介绍了如果配置nginx的日志记录功能，以及如何编译、安装、和使用echo模块。</span></span><br><span class="line"></span><br><span class="line"><span class="string">参考：developers.redhat.com/blog/2016/05/23/configuring-nginx-to-log-post-data-on-linux-rhel/</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Nginx功能概述&quot;&gt;&lt;a href=&quot;#Nginx功能概述&quot; class=&quot;headerlink&quot; title=&quot;Nginx功能概述&quot;&gt;&lt;/a&gt;Nginx功能概述&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;&lt;strong&gt;HTTP基础功能：&lt;/strong&gt;&lt;/strong</summary>
      
    
    
    
    <category term="服务" scheme="http://example.com/categories/%E6%9C%8D%E5%8A%A1/"/>
    
    
    <category term="nginx" scheme="http://example.com/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>开发工具软件及IDE</title>
    <link href="http://example.com/2020/09/18/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6%E5%8F%8AIDE/"/>
    <id>http://example.com/2020/09/18/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6%E5%8F%8AIDE/</id>
    <published>2020-09-18T08:44:20.000Z</published>
    <updated>2020-09-18T08:45:12.717Z</updated>
    
    <content type="html"><![CDATA[<h1 id="开发工具软件及IDE"><a href="#开发工具软件及IDE" class="headerlink" title="开发工具软件及IDE"></a>开发工具软件及IDE</h1><p>​                    </p><h3 id="一款很好用的轻量级IDE-VSCODE"><a href="#一款很好用的轻量级IDE-VSCODE" class="headerlink" title="一款很好用的轻量级IDE VSCODE"></a>一款很好用的轻量级IDE VSCODE</h3><blockquote><p> VSCODE 是由微软开发的一款IDE工具，拥有非常丰富的插件可以在线下载安装，并且启动的速度灰常快，biu~</p><p> 我一般来进行 JS、Python、Go等语言的开发。</p></blockquote><h3 id="在线代码仓库-腾讯的coding"><a href="#在线代码仓库-腾讯的coding" class="headerlink" title="在线代码仓库 腾讯的coding"></a>在线代码仓库 腾讯的coding</h3><blockquote><p>在线的且免费使用的代码仓库，目前没有人数限制</p></blockquote><h3 id="MarkDown-编写工具"><a href="#MarkDown-编写工具" class="headerlink" title="MarkDown 编写工具"></a>MarkDown 编写工具</h3><blockquote><p>Typora  神器，目前用的最顺手的，无需解释。</p></blockquote><h3 id="跨平台的密码管理工具-BitWarDen"><a href="#跨平台的密码管理工具-BitWarDen" class="headerlink" title="跨平台的密码管理工具 BitWarDen"></a>跨平台的密码管理工具 BitWarDen</h3><blockquote><p>相比于 1Password 而言，这款工具完全免费，且功能和1password基本一模一样，该有的都有，包括win/mac、ios/Android、各种浏览器插件，使用非常方便。</p></blockquote><h3 id="移动端、小程序、公众号开发框架-Taro"><a href="#移动端、小程序、公众号开发框架-Taro" class="headerlink" title="移动端、小程序、公众号开发框架 Taro"></a>移动端、小程序、公众号开发框架 Taro</h3><blockquote><p>目前Taro的开发支持React 及 Vue语法，并且有配套的TaroUI配合使用，记住使用Taro3需要配合TaroUI3使用，否则会报错。</p></blockquote><h3 id="后台管理框架-AntDesign-Pro"><a href="#后台管理框架-AntDesign-Pro" class="headerlink" title="后台管理框架 AntDesign Pro"></a>后台管理框架 AntDesign Pro</h3><blockquote><p>蚂蚁开源，可以使用各种Antd的组件，还可以尝试 一下 antd的升级版ui组件procomponents。</p></blockquote><h3 id="免费的博客搭建工具，连域名都不用去买-hexo-github-io"><a href="#免费的博客搭建工具，连域名都不用去买-hexo-github-io" class="headerlink" title="免费的博客搭建工具，连域名都不用去买 hexo + github.io"></a>免费的博客搭建工具，连域名都不用去买 hexo + github.io</h3><blockquote><p>基于NodeJs的hexo 配合免费的github个人页面，使用markdown来编写博客页面，编写的文章可以一键更新到网页。</p></blockquote><h3 id="开源测试工具-MeterSphere"><a href="#开源测试工具-MeterSphere" class="headerlink" title="开源测试工具 MeterSphere"></a>开源测试工具 MeterSphere</h3><blockquote><p>开源的好用的一款测试工具。</p></blockquote><h3 id="一款图床工具picGo"><a href="#一款图床工具picGo" class="headerlink" title="一款图床工具picGo"></a>一款图床工具picGo</h3><blockquote><p>一款win/mac都可以使用图床工具，支持多种图床源</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;开发工具软件及IDE&quot;&gt;&lt;a href=&quot;#开发工具软件及IDE&quot; class=&quot;headerlink&quot; title=&quot;开发工具软件及IDE&quot;&gt;&lt;/a&gt;开发工具软件及IDE&lt;/h1&gt;&lt;p&gt;​                    &lt;/p&gt;
&lt;h3 id=&quot;一款很好</summary>
      
    
    
    
    <category term="tools" scheme="http://example.com/categories/tools/"/>
    
    
    <category term="工具" scheme="http://example.com/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript文件对象详解</title>
    <link href="http://example.com/2020/09/18/JavaScript%E6%96%87%E4%BB%B6%E5%AF%B9%E8%B1%A1%E8%AF%A6%E8%A7%A3/"/>
    <id>http://example.com/2020/09/18/JavaScript%E6%96%87%E4%BB%B6%E5%AF%B9%E8%B1%A1%E8%AF%A6%E8%A7%A3/</id>
    <published>2020-09-18T08:34:45.000Z</published>
    <updated>2020-09-18T08:36:29.711Z</updated>
    
    <content type="html"><![CDATA[<h1 id="JavaScript-文件对象详解"><a href="#JavaScript-文件对象详解" class="headerlink" title="JavaScript 文件对象详解"></a>JavaScript 文件对象详解</h1><p>在浏览器中操作文件，多数情况下用到的是 <code>File</code> 对象，从 <code>&lt;input type=&#39;file&#39; /&gt;</code> 元素获取，进而继续操作(例如将选择的图片展示在页面上，用ajax将文件上传至服务器等)。这里介绍在浏览器中操作文件的相关API.</p><p><code>File</code> 对象继承自 <code>Blob</code> 对象，先看看 <code>Blob</code> 对象。</p><h2 id="1-Blob-对象"><a href="#1-Blob-对象" class="headerlink" title="1. Blob 对象"></a>1. Blob 对象</h2><p><code>Blob</code> 对象表示一个不可变、原始数据的类文件对象。Blob 表示的不一定是JavaScript原生格式的数据。</p><h3 id="Blob构造函数-Blob-array-options"><a href="#Blob构造函数-Blob-array-options" class="headerlink" title="Blob构造函数 Blob(array[, options])"></a>Blob构造函数 Blob(array[, options])</h3><ul><li>array 是一个由ArrayBuffer, ArrayBufferView, Blob, string 等对象构成的 Array ，或者其他类似对象的混合体，它将会被放进 Blob。string会被编码为UTF-8。</li><li>options 是一个可选的对象，它可能会指定如下两个属性：<ul><li>type，默认值为 “”，它代表了将会被放入到blob中的数组内容的<a href="https://link.juejin.im/?target=https://www.iana.org/assignments/media-types/media-types.xhtml"><code>MIME</code>类型</a>。</li><li>endings，默认值为”transparent”，用于指定包含行结束符\n的字符串如何被写入。 它是以下两个值中的一个： “native”，代表行结束符会被更改为适合宿主操作系统文件系统的换行符，或者 “transparent”，代表会保持blob中保存的结束符不变。</li></ul></li></ul><p>示例:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> content1 = [<span class="string">&#x27;This is my firt trip to an island&#x27;</span>];</span><br><span class="line"><span class="keyword">var</span> blob1 = <span class="keyword">new</span> Blob(content, &#123;<span class="attr">type</span>: <span class="string">&#x27;text/plain&#x27;</span>&#125;);</span><br><span class="line"><span class="keyword">var</span> content2 = &#123;<span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="attr">age</span>: <span class="number">23</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> blob2 = <span class="keyword">new</span> Blob([<span class="built_in">JSON</span>.stringify(content2, <span class="literal">null</span>, <span class="number">2</span>)], &#123;<span class="attr">type</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h3 id="Blob实例属性"><a href="#Blob实例属性" class="headerlink" title="Blob实例属性"></a>Blob实例属性</h3><table><thead><tr><th align="left">属性名称</th><th align="left">读/写</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">size</td><td align="left">只读</td><td align="left"><code>Blob</code> 对象中所包含数据的大小（字节）。</td></tr><tr><td align="left">type</td><td align="left">只读</td><td align="left">一个字符串，表明该Blob对象所包含数据的<a href="https://link.juejin.im/?target=https://www.iana.org/assignments/media-types/media-types.xhtml"><code>MIME</code>类型</a>。如果类型未知，则该值为空字符串。例如 “image/png”.</td></tr></tbody></table><p>示例:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> content = [<span class="string">&#x27;&lt;div id=&quot;box&quot;&gt;&lt;p class=&quot;pra&quot;&gt;a paragraph&lt;/p&gt;&lt;/div&gt;&#x27;</span>];</span><br><span class="line"><span class="keyword">var</span> blob = <span class="keyword">new</span> Blob(content, &#123;<span class="attr">type</span>: <span class="string">&#x27;text/html&#x27;</span>&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(blob.size); <span class="comment">// 50</span></span><br><span class="line"><span class="built_in">console</span>.log(blob.type); <span class="comment">// text/html</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h3 id="Blob实例方法"><a href="#Blob实例方法" class="headerlink" title="Blob实例方法"></a>Blob实例方法</h3><ul><li>slice([start[, end[, contentType]]])</li></ul><p><code>slice</code> 方法接收三个可选参数，<code>start</code> 和 <code>end</code> 都是数值，表示截取的范围，<code>contentType</code> 指定截取的内容的 <code>MIME</code> 类型。返回一个新的 <code>Blob</code>对象。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([<span class="string">&#x27;This is an example of Blob slice method&#x27;</span>], &#123;<span class="attr">type</span>: <span class="string">&#x27;text/plain&#x27;</span>&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(blob.size); <span class="comment">// 39</span></span><br><span class="line"><span class="keyword">var</span> newBlob = blob.slice(<span class="number">10</span>, <span class="number">20</span>, <span class="string">&#x27;text/plain&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(newBlob.size); <span class="comment">// 10</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>从 <code>Blob</code> 对象中读取内容可以使用 <code>FileReader</code>. 下文会介绍。</p><h2 id="2-File-对象"><a href="#2-File-对象" class="headerlink" title="2. File 对象"></a>2. File 对象</h2><h3 id="File构造函数"><a href="#File构造函数" class="headerlink" title="File构造函数"></a>File构造函数</h3><p>我们接触的多数关于 <code>File</code> 的操作都是读取，js也为我们提供了手动创建 <code>File</code> 对象的构造函数：<code>File(bits, name[, options])</code>。</p><ul><li>bits (required) ArrayBuffer，ArrayBufferView，Blob，或者 Array[string] — 或者任何这些对象的组合。这是 UTF-8 编码的文件内容。。</li><li>name [String] (required) 文件名称，或者文件路径.</li><li>options [Object] (optional) 选项对象，包含文件的可选属性。可用的选项如下：<ul><li><code>type</code>: string, 表示将要放到文件中的内容的<a href="https://link.juejin.im/?target=https://www.iana.org/assignments/media-types/media-types.xhtml"><code>MIME</code>类型</a>。默认值为 ‘’ 。</li><li><code>lastModified</code>: 数值，表示文件最后修改时间的 Unix 时间戳（毫秒）。默认值为 Date.now()。</li></ul></li></ul><p>示例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> file1 = <span class="keyword">new</span> File([<span class="string">&#x27;text1&#x27;</span>, <span class="string">&#x27;text2&#x27;</span>], <span class="string">&#x27;test.txt&#x27;</span>, &#123;<span class="attr">type</span>: <span class="string">&#x27;text/plain&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure><p>根据已有的 <code>blob</code> 对象创建 <code>File</code> 对象:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> file2 = <span class="keyword">new</span> File([blob], <span class="string">&#x27;test.png&#x27;</span>, &#123;<span class="attr">type</span>: <span class="string">&#x27;image/png&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure><h3 id="File实例属性"><a href="#File实例属性" class="headerlink" title="File实例属性"></a>File实例属性</h3><p><code>File</code> 对象的实例内容不可见，但是有以下属性可以访问:</p><table><thead><tr><th align="left">属性名称</th><th align="left">读/写</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">name</td><td align="left">只读</td><td align="left">返回文件的名称.由于安全原因,返回的值并不包含文件路径 。</td></tr><tr><td align="left">type</td><td align="left">只读</td><td align="left">返回 <code>File</code> 对象所表示文件的媒体类型（MIME）。例如 PNG 图像是 “image/png”.</td></tr><tr><td align="left">lastModified</td><td align="left">只读</td><td align="left">number, 返回所引用文件最后修改日期,自 1970年1月1日0:00 以来的毫秒数。</td></tr><tr><td align="left">lastModifiedDate</td><td align="left">只读</td><td align="left">Date, 返回当前文件的最后修改日期,如果无法获取到文件的最后修改日期,则使用当前日期来替代。</td></tr></tbody></table><p>示例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;file&quot;</span> id=<span class="string">&#x27;file&#x27;</span>&gt;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&#x27;file&#x27;</span>).addEventListener(<span class="string">&#x27;change&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> file = <span class="built_in">this</span>.files[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> (file) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(file.name);</span><br><span class="line">    <span class="built_in">console</span>.log(file.size);</span><br><span class="line">    <span class="built_in">console</span>.log(file.lastModified);</span><br><span class="line">    <span class="built_in">console</span>.log(file.lastModifiedDate);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>备注:</strong> 基于当前的实现，浏览器不会实际读取文件的字节流，来判断它的媒体类型。它基于文件扩展来假设；将PNG 图像文件的后缀名重命名为 <code>.txt</code>，那么读取的该文件的 <code>type</code> 属性值为 “text/plain”， 而不是 “image/png” 。而且，<code>file.type</code> 仅仅对常见文件类型可靠。例如图像、文档、音频和视频。不常见的文件扩展名会返回空字符串。开发者最好不要依靠这个属性，作为唯一的验证方案。</p><h3 id="File实例方法"><a href="#File实例方法" class="headerlink" title="File实例方法"></a>File实例方法</h3><ul><li>slice([start[, end[, contentType]]])</li></ul><p><code>File</code> 对象没有定义额外的方法，由于继承了 <code>Blob</code> 对象，也就继承了 <code>slice</code>方法，用法同上文 <code>Blob</code> 的 <code>slice</code> 方法。</p><p>FileReader, URL.createObjectURL(), createImageBitmap(), 及 XMLHttpRequest.send() 都能处理 Blob 和 File。</p><h2 id="3-FileReader-对象"><a href="#3-FileReader-对象" class="headerlink" title="3. FileReader 对象"></a>3. FileReader 对象</h2><blockquote><p><code>FileReader</code> 对象允许Web应用程序异步读取存储在用户计算机上的文件（或原始数据缓冲区）的内容，使用 <code>File</code> 或 <code>Blob</code> 对象指定要读取的文件或数据。</p></blockquote><p>其中 <code>File</code> 对象可以是来自用户在一个 <code>&lt;input&gt;</code> 元素上选择文件后返回的 <code>FileList</code>, 也可以来自拖放操作生成的 <code>DataTransfer</code> 对象,还可以是来自在一个 <code>HTMLCanvasElement</code> 上执行 <code>mozGetAsFile()</code> 方法后返回结果。</p><h3 id="FileReader构造函数"><a href="#FileReader构造函数" class="headerlink" title="FileReader构造函数"></a>FileReader构造函数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader()</span><br></pre></td></tr></table></figure><p>构造函数不需要传入参数，返回一个 <code>FileReader</code> 的实例。<code>FileReader</code> 继承 <code>EventTarget</code>对象。</p><h3 id="FileReader实例属性"><a href="#FileReader实例属性" class="headerlink" title="FileReader实例属性"></a>FileReader实例属性</h3><table><thead><tr><th align="left">属性名称</th><th align="left">读/写</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">error</td><td align="left">只读</td><td align="left"><code>DOMException</code> 的实例，表示在读取文件时发生的错误 。</td></tr><tr><td align="left">result</td><td align="left">只读</td><td align="left">文件的内容，该属性仅在读取操作完成后(load)后才有效，格式取决于读取方法</td></tr><tr><td align="left">readyState</td><td align="left">只读</td><td align="left">表示读取文件时状态的数字</td></tr></tbody></table><p><strong>备注:</strong> <code>readeyState</code>的取值如下:</p><table><thead><tr><th align="left">值</th><th align="left">常量名</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">0</td><td align="left">EMPTY</td><td align="left">还没有加载任何数据</td></tr><tr><td align="left">1</td><td align="left">LOADING</td><td align="left">数据正在被加载</td></tr><tr><td align="left">2</td><td align="left">DONE</td><td align="left">已完成全部的读取请求.</td></tr></tbody></table><p>使用示例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line"><span class="built_in">console</span>.log(reader.error);       <span class="comment">// null</span></span><br><span class="line"><span class="built_in">console</span>.log(reader.result);      <span class="comment">// null</span></span><br><span class="line"><span class="built_in">console</span>.log(reader.readyState);  <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">console</span>.log(reader.EMPTY);       <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">console</span>.log(reader.LOADING);     <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(reader.DONE);        <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><p><code>EMPTY</code>、<code>LOADING</code>、<code>DONE</code> 这三个属性同时存在于 <code>FileReader</code> 和它的的原型对象上，因此实例上有这三个属性，<code>FileReader</code> 对象本身也有这三个属性:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(FileReader.EMPTY);   <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">console</span>.log(FileReader.LOADING); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(FileReader.DONE);    <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><h3 id="FileReader事件"><a href="#FileReader事件" class="headerlink" title="FileReader事件"></a>FileReader事件</h3><p>文件的读取是一个异步的过程，和 <code>XMLHttpRequest</code> 对象一样，在读取操作过程中会触发一系列事件。</p><table><thead><tr><th align="left">事件名称</th><th align="left">描述</th><th align="left">使用示例</th></tr></thead><tbody><tr><td align="left">abort</td><td align="left">读取操作被中断时触发。</td><td align="left"><code>reader.onabort = function(event) &#123;&#125;</code></td></tr><tr><td align="left">error</td><td align="left">在读取操作发生错误时触发。</td><td align="left"><code>reader.onerror = function(event) &#123;&#125;</code></td></tr><tr><td align="left">load</td><td align="left">读取操作完成时触发。</td><td align="left"><code>reader.addEventListener(&#39;load&#39;, function(event) &#123;&#125;)</code></td></tr><tr><td align="left">loadstart</td><td align="left">读取操作开始时触发。</td><td align="left"><code>reader.onloadstart = function(event) &#123;&#125;</code></td></tr><tr><td align="left">loadend</td><td align="left">读取操作结束时（要么成功，要么失败）触发。</td><td align="left"><code>reader.onloadend = function(event) &#123;&#125;</code></td></tr><tr><td align="left">progress</td><td align="left">在读取Blob时触发。</td><td align="left"><code>reader.onprogress = function(event) &#123;&#125;</code></td></tr></tbody></table><h3 id="FileReader实例方法"><a href="#FileReader实例方法" class="headerlink" title="FileReader实例方法"></a>FileReader实例方法</h3><p><code>FileReader</code> 的实例具有以下可操作的方法:</p><table><thead><tr><th align="left">方法名称</th><th align="left">描述</th><th align="left">使用示例</th></tr></thead><tbody><tr><td align="left">abort()</td><td align="left">手动终止读取操作，只有当 <code>readyState</code> 为 1 时才能调用，调用后，<code>readyState</code> 值为 2</td><td align="left"><code>reader.abort()</code></td></tr><tr><td align="left">readAsArrayBuffer(blob)</td><td align="left">读取指定的 <code>Blob</code> 或 <code>File</code> 对象。读取操作完成后(触发<code>loadend</code>事件)，<code>result</code>属性将包含一个 <code>ArrayBuffer</code> 对象表示所读取的文件的数据。</td><td align="left"><code>reader.readAsArrayBuffer(blob)</code></td></tr><tr><td align="left">readAsDataURL(blob)</td><td align="left">读取指定的 <code>Blob</code> 或 <code>File</code> 对象。读取操作完成后(触发<code>loadend</code>事件)，<code>result</code>属性将包含一个 <code>data:URL</code> 格式的字符串(base64编码)</td><td align="left"><code>reader.readAsArrayBuffer(file)</code></td></tr><tr><td align="left">readAsBinaryString(blob)</td><td align="left">已废弃，用 <code>readAsArrayBuffer</code> 代替</td><td align="left">–</td></tr><tr><td align="left">readAsText(blob[, encoding])</td><td align="left">将 Blob 或者 File 对象转根据特殊的编码格式转化为内容(字符串形式), 默认编码是 <code>utf-8</code></td><td align="left"><code>reader.readAsArrayBuffer(blob)</code></td></tr></tbody></table><p>读取本地图片示例:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;file&quot;</span> id=<span class="string">&#x27;file&#x27;</span> accept=<span class="string">&quot;image/png, image/jpg, image/jpeg, image/gif&quot;</span> /&gt;&gt;<span class="xml"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span>&gt;</span><br><span class="line">&lt;img src=<span class="string">&quot;&quot;</span> alt=<span class="string">&quot;Image preview...&quot;</span>&gt;</span><br><span class="line"><span class="keyword">var</span> preview = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> reader  = <span class="keyword">new</span> FileReader();</span><br><span class="line">reader.addEventListener(<span class="string">&quot;load&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  preview.src = reader.result;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&#x27;file&#x27;</span>).addEventListener(<span class="string">&#x27;change&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> file = <span class="built_in">this</span>.files[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> (file) &#123;</span><br><span class="line">    reader.readAsDataURL(file);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><a href="https://link.juejin.im/?target=https://codepen.io/mr-dang/pen/qKMrzV">读取多个文件示例 - CodePen</a></p><p>dataURL是<code>base64</code>编码的数据格式，展示类型为字符串，形如: <code>data:image/jpeg;base64,/9j/4QXERXhpZgAATU...</code></p><p>将 <code>dataURL</code> 转为 <code>blob</code>对象:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dataURLToBlob</span> (<span class="params">dataurl</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> arr = dataurl.split(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">  <span class="keyword">let</span> mime = arr[<span class="number">0</span>].match(<span class="regexp">/:(.*?);/</span>)[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">let</span> bstr = atob(arr[<span class="number">1</span>]);</span><br><span class="line">  <span class="keyword">let</span> n = bstr.length;</span><br><span class="line">  <span class="keyword">let</span> u8arr = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(n);</span><br><span class="line">  <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">    u8arr[n] = bstr.charCodeAt(n);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Blob([u8arr], &#123; <span class="attr">type</span>: mime &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结合上例，根据已有的 <code>&lt;img&gt;</code> 对象创建一个 <code>File</code> 对象:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">reader.addEventListener(<span class="string">&quot;load&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  preview.src = reader.result;</span><br><span class="line">  <span class="keyword">var</span> blob = dataURLToBlob(reader.result);</span><br><span class="line">  <span class="keyword">var</span> newFile = <span class="keyword">new</span> File([blob], <span class="string">&#x27;test.jpeg&#x27;</span>, &#123;<span class="attr">type</span>: blob.type&#125;);</span><br><span class="line">  <span class="built_in">console</span>.log(newFile.name); <span class="comment">// test.jpeg</span></span><br><span class="line">  <span class="built_in">console</span>.log(newFile.type);</span><br><span class="line">  <span class="built_in">console</span>.log(newFile.size);</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><h2 id="URL-createObjectURL"><a href="#URL-createObjectURL" class="headerlink" title="URL.createObjectURL"></a>URL.createObjectURL</h2><p>将图片文件转换成 <code>data:URL</code> 格式供 <code>&lt;img&gt;</code> 元素展示，除了使用 <code>fileReader.readAsDataURL</code>外，还可以使用 <code>URL.createObjectURL</code>方法。 <code>URL.createObjectURL(blob)</code> 方法返回一个 <code>blob:</code> 开头的字符串，指向文件在内存中的地址。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;file&quot;</span> id=<span class="string">&#x27;file&#x27;</span> accept=<span class="string">&quot;image/png, image/jpg, image/jpeg, image/gif&quot;</span> /&gt;<span class="xml"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line">&lt;img src=<span class="string">&quot;&quot;</span> alt=<span class="string">&quot;Image preview...&quot;</span>&gt;</span><br><span class="line"><span class="keyword">var</span> preview = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&#x27;file&#x27;</span>).addEventListener(<span class="string">&#x27;change&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> file = <span class="built_in">this</span>.files[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> (file) &#123;</span><br><span class="line">    preview.src = URL.createObjectURL(file);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="综合实例"><a href="#综合实例" class="headerlink" title="综合实例"></a>综合实例</h2><p>综合以上，可以实现一个简单的粘贴图片并显示的功能。HTML5提供的内容编辑功能，可以粘贴部分图片，例如从网页上复制的图片。但是使用截图工具截取的图片无法粘贴显示，而且从网页上复制的图片会带有原来的样式，其图片url也是原来图片的指向。我们使用以下代码可以统一这两种粘贴操作，实现统一的效果。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;comment&quot;</span> contenteditable&gt;&lt;/div&gt;</span><br><span class="line">#comment&#123;</span><br><span class="line">  border: 1px solid #ccc;</span><br><span class="line">  min-height: <span class="number">500</span>px;</span><br><span class="line">  padding: <span class="number">10</span>px;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">#comment:focus &#123;</span><br><span class="line">  border-color: #ccc;</span><br><span class="line">  outline: none;</span><br><span class="line">&#125;</span><br><span class="line">.img-paste &#123;</span><br><span class="line">  max-width: <span class="number">100</span>%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> comment = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;comment&#x27;</span>);</span><br><span class="line">comment.addEventListener(<span class="string">&#x27;paste&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(event);</span><br><span class="line">  <span class="keyword">var</span> item = event.clipboardData.files[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> (item &amp;&amp; <span class="regexp">/image/</span>.test(item.type)) &#123;</span><br><span class="line">    <span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">    img.src = URL.createObjectURL(item);</span><br><span class="line">    img.className = <span class="string">&#x27;img-paste&#x27;</span>;</span><br><span class="line">    <span class="built_in">this</span>.appendChild(img);</span><br><span class="line">    event.preventDefault();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><p>实例效果可以查看<a href="https://link.juejin.im/?target=https://codepen.io/mr-dang/full/rKQLWp/">这里</a>。</p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul><li><a href="https://link.juejin.im/?target=https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications">using files from web apps - MDN</a></li><li><a href="https://link.juejin.im/?target=https://developer.mozilla.org/zh-CN/docs/Web/API/Blob">Blob - MDN</a></li><li><a href="https://link.juejin.im/?target=https://www.iana.org/assignments/media-types/media-types.xhtml">MIME types - Wikipedia</a></li><li><a href="https://link.juejin.im/?target=https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types">MIME TYPES - MDN</a></li><li><a href="https://link.juejin.im/?target=https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader">FileReader —— MDN</a></li><li><a href="https://link.juejin.im/?target=http://www.w3school.com.cn/media/media_mimeref.asp">MIME types - w3school</a></li><li>[Blob/DataURL/canvas/image的相互转换](</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;JavaScript-文件对象详解&quot;&gt;&lt;a href=&quot;#JavaScript-文件对象详解&quot; class=&quot;headerlink&quot; title=&quot;JavaScript 文件对象详解&quot;&gt;&lt;/a&gt;JavaScript 文件对象详解&lt;/h1&gt;&lt;p&gt;在浏览器中操作文件，</summary>
      
    
    
    
    <category term="javascript" scheme="http://example.com/categories/javascript/"/>
    
    
    <category term="file" scheme="http://example.com/tags/file/"/>
    
  </entry>
  
  <entry>
    <title>Docker容器的使用</title>
    <link href="http://example.com/2020/09/14/Docker%E5%AE%B9%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>http://example.com/2020/09/14/Docker%E5%AE%B9%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8/</id>
    <published>2020-09-14T08:23:54.000Z</published>
    <updated>2020-09-14T08:32:36.701Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Docker容器的使用"><a href="#Docker容器的使用" class="headerlink" title="Docker容器的使用"></a>Docker容器的使用</h2><h3 id="Docker是一个开源的引擎，可以轻松的为任何应用创建一个轻量级的、可移植的、自给自足的容器。开发者在笔记本上编译测试通过的容器可以批量地在生产环境中部署，包括VMs（虚拟机）、bare-metal、OpenStack-集群和其他的基础应用平台。"><a href="#Docker是一个开源的引擎，可以轻松的为任何应用创建一个轻量级的、可移植的、自给自足的容器。开发者在笔记本上编译测试通过的容器可以批量地在生产环境中部署，包括VMs（虚拟机）、bare-metal、OpenStack-集群和其他的基础应用平台。" class="headerlink" title="Docker是一个开源的引擎，可以轻松的为任何应用创建一个轻量级的、可移植的、自给自足的容器。开发者在笔记本上编译测试通过的容器可以批量地在生产环境中部署，包括VMs（虚拟机）、bare metal、OpenStack 集群和其他的基础应用平台。"></a>Docker是一个开源的引擎，可以轻松的为任何应用创建一个轻量级的、可移植的、自给自足的容器。开发者在笔记本上编译测试通过的容器可以批量地在生产环境中部署，包括VMs（虚拟机）、<a href="http://www.whatis.com.cn/word_5275.htm">bare metal</a>、OpenStack 集群和其他的基础应用平台。</h3><h2 id="Docker通常用于如下场景："><a href="#Docker通常用于如下场景：" class="headerlink" title="Docker通常用于如下场景："></a>Docker通常用于如下场景：</h2><ul><li>web应用的自动化打包和发布；</li><li>自动化测试和持续集成、发布；</li><li>在服务型环境中部署和调整数据库或其他的后台应用；</li><li>从头编译或者扩展现有的OpenShift或Cloud Foundry平台来搭建自己的PaaS环境。</li></ul><p>ubuntu 上安装： </p><p>wget -qO- <a href="https://get.docker.com/">https://get.docker.com/</a> | sh 或者 sudo apt-get install docker </p><p><img src="/2020/09/14/Docker%E5%AE%B9%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8/docker1.png" alt="docker.png"></p><h2 id="Docker系统有两个程序：docker服务端和docker客户端。其中docker服务端是一个服务进程，管理着所有的容器。docker客户端则扮演着docker服务端的远程控制器，可以用来控制docker的服务端进程。大部分情况下，docker服务端和客户端运行在一台机器上。"><a href="#Docker系统有两个程序：docker服务端和docker客户端。其中docker服务端是一个服务进程，管理着所有的容器。docker客户端则扮演着docker服务端的远程控制器，可以用来控制docker的服务端进程。大部分情况下，docker服务端和客户端运行在一台机器上。" class="headerlink" title="Docker系统有两个程序：docker服务端和docker客户端。其中docker服务端是一个服务进程，管理着所有的容器。docker客户端则扮演着docker服务端的远程控制器，可以用来控制docker的服务端进程。大部分情况下，docker服务端和客户端运行在一台机器上。"></a>Docker系统有两个程序：docker服务端和docker客户端。其中docker服务端是一个服务进程，管理着所有的容器。docker客户端则扮演着docker服务端的远程控制器，可以用来控制docker的服务端进程。大部分情况下，docker服务端和客户端运行在一台机器上。</h2><p><img src="/2020/09/14/Docker%E5%AE%B9%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8/docker2.png" alt="未知_1.png"></p><h2 id="搜索可用的docker镜像"><a href="#搜索可用的docker镜像" class="headerlink" title="搜索可用的docker镜像"></a>搜索可用的docker镜像</h2><h2 id="使用docker最简单的方式莫过于从现有的容器镜像开始。Docker官方网站专门有一个页面来存储所有可用的镜像，网址是：index-docker-io。你可以通过浏览这个网页来查找你想要使用的镜像，或者使用命令行的工具来检索。"><a href="#使用docker最简单的方式莫过于从现有的容器镜像开始。Docker官方网站专门有一个页面来存储所有可用的镜像，网址是：index-docker-io。你可以通过浏览这个网页来查找你想要使用的镜像，或者使用命令行的工具来检索。" class="headerlink" title="使用docker最简单的方式莫过于从现有的容器镜像开始。Docker官方网站专门有一个页面来存储所有可用的镜像，网址是：index.docker.io。你可以通过浏览这个网页来查找你想要使用的镜像，或者使用命令行的工具来检索。"></a>使用docker最简单的方式莫过于从现有的容器镜像开始。Docker官方网站专门有一个页面来存储所有可用的镜像，网址是：<a href="http://index.docker.io/">index.docker.io</a>。你可以通过浏览这个网页来查找你想要使用的镜像，或者使用命令行的工具来检索。</h2><h2 id="目标："><a href="#目标：" class="headerlink" title="目标："></a>目标：</h2><h2 id="学会使用命令行的工具来检索名字叫做tutorial的镜像。"><a href="#学会使用命令行的工具来检索名字叫做tutorial的镜像。" class="headerlink" title="学会使用命令行的工具来检索名字叫做tutorial的镜像。"></a>学会使用命令行的工具来检索名字叫做tutorial的镜像。</h2><h2 id="提示："><a href="#提示：" class="headerlink" title="提示："></a>提示：</h2><h2 id="命令行的格式为：docker-search-镜像名字"><a href="#命令行的格式为：docker-search-镜像名字" class="headerlink" title="命令行的格式为：docker search 镜像名字"></a>命令行的格式为：docker search 镜像名字</h2><p><img src="/2020/09/14/Docker%E5%AE%B9%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8/docker3.png" alt="未知_2.png"></p><h2 id="学会使用docker命令来下载镜像"><a href="#学会使用docker命令来下载镜像" class="headerlink" title="学会使用docker命令来下载镜像"></a>学会使用docker命令来下载镜像</h2><h2 id="下载镜像的命令非常简单，使用docker-pull命令即可。-译者按：docker命令和git有一些类似的地方）。在docker的镜像索引网站上面，镜像都是按照-用户名-镜像名的方式来存储的。有一组比较特殊的镜像，比如ubuntu这类基础镜像，经过官方的验证，值得信任，可以直接用-镜像名来检索到。"><a href="#下载镜像的命令非常简单，使用docker-pull命令即可。-译者按：docker命令和git有一些类似的地方）。在docker的镜像索引网站上面，镜像都是按照-用户名-镜像名的方式来存储的。有一组比较特殊的镜像，比如ubuntu这类基础镜像，经过官方的验证，值得信任，可以直接用-镜像名来检索到。" class="headerlink" title="下载镜像的命令非常简单，使用docker pull命令即可。(译者按：docker命令和git有一些类似的地方）。在docker的镜像索引网站上面，镜像都是按照 用户名/ 镜像名的方式来存储的。有一组比较特殊的镜像，比如ubuntu这类基础镜像，经过官方的验证，值得信任，可以直接用 镜像名来检索到。"></a>下载镜像的命令非常简单，使用docker pull命令即可。(译者按：docker命令和git有一些类似的地方）。在docker的镜像索引网站上面，镜像都是按照 用户名/ 镜像名的方式来存储的。有一组比较特殊的镜像，比如ubuntu这类基础镜像，经过官方的验证，值得信任，可以直接用 镜像名来检索到。</h2><h2 id="目标：-1"><a href="#目标：-1" class="headerlink" title="目标："></a>目标：</h2><h2 id="通过docker命令下载tutorial镜像。"><a href="#通过docker命令下载tutorial镜像。" class="headerlink" title="通过docker命令下载tutorial镜像。"></a>通过docker命令下载tutorial镜像。</h2><h2 id="提示：-1"><a href="#提示：-1" class="headerlink" title="提示："></a>提示：</h2><h2 id="执行pull命令的时候要写完整的名字，比如”learn-tutorial”。"><a href="#执行pull命令的时候要写完整的名字，比如”learn-tutorial”。" class="headerlink" title="执行pull命令的时候要写完整的名字，比如”learn/tutorial”。"></a>执行pull命令的时候要写完整的名字，比如”learn/tutorial”。</h2><p><img src="/2020/09/14/Docker%E5%AE%B9%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8/docker4.png" alt="未知_3.png"></p><p>查看安装的镜像： </p><p><img src="/2020/09/14/Docker%E5%AE%B9%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8/docker5.png" alt="未知_4.png"></p><h2 id="在docker容器中运行hello-world"><a href="#在docker容器中运行hello-world" class="headerlink" title="在docker容器中运行hello world!"></a>在docker容器中运行hello world!</h2><h2 id="docker容器可以理解为在沙盒中运行的进程。这个沙盒包含了该进程运行所必须的资源，包括文件系统、系统类库、shell-环境等等。但这个沙盒默认是不会运行任何程序的。你需要在沙盒中运行一个进程来启动某一个容器。这个进程是该容器的唯一进程，所以当该进程结束的时候，容器也会完全的停止。"><a href="#docker容器可以理解为在沙盒中运行的进程。这个沙盒包含了该进程运行所必须的资源，包括文件系统、系统类库、shell-环境等等。但这个沙盒默认是不会运行任何程序的。你需要在沙盒中运行一个进程来启动某一个容器。这个进程是该容器的唯一进程，所以当该进程结束的时候，容器也会完全的停止。" class="headerlink" title="docker容器可以理解为在沙盒中运行的进程。这个沙盒包含了该进程运行所必须的资源，包括文件系统、系统类库、shell 环境等等。但这个沙盒默认是不会运行任何程序的。你需要在沙盒中运行一个进程来启动某一个容器。这个进程是该容器的唯一进程，所以当该进程结束的时候，容器也会完全的停止。"></a>docker容器可以理解为在沙盒中运行的进程。这个沙盒包含了该进程运行所必须的资源，包括文件系统、系统类库、shell 环境等等。但这个沙盒默认是不会运行任何程序的。你需要在沙盒中运行一个进程来启动某一个容器。这个进程是该容器的唯一进程，所以当该进程结束的时候，容器也会完全的停止。</h2><h2 id="目标：-2"><a href="#目标：-2" class="headerlink" title="目标："></a>目标：</h2><h2 id="在我们刚刚下载的镜像中输出”hello-word”。为了达到这个目的，我们需要在这个容器中运行”echo”命令，输出”hello-word”。"><a href="#在我们刚刚下载的镜像中输出”hello-word”。为了达到这个目的，我们需要在这个容器中运行”echo”命令，输出”hello-word”。" class="headerlink" title="在我们刚刚下载的镜像中输出”hello word”。为了达到这个目的，我们需要在这个容器中运行”echo”命令，输出”hello word”。"></a>在我们刚刚下载的镜像中输出”hello word”。为了达到这个目的，我们需要在这个容器中运行”echo”命令，输出”hello word”。</h2><h2 id="提示：-2"><a href="#提示：-2" class="headerlink" title="提示："></a>提示：</h2><h2 id="docker-run命令有两个参数，一个是镜像名，一个是要在镜像中运行的命令。"><a href="#docker-run命令有两个参数，一个是镜像名，一个是要在镜像中运行的命令。" class="headerlink" title="docker run命令有两个参数，一个是镜像名，一个是要在镜像中运行的命令。"></a>docker run命令有两个参数，一个是镜像名，一个是要在镜像中运行的命令。</h2><p><img src="/2020/09/14/Docker%E5%AE%B9%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8/docker6.png" alt="未知_5.png"></p><h2 id="在容器中安装新的程序"><a href="#在容器中安装新的程序" class="headerlink" title="在容器中安装新的程序"></a>在容器中安装新的程序</h2><h2 id="下一步我们要做的事情是在容器里面安装一个简单的程序-ping-。我们之前下载的tutorial镜像是基于ubuntu的，所以你可以使用ubuntu的apt-get命令来安装ping程序：apt-get-install-y-ping。"><a href="#下一步我们要做的事情是在容器里面安装一个简单的程序-ping-。我们之前下载的tutorial镜像是基于ubuntu的，所以你可以使用ubuntu的apt-get命令来安装ping程序：apt-get-install-y-ping。" class="headerlink" title="下一步我们要做的事情是在容器里面安装一个简单的程序(ping)。我们之前下载的tutorial镜像是基于ubuntu的，所以你可以使用ubuntu的apt-get命令来安装ping程序：apt-get install -y ping。"></a>下一步我们要做的事情是在容器里面安装一个简单的程序(ping)。我们之前下载的tutorial镜像是基于ubuntu的，所以你可以使用ubuntu的apt-get命令来安装ping程序：apt-get install -y ping。</h2><h2 id="备注：apt-get-命令执行完毕之后，容器就会停止，但对容器的改动不会丢失。"><a href="#备注：apt-get-命令执行完毕之后，容器就会停止，但对容器的改动不会丢失。" class="headerlink" title="备注：apt-get 命令执行完毕之后，容器就会停止，但对容器的改动不会丢失。"></a>备注：apt-get 命令执行完毕之后，容器就会停止，但对容器的改动不会丢失。</h2><h2 id="目标：-3"><a href="#目标：-3" class="headerlink" title="目标："></a>目标：</h2><h2 id="在learn-tutorial镜像里面安装ping程序。"><a href="#在learn-tutorial镜像里面安装ping程序。" class="headerlink" title="在learn/tutorial镜像里面安装ping程序。"></a>在learn/tutorial镜像里面安装ping程序。</h2><h2 id="提示：-3"><a href="#提示：-3" class="headerlink" title="提示："></a>提示：</h2><h2 id="在执行apt-get-命令的时候，要带上-y参数。如果不指定-y参数的话，apt-get命令会进入交互模式，需要用户输入命令来进行确认，但在docker环境中是无法响应这种交互的。"><a href="#在执行apt-get-命令的时候，要带上-y参数。如果不指定-y参数的话，apt-get命令会进入交互模式，需要用户输入命令来进行确认，但在docker环境中是无法响应这种交互的。" class="headerlink" title="在执行apt-get 命令的时候，要带上-y参数。如果不指定-y参数的话，apt-get命令会进入交互模式，需要用户输入命令来进行确认，但在docker环境中是无法响应这种交互的。"></a>在执行apt-get 命令的时候，要带上-y参数。如果不指定-y参数的话，apt-get命令会进入交互模式，需要用户输入命令来进行确认，但在docker环境中是无法响应这种交互的。</h2><p><img src="/2020/09/14/Docker%E5%AE%B9%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8/docker7.png" alt="未知_6.png"></p><h2 id="保存对容器的修改"><a href="#保存对容器的修改" class="headerlink" title="保存对容器的修改"></a>保存对容器的修改</h2><h2 id="当你对某一个容器做了修改之后（通过在容器中运行某一个命令），可以把对容器的修改保存下来，这样下次可以从保存后的最新状态运行该容器。docker中保存状态的过程称之为committing，它保存的新旧状态之间的区别，从而产生一个新的版本。"><a href="#当你对某一个容器做了修改之后（通过在容器中运行某一个命令），可以把对容器的修改保存下来，这样下次可以从保存后的最新状态运行该容器。docker中保存状态的过程称之为committing，它保存的新旧状态之间的区别，从而产生一个新的版本。" class="headerlink" title="当你对某一个容器做了修改之后（通过在容器中运行某一个命令），可以把对容器的修改保存下来，这样下次可以从保存后的最新状态运行该容器。docker中保存状态的过程称之为committing，它保存的新旧状态之间的区别，从而产生一个新的版本。"></a>当你对某一个容器做了修改之后（通过在容器中运行某一个命令），可以把对容器的修改保存下来，这样下次可以从保存后的最新状态运行该容器。docker中保存状态的过程称之为committing，它保存的新旧状态之间的区别，从而产生一个新的版本。</h2><h2 id="目标：-4"><a href="#目标：-4" class="headerlink" title="目标："></a>目标：</h2><h2 id="首先使用docker-ps-l命令获得安装完ping命令之后容器的id。然后把这个镜像保存为learn-ping。"><a href="#首先使用docker-ps-l命令获得安装完ping命令之后容器的id。然后把这个镜像保存为learn-ping。" class="headerlink" title="首先使用docker ps -l命令获得安装完ping命令之后容器的id。然后把这个镜像保存为learn/ping。"></a>首先使用docker ps -l命令获得安装完ping命令之后容器的id。然后把这个镜像保存为learn/ping。</h2><h2 id="提示：-4"><a href="#提示：-4" class="headerlink" title="提示："></a>提示：</h2><h2 id="1-运行docker-commit，可以查看该命令的参数列表。"><a href="#1-运行docker-commit，可以查看该命令的参数列表。" class="headerlink" title="1. 运行docker commit，可以查看该命令的参数列表。"></a>1. 运行docker commit，可以查看该命令的参数列表。</h2><h2 id="2-你需要指定要提交保存容器的ID。-译者按：通过docker-ps-l-命令获得"><a href="#2-你需要指定要提交保存容器的ID。-译者按：通过docker-ps-l-命令获得" class="headerlink" title="2. 你需要指定要提交保存容器的ID。(译者按：通过docker ps -l 命令获得)"></a>2. 你需要指定要提交保存容器的ID。(译者按：通过docker ps -l 命令获得)</h2><h2 id="3-无需拷贝完整的id，通常来讲最开始的三至四个字母即可区分。（译者按：非常类似git里面的版本号"><a href="#3-无需拷贝完整的id，通常来讲最开始的三至四个字母即可区分。（译者按：非常类似git里面的版本号" class="headerlink" title="3. 无需拷贝完整的id，通常来讲最开始的三至四个字母即可区分。（译者按：非常类似git里面的版本号)"></a>3. 无需拷贝完整的id，通常来讲最开始的三至四个字母即可区分。（译者按：非常类似git里面的版本号)</h2><p><img src="/2020/09/14/Docker%E5%AE%B9%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8/docker8.png" alt="未知_7.png"></p><h2 id="运行新的镜像"><a href="#运行新的镜像" class="headerlink" title="运行新的镜像"></a>运行新的镜像</h2><h2 id="ok，到现在为止，你已经建立了一个完整的、自成体系的docker环境，并且安装了ping命令在里面。它可以在任何支持docker环境的系统中运行啦！-译者按：是不是很神奇呢？-让我们来体验一下吧！"><a href="#ok，到现在为止，你已经建立了一个完整的、自成体系的docker环境，并且安装了ping命令在里面。它可以在任何支持docker环境的系统中运行啦！-译者按：是不是很神奇呢？-让我们来体验一下吧！" class="headerlink" title="ok，到现在为止，你已经建立了一个完整的、自成体系的docker环境，并且安装了ping命令在里面。它可以在任何支持docker环境的系统中运行啦！(译者按：是不是很神奇呢？)让我们来体验一下吧！"></a>ok，到现在为止，你已经建立了一个完整的、自成体系的docker环境，并且安装了ping命令在里面。它可以在任何支持docker环境的系统中运行啦！(译者按：是不是很神奇呢？)让我们来体验一下吧！</h2><h2 id="目标：-5"><a href="#目标：-5" class="headerlink" title="目标："></a>目标：</h2><h2 id="在新的镜像中运行ping-www-google-com命令。"><a href="#在新的镜像中运行ping-www-google-com命令。" class="headerlink" title="在新的镜像中运行ping www.google.com命令。"></a>在新的镜像中运行ping <a href="http://www.google.com/">www.google.com</a>命令。</h2><h2 id="提示：-5"><a href="#提示：-5" class="headerlink" title="提示："></a>提示：</h2><h2 id="一定要使用新的镜像名learn-ping来运行ping命令。-译者按：最开始下载的learn-tutorial镜像中是没有ping命令的"><a href="#一定要使用新的镜像名learn-ping来运行ping命令。-译者按：最开始下载的learn-tutorial镜像中是没有ping命令的" class="headerlink" title="一定要使用新的镜像名learn/ping来运行ping命令。(译者按：最开始下载的learn/tutorial镜像中是没有ping命令的)"></a>一定要使用新的镜像名learn/ping来运行ping命令。(译者按：最开始下载的learn/tutorial镜像中是没有ping命令的)</h2><p><img src="/2020/09/14/Docker%E5%AE%B9%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8/docker9.png" alt="未知_8.png"></p><h2 id="查看所有的容器列表的命令是：docker-ps-a-，显示最近一个容器的命令是：docker-ps-l，更新太快了"><a href="#查看所有的容器列表的命令是：docker-ps-a-，显示最近一个容器的命令是：docker-ps-l，更新太快了" class="headerlink" title="查看所有的容器列表的命令是：docker ps -a ，显示最近一个容器的命令是：docker ps -l，更新太快了- -"></a>查看所有的容器列表的命令是：docker ps -a ，显示最近一个容器的命令是：docker ps -l，更新太快了- -</h2><p><img src="/2020/09/14/Docker%E5%AE%B9%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8/docker10.png" alt="未知_9.png"></p><h2 id="发布docker镜像"><a href="#发布docker镜像" class="headerlink" title="发布docker镜像"></a>发布docker镜像</h2><h2 id="现在我们已经验证了新镜像可以正常工作，下一步我们可以将其发布到官方的索引网站。还记得我们最开始下载的learn-tutorial镜像吧，我们也可以把我们自己编译的镜像发布到索引页面，一方面可以自己重用，另一方面也可以分享给其他人使用。"><a href="#现在我们已经验证了新镜像可以正常工作，下一步我们可以将其发布到官方的索引网站。还记得我们最开始下载的learn-tutorial镜像吧，我们也可以把我们自己编译的镜像发布到索引页面，一方面可以自己重用，另一方面也可以分享给其他人使用。" class="headerlink" title="现在我们已经验证了新镜像可以正常工作，下一步我们可以将其发布到官方的索引网站。还记得我们最开始下载的learn/tutorial镜像吧，我们也可以把我们自己编译的镜像发布到索引页面，一方面可以自己重用，另一方面也可以分享给其他人使用。"></a>现在我们已经验证了新镜像可以正常工作，下一步我们可以将其发布到官方的索引网站。还记得我们最开始下载的learn/tutorial镜像吧，我们也可以把我们自己编译的镜像发布到索引页面，一方面可以自己重用，另一方面也可以分享给其他人使用。</h2><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="runoob-runoob-docker-run-d-P-training-webapp-python-app-py"><a href="#runoob-runoob-docker-run-d-P-training-webapp-python-app-py" class="headerlink" title="runoob@runoob:~# docker run -d -P training/webapp python app.py"></a>runoob@runoob:~# docker run -d -P training/webapp python app.py</h2><h2 id="d-让容器在后台运行。"><a href="#d-让容器在后台运行。" class="headerlink" title="-d:让容器在后台运行。"></a>-d:让容器在后台运行。</h2><h2 id="P-将容器内部使用的网络端口映射到我们使用的主机上。"><a href="#P-将容器内部使用的网络端口映射到我们使用的主机上。" class="headerlink" title="-P:将容器内部使用的网络端口映射到我们使用的主机上。"></a>-P:将容器内部使用的网络端口映射到我们使用的主机上。</h2><h2 id="docker-logs-ID或者名字-可以查看容器内部的标准输出。"><a href="#docker-logs-ID或者名字-可以查看容器内部的标准输出。" class="headerlink" title="docker logs [ID或者名字] 可以查看容器内部的标准输出。"></a>docker logs [ID或者名字] 可以查看容器内部的标准输出。</h2><h2 id="停止运行"><a href="#停止运行" class="headerlink" title="停止运行"></a>停止运行</h2><p>runoob@runoob:~$ docker stop wizardly_chandrasekhar</p><h2 id="我们可以使用-docker-rm-命令来删除不需要的容器-删除容器时，容器必须是停止状态"><a href="#我们可以使用-docker-rm-命令来删除不需要的容器-删除容器时，容器必须是停止状态" class="headerlink" title="我们可以使用 docker rm 命令来删除不需要的容器 删除容器时，容器必须是停止状态"></a>我们可以使用 docker rm 命令来删除不需要的容器 删除容器时，容器必须是停止状态</h2><p>runoob@runoob:~$ docker rm wizardly_chandrasekhar</p><h2 id="docker-run-只在第一次运行时使用，将镜像放到容器中，以后再次启动这个容器时，只需要使用命令docker-start-即可。"><a href="#docker-run-只在第一次运行时使用，将镜像放到容器中，以后再次启动这个容器时，只需要使用命令docker-start-即可。" class="headerlink" title="docker run 只在第一次运行时使用，将镜像放到容器中，以后再次启动这个容器时，只需要使用命令docker start 即可。"></a>docker run 只在第一次运行时使用，将镜像放到容器中，以后再次启动这个容器时，只需要使用命令docker start 即可。</h2><p><strong>docker run**</strong>相当于执行了两步操作：将镜像放入容器中（**<strong>docker create**</strong>）**<strong>,**</strong>然后将容器启动，使之变成运行时容器（**<strong>docker start**</strong>）。**</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Docker容器的使用&quot;&gt;&lt;a href=&quot;#Docker容器的使用&quot; class=&quot;headerlink&quot; title=&quot;Docker容器的使用&quot;&gt;&lt;/a&gt;Docker容器的使用&lt;/h2&gt;&lt;h3 id=&quot;Docker是一个开源的引擎，可以轻松的为任何应用创建一个</summary>
      
    
    
    
    <category term="容器" scheme="http://example.com/categories/%E5%AE%B9%E5%99%A8/"/>
    
    
    <category term="docker" scheme="http://example.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>MySQL创建用户与授权</title>
    <link href="http://example.com/2020/09/14/MySQL%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E4%B8%8E%E6%8E%88%E6%9D%83/"/>
    <id>http://example.com/2020/09/14/MySQL%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E4%B8%8E%E6%8E%88%E6%9D%83/</id>
    <published>2020-09-14T08:18:16.000Z</published>
    <updated>2020-09-14T08:19:12.809Z</updated>
    
    <content type="html"><![CDATA[<h2 id="MySQL创建用户与授权"><a href="#MySQL创建用户与授权" class="headerlink" title="MySQL创建用户与授权"></a>MySQL创建用户与授权</h2><h2 id="一-创建用户"><a href="#一-创建用户" class="headerlink" title="一. 创建用户"></a>一. 创建用户</h2><h2 id="命令"><a href="#命令" class="headerlink" title="命令:"></a>命令:</h2><p>CREATE USER ‘username’@’host’ IDENTIFIED BY ‘password’;</p><h2 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h2><ul><li>username：你将创建的用户名</li><li>host：指定该用户在哪个主机上可以登陆，如果是本地用户可用localhost，如果想让该用户可以<strong>从任意远程主机登陆</strong>，可以使用通配符%</li><li>password：该用户的登陆密码，密码可以为空，如果为空则该用户可以不需要密码登陆服务器</li></ul><h2 id="例子："><a href="#例子：" class="headerlink" title="例子："></a>例子：</h2><p>CREATE USER ‘dog’@’localhost’ IDENTIFIED BY ‘123456’;</p><p>CREATE USER ‘pig’@’192.168.1.101_’ IDENDIFIED BY ‘123456’;</p><p>CREATE USER ‘pig’@’%’ IDENTIFIED BY ‘123456’;</p><p>CREATE USER ‘pig’@’%’ IDENTIFIED BY ‘’;</p><p>CREATE USER ‘pig’@’%’;</p><h2 id="二-授权"><a href="#二-授权" class="headerlink" title="二. 授权:"></a>二. 授权:</h2><h2 id="命令-1"><a href="#命令-1" class="headerlink" title="命令:"></a>命令:</h2><p>GRANT privileges ON databasename.tablename TO ‘username’@’host’</p><h2 id="说明"><a href="#说明" class="headerlink" title="说明:"></a>说明:</h2><ul><li>privileges：用户的操作权限，如SELECT，INSERT，UPDATE等，如果要授予所的权限则使用ALL</li><li>databasename：数据库名</li><li>tablename：表名，如果要授予该用户对所有数据库和表的相应操作权限则可用<em>表示，如</em>.*</li></ul><h2 id="例子"><a href="#例子" class="headerlink" title="例子:"></a>例子:</h2><p>　　</p><p>GRANT SELECT, INSERT ON test.user TO ‘pig’@’%’;</p><p>GRANT ALL ON <em>.</em> TO ‘pig’@’%’;</p><p>GRANT ALL ON maindataplus.* TO ‘pig’@’%’;</p><h2 id="注意"><a href="#注意" class="headerlink" title="注意:"></a>注意:</h2><p>用以上命令授权的用户不能给其它用户授权，如果想让该用户可以授权，用以下命令:</p><p>GRANT privileges ON databasename.tablename TO ‘username’@’host’ WITH GRANT OPTION;</p><h2 id="三-设置与更改用户密码"><a href="#三-设置与更改用户密码" class="headerlink" title="三.设置与更改用户密码"></a>三.设置与更改用户密码</h2><h2 id="命令-2"><a href="#命令-2" class="headerlink" title="命令:"></a>命令:</h2><p>SET PASSWORD FOR ‘username’@’host’ = PASSWORD(‘newpassword’);</p><p>如果是当前登陆用户用:</p><p>SET PASSWORD = PASSWORD(“newpassword”);</p><h2 id="例子-1"><a href="#例子-1" class="headerlink" title="例子:"></a>例子:</h2><p>SET PASSWORD FOR ‘pig’@’%’ = PASSWORD(“<strong>123456</strong>“);</p><h2 id="四-撤销用户权限"><a href="#四-撤销用户权限" class="headerlink" title="四. 撤销用户权限"></a>四. 撤销用户权限</h2><h2 id="命令-3"><a href="#命令-3" class="headerlink" title="命令:"></a>命令:</h2><p>REVOKE privilege ON databasename.tablename FROM ‘username’@’host’;</p><h2 id="说明-1"><a href="#说明-1" class="headerlink" title="说明:"></a>说明:</h2><p>privilege, databasename, tablename：同授权部分</p><h2 id="例子-2"><a href="#例子-2" class="headerlink" title="例子:"></a>例子:</h2><p>REVOKE SELECT ON <em>.</em> FROM ‘pig’@’%’;</p><h2 id="注意-1"><a href="#注意-1" class="headerlink" title="注意:"></a>注意:</h2><p>假如你在给用户‘pig’@’%’授权的时候是这样的（或类似的）：GRANT SELECT ON test.user TO ‘pig’@’%’，则在使用REVOKE SELECT ON <em>.</em> FROM ‘pig’@’%’;命令并不能撤销该用户对test数据库中user表的SELECT 操作。相反，如果授权使用的是GRANT SELECT ON <em>.</em> TO ‘pig’@’%’;则REVOKE SELECT ON test.user FROM ‘pig’@’%’;命令也不能撤销该用户对test数据库中user表的Select权限。</p><p>具体信息可以用命令SHOW GRANTS FOR ‘pig’@’%’; 查看。</p><h2 id="五-删除用户"><a href="#五-删除用户" class="headerlink" title="五.删除用户"></a>五.删除用户</h2><h2 id="命令-4"><a href="#命令-4" class="headerlink" title="命令:"></a>命令:</h2><p>DROP USER ‘username’@’host’;</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;MySQL创建用户与授权&quot;&gt;&lt;a href=&quot;#MySQL创建用户与授权&quot; class=&quot;headerlink&quot; title=&quot;MySQL创建用户与授权&quot;&gt;&lt;/a&gt;MySQL创建用户与授权&lt;/h2&gt;&lt;h2 id=&quot;一-创建用户&quot;&gt;&lt;a href=&quot;#一-创建用户&quot;</summary>
      
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="mysql" scheme="http://example.com/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>YML简介</title>
    <link href="http://example.com/2020/09/12/YML%E7%AE%80%E4%BB%8B/"/>
    <id>http://example.com/2020/09/12/YML%E7%AE%80%E4%BB%8B/</id>
    <published>2020-09-12T06:03:43.000Z</published>
    <updated>2020-09-14T08:11:01.762Z</updated>
    
    <content type="html"><![CDATA[<h3 id="一、YML是什么"><a href="#一、YML是什么" class="headerlink" title="一、YML是什么"></a>一、YML是什么</h3><p>YAML (YAML Ain’t a Markup Language)YAML不是一种标记语言，通常以.yml为后缀的文件，是一种直观的能够被电脑识别的数据序列化格式，并且容易被人类阅读，容易和脚本语言交互的，可以被支持YAML库的不同的编程语言程序导入，一种专门用来写配置文件的语言。可用于如： Java，C/C++, Ruby, Python, Perl, C#, PHP等。</p><h3 id="二、YML的优点"><a href="#二、YML的优点" class="headerlink" title="二、YML的优点"></a>二、YML的优点</h3><ol><li>YAML易于人们阅读。</li><li>YAML数据在编程语言之间是可移植的。</li><li>YAML匹配敏捷语言的本机数据结构。</li><li>YAML具有一致的模型来支持通用工具。</li><li>YAML支持单程处理。</li><li>YAML具有表现力和可扩展性。</li><li>YAML易于实现和使用。</li></ol><h3 id="三、YML语法"><a href="#三、YML语法" class="headerlink" title="三、YML语法"></a>三、YML语法</h3><h4 id="1-约定"><a href="#1-约定" class="headerlink" title="1.约定"></a>1.约定</h4><ul><li>k: v 表示键值对关系，冒号后面必须有一个空格</li><li>使用空格的缩进表示层级关系，空格数目不重要，只要是左对齐的一列数据，都是同一个层级的</li><li>大小写敏感</li><li>缩进时不允许使用Tab键，只允许使用空格。</li><li>松散表示，java中对于驼峰命名法，可用原名或使用-代替驼峰，如java中的lastName属性,在yml中使用lastName或 last-name都可正确映射。</li></ul><h4 id="2-键值关系"><a href="#2-键值关系" class="headerlink" title="2.键值关系"></a>2.键值关系</h4><p>(以java语言为例，其它语言类似)对于键与值主要是看能否表示以下内容。普通的值(数字、字符串、布尔)、日期、对象、数组、集合等。</p><h5 id="1-普通值-字面量"><a href="#1-普通值-字面量" class="headerlink" title="1) 普通值(字面量)"></a>1) 普通值(字面量)</h5><p>k: v：字面量直接写；</p><p>   字符串默认不用加上单引号或者双绰号；</p><p>   “”: 双引号；不会转义字符串里面的特殊字符；特殊字符会作为本身想表示的意思</p><p>​       name:   “zhangsan \n lisi”：输出；zhangsan 换行  lisi</p><p>   ‘’：单引号；会转义特殊字符，特殊字符最终只是一个普通的字符串数据</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name1:</span> <span class="string">zhangsan</span></span><br><span class="line"><span class="attr">name2:</span> <span class="string">&#x27;zhangsan \n lisi&#x27;</span></span><br><span class="line"><span class="attr">name3:</span> <span class="string">&quot;zhangsan \n lisi&quot;</span></span><br><span class="line"><span class="attr">age:</span> <span class="number">18</span></span><br><span class="line"><span class="attr">flag:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h5 id="2-日期"><a href="#2-日期" class="headerlink" title="2)日期"></a>2)日期</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">date:</span> <span class="number">2020</span><span class="string">/09/12</span></span><br></pre></td></tr></table></figure><h5 id="3-对象-属性和值-、Map-键值对"><a href="#3-对象-属性和值-、Map-键值对" class="headerlink" title="3)对象(属性和值)、Map(键值对)"></a>3)对象(属性和值)、Map(键值对)</h5><p>   在下一行来写对象的属性和值的关系，注意缩进</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">people:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">zhangsan</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">20</span></span><br></pre></td></tr></table></figure><p>   行内写法:</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">people:</span> &#123;<span class="string">name:zhangsan</span>,<span class="attr">age:</span> <span class="number">20</span>&#125;</span><br></pre></td></tr></table></figure><h5 id="4-数组、list、set"><a href="#4-数组、list、set" class="headerlink" title="4)数组、list、set"></a>4)数组、list、set</h5><p>用- 值表示数组中的一个元素</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pets:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">dog</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">pig</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cat</span></span><br></pre></td></tr></table></figure><p>行内写法</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pets:</span> [<span class="string">dog</span>,<span class="string">pig</span>,<span class="string">cat</span>]</span><br></pre></td></tr></table></figure><h5 id="5-数组对象、list对象、set对象"><a href="#5-数组对象、list对象、set对象" class="headerlink" title="5)数组对象、list对象、set对象"></a>5)数组对象、list对象、set对象</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">peoples:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">zhangsan</span></span><br><span class="line">      <span class="attr">age:</span> <span class="number">22</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">lisi</span></span><br><span class="line">      <span class="attr">age:</span> <span class="number">20</span></span><br><span class="line">    <span class="bullet">-</span> &#123;<span class="attr">name:</span> <span class="string">wangwu</span>,<span class="attr">age:</span> <span class="number">18</span>&#125;</span><br></pre></td></tr></table></figure><h5 id="6-java代码示例"><a href="#6-java代码示例" class="headerlink" title="6)java代码示例"></a>6)java代码示例</h5><p>java代码(省略get,set方法)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; maps;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Dog&gt; lists;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line">    <span class="keyword">private</span> String[] arr;</span><br><span class="line">｝</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对应的yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">boss:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">maps:</span></span><br><span class="line">    <span class="attr">k1:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">k2:</span> <span class="number">14</span></span><br><span class="line">  <span class="attr">lists:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">d1</span></span><br><span class="line">      <span class="attr">age:</span> <span class="number">2</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">d2</span></span><br><span class="line">      <span class="attr">age:</span> <span class="number">3</span></span><br><span class="line">    <span class="bullet">-</span> &#123;<span class="attr">name:</span> <span class="string">d3</span>,<span class="attr">age:</span> <span class="number">4</span>&#125;</span><br><span class="line">  <span class="attr">birth:</span> <span class="number">2020</span><span class="string">/09/12</span></span><br><span class="line">  <span class="attr">dog:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">p_dog</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">15</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">13</span></span><br><span class="line">  <span class="attr">last-name:</span> <span class="string">张三</span></span><br><span class="line">  <span class="attr">arr:</span> [<span class="string">s1</span>,<span class="string">s2</span>,<span class="string">s3</span>]</span><br></pre></td></tr></table></figure><h4 id="3-文档块"><a href="#3-文档块" class="headerlink" title="3.文档块"></a>3.文档块</h4><p>对于测试环境，预生产环境，生产环境可以使用不同的配置，如果只想写到一个文件中，yml与是支持的,每个块用—-隔开</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">prod</span> <span class="comment">#激活对应的文档块</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8083</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span> <span class="comment">#指定属于哪个环境</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8084</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">prod</span>  <span class="comment">#指定属于哪个环境</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;一、YML是什么&quot;&gt;&lt;a href=&quot;#一、YML是什么&quot; class=&quot;headerlink&quot; title=&quot;一、YML是什么&quot;&gt;&lt;/a&gt;一、YML是什么&lt;/h3&gt;&lt;p&gt;YAML (YAML Ain’t a Markup Language)YAML不是一种标记语</summary>
      
    
    
    
    <category term="脚本" scheme="http://example.com/categories/%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="YML" scheme="http://example.com/tags/YML/"/>
    
  </entry>
  
  <entry>
    <title>hexo+github.io博客搭建📖</title>
    <link href="http://example.com/2020/09/11/hexo-github-io%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    <id>http://example.com/2020/09/11/hexo-github-io%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</id>
    <published>2020-09-11T09:17:59.000Z</published>
    <updated>2020-09-14T08:11:28.939Z</updated>
    
    <content type="html"><![CDATA[<h2 id="什么是-Hexo？"><a href="#什么是-Hexo？" class="headerlink" title="什么是 Hexo？"></a>什么是 Hexo？</h2><blockquote><p>Hexo 是一个快速、简洁且高效的博客框架。Hexo 使用 Markdown（或其他渲染引擎）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。</p></blockquote><h2 id="需要安装的软件环境"><a href="#需要安装的软件环境" class="headerlink" title="需要安装的软件环境"></a>需要安装的软件环境</h2><blockquote><p>Node.js   [nodeJS官网] <a href="https://nodejs.org/en/">https://nodejs.org/en/</a></p></blockquote><h2 id="安装-hexo："><a href="#安装-hexo：" class="headerlink" title="安装 hexo："></a>安装 hexo：</h2><blockquote><p>npm install hero-cli -g</p></blockquote><h2 id="使用hexo创建博客目录并启动："><a href="#使用hexo创建博客目录并启动：" class="headerlink" title="使用hexo创建博客目录并启动："></a>使用hexo创建博客目录并启动：</h2><blockquote><p>   hexo init myBlog<br>   cd myBlog<br>   yarn<br>   hexo s</p></blockquote><h2 id="更换hexo主题："><a href="#更换hexo主题：" class="headerlink" title="更换hexo主题："></a>更换hexo主题：</h2><h4 id="git形式："><a href="#git形式：" class="headerlink" title="git形式："></a>git形式：</h4><blockquote><p>   cd 到博客主目录下<br>   git clone <a href="https://github.com/theme-next/hexo-theme-next">https://github.com/theme-next/hexo-theme-next</a> themes/next<br>  修改根目录下的配置文件 [_config.yml] 中 theme: next<br>  然后启动<br>   hexo clean<br>   hero  s</p></blockquote><h2 id="部署截图"><a href="#部署截图" class="headerlink" title="部署截图"></a>部署截图</h2><blockquote><p><img src="/2020/09/11/hexo-github-io%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/github2.jpg" alt="alt github"><br><img src="/2020/09/11/hexo-github-io%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/github3.jpg" alt="alt github"><br><img src="/2020/09/11/hexo-github-io%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/github1.jpg" alt="alt github"></p></blockquote><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h4 id="网站"><a href="#网站" class="headerlink" title="网站"></a>网站</h4><table><thead><tr><th><strong>参数</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>title</td><td>网站标题</td></tr><tr><td>subtitle</td><td>网站副标题</td></tr><tr><td>description</td><td>网站描述</td></tr><tr><td>keywords</td><td>网站的关键词。支援多个关键词。</td></tr><tr><td>author</td><td>您的名字</td></tr><tr><td>language</td><td>网站使用的语言。对于简体中文用户来说，使用不同的主题可能需要设置成不同的值，请参考你的主题的文档自行设置，常见的有 zh-Hans和 zh-CN。</td></tr><tr><td>timezone</td><td>网站时区。Hexo 默认使用您电脑的时区。请参考 <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">时区列表</a> 进行设置，如 America/New_York, Japan, 和 UTC 。一般的，对于中国大陆地区可以使用 Asia/Shanghai。</td></tr></tbody></table><h4 id="网址"><a href="#网址" class="headerlink" title="网址"></a>网址</h4><table><thead><tr><th><strong>参数</strong></th><th><strong>描述</strong></th><th><strong>默认值</strong></th></tr></thead><tbody><tr><td>url</td><td>网址</td><td></td></tr><tr><td>root</td><td>网站根目录</td><td></td></tr><tr><td>permalink</td><td>文章的 <a href="https://hexo.io/zh-cn/docs/permalinks">永久链接</a> 格式</td><td>:year/:month/:day/:title/</td></tr><tr><td>permalink_defaults</td><td>永久链接中各部分的默认值</td><td></td></tr><tr><td>pretty_urls</td><td>改写 <a href="https://hexo.io/zh-cn/docs/variables">permalink</a> 的值来美化 URL</td><td></td></tr><tr><td>pretty_urls.trailing_index</td><td>是否在永久链接中保留尾部的 index.html，设置为 false 时去除</td><td>true</td></tr><tr><td>pretty_urls.trailing_html</td><td>是否在永久链接中保留尾部的 .html, 设置为 false 时去除 (对尾部的 index.html无效)</td><td></td></tr></tbody></table><h4 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h4><table><thead><tr><th><strong>参数</strong></th><th><strong>描述</strong></th><th><strong>默认值</strong></th></tr></thead><tbody><tr><td>source_dir</td><td>资源文件夹，这个文件夹用来存放内容。</td><td>source</td></tr><tr><td>public_dir</td><td>公共文件夹，这个文件夹用于存放生成的站点文件。</td><td>public</td></tr><tr><td>tag_dir</td><td>标签文件夹</td><td>tags</td></tr><tr><td>archive_dir</td><td>归档文件夹</td><td>archives</td></tr><tr><td>category_dir</td><td>分类文件夹</td><td>categories</td></tr><tr><td>code_dir</td><td>Include code 文件夹，source_dir 下的子目录</td><td>downloads/code</td></tr><tr><td>i18n_dir</td><td>国际化（i18n）文件夹</td><td>:lang</td></tr></tbody></table><h4 id="文章"><a href="#文章" class="headerlink" title="文章"></a>文章</h4><table><thead><tr><th><strong>参数</strong></th><th><strong>描述</strong></th><th><strong>默认值</strong></th></tr></thead><tbody><tr><td>new_post_name</td><td>新文章的文件名称</td><td>:title.md</td></tr><tr><td>default_layout</td><td>预设布局</td><td>post</td></tr><tr><td>auto_spacing</td><td>在中文和英文之间加入空格</td><td>false</td></tr><tr><td>titlecase</td><td>把标题转换为 title case</td><td>false</td></tr><tr><td>external_link</td><td>在新标签中打开链接</td><td>true</td></tr><tr><td>external_link.enable</td><td>在新标签中打开链接</td><td>true</td></tr><tr><td>external_link.field</td><td>对整个网站（site）生效或仅对文章（post）生效</td><td>site</td></tr><tr><td>external_link.exclude</td><td>需要排除的域名。主域名和子域名如 www 需分别配置</td><td>[]</td></tr><tr><td>filename_case</td><td>把文件名称转换为 (1) 小写或 (2) 大写</td><td>0</td></tr><tr><td>render_drafts</td><td>显示草稿</td><td>false</td></tr><tr><td>post_asset_folder</td><td>启动 <a href="https://hexo.io/zh-cn/docs/asset-folders">Asset 文件夹</a></td><td>false</td></tr><tr><td>relative_link</td><td>把链接改为与根目录的相对位址</td><td>false</td></tr><tr><td>future</td><td>显示未来的文章</td><td>true</td></tr><tr><td>highlight</td><td>代码块的设置, see <a href="https://hexo.io/docs/syntax-highlight#Highlight-js">Highlight.js</a> section for usage guide</td><td></td></tr></tbody></table><h2 id="发布文章"><a href="#发布文章" class="headerlink" title="发布文章"></a>发布文章</h2><h4 id="文章资源文件夹"><a href="#文章资源文件夹" class="headerlink" title="文章资源文件夹"></a>文章资源文件夹</h4><blockquote><p>对于那些想要更有规律地提供图片和其他资源以及想要将他们的资源分布在各个文章上的人来说，Hexo也提供了更组织化的方式来管理资源。这个稍微有些复杂但是管理资源非常方便的功能可以通过将 config.yml 文件中的 post_asset_folder 选项设为 true 来打开。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post_asset_folder: true</span><br></pre></td></tr></table></figure><blockquote><p>当资源文件管理功能打开后，Hexo将会在你每一次通过 <code> hexo new [layout] &lt;title&gt;</code> 命令创建新文章时自动创建一个文件夹。这个资源文件夹将会有与这个文章文件一样的名字。将所有与你的文章有关的资源放在这个关联文件夹中之后，你可以通过相对路径来引用它们，这样你就得到了一个更简单而且方便得多的工作流。</p></blockquote><h2 id="相关文档"><a href="#相关文档" class="headerlink" title="相关文档"></a>相关文档</h2><p>[hexo中文文档：] <a href="https://hexo.io/zh-cn/docs/">https://hexo.io/zh-cn/docs/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;什么是-Hexo？&quot;&gt;&lt;a href=&quot;#什么是-Hexo？&quot; class=&quot;headerlink&quot; title=&quot;什么是 Hexo？&quot;&gt;&lt;/a&gt;什么是 Hexo？&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Hexo 是一个快速、简洁且高效的博客框架。Hexo 使用</summary>
      
    
    
    
    <category term="环境搭建" scheme="http://example.com/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="hexo" scheme="http://example.com/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://example.com/2020/09/11/hello-world/"/>
    <id>http://example.com/2020/09/11/hello-world/</id>
    <published>2020-09-11T03:40:32.735Z</published>
    <updated>2020-09-11T03:40:32.736Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    
  </entry>
  
</feed>
